{# $(document).bind(paella.events.loadComplete, function (event, params) {#}
{#    {% if intro#}
{#        or (autostart is defined and autostart == 'true') %}#}
{#    if (!paella.utils.userAgent.browser.IsMobileVersion && !document.querySelector("#introContainer")){#}
{#        setTimeout(function () {#}
{#            paella.player.play().catch(function(err) {#}
{#                {% if autoplay_fallback == 'mute_fallback' %}#}
{#                paella.player.videoContainer.setVolume(0);#}
{#                paella.player.play();#}
{#                {% endif %}#}
{#            });#}
{#        }, 300);#}
{#    }#}
{#    {% endif %}#}

{#    setTimeout(function () {#}
{#        setPaellaProfile("{{ getPaellaLayout(multimediaObject, app.request) }}");#}
{#    }, 300);#}

{#});#}

{#function setPaellaProfile(profileName) {#}
{#    $('.viewModeItemButton').removeClass('selected');#}
{#    $('.viewModeItemButton.' + profileName).addClass('selected');#}
{#    paella.player.setProfile(profileName);#}
{#    paella.utils.cookies.set("lastProfile", profileName);#}
{#} #}

{#function playPauseCanvas(mainContainer, video) {#}
{#    const icon = document.createElement('canvas');#}
{#    icon.className = 'playButtonOnScreenIcon';#}
{#    icon.style.display = (video.autoplay) ? 'none' : 'block';#}
{#    if (/^((?!chrome|android).)*safari/i.test(navigator.userAgent)) {#}
{#        icon.style.display = 'block';#}
{#    }#}

{#    mainContainer.appendChild(icon);#}

{#    setTimeout(function () {#}
{#        const width = jQuery(mainContainer).innerWidth();#}
{#        const height = jQuery(mainContainer).innerHeight();#}

{#        icon.width = width;#}
{#        icon.height = height;#}

{#        const iconSize = (width < height) ? width / 3 : height / 3;#}

{#        const ctx = icon.getContext('2d');#}

{#        ctx.translate((width - iconSize) / 2, (height - iconSize) / 2);#}

{#        ctx.beginPath();#}
{#        ctx.arc(iconSize / 2, iconSize / 2, iconSize / 2, 0, 2 * Math.PI, true);#}
{#        ctx.closePath();#}

{#        ctx.strokeStyle = 'white';#}
{#        ctx.lineWidth = 10;#}
{#        ctx.stroke();#}
{#        ctx.fillStyle = '#8f8f8f';#}
{#        ctx.fill();#}

{#        ctx.beginPath();#}
{#        ctx.moveTo(iconSize / 3, iconSize / 4);#}
{#        ctx.lineTo(3 * iconSize / 4, iconSize / 2);#}
{#        ctx.lineTo(iconSize / 3, 3 * iconSize / 4);#}
{#        ctx.lineTo(iconSize / 3, iconSize / 4);#}
{#        ctx.closePath();#}
{#        ctx.fillStyle = 'white';#}
{#        ctx.fill();#}

{#        ctx.stroke();#}
{#    }, 100);#}
{#}#}

{#    $(mainContainer).bind('click', function () #}{#}#}
{#        if (video.paused) #}{#}#}
{#            icon.style.display = 'none';#}
{#            video.play();#}
{#        } else #}{#}#}
{#            icon.style.display = 'block';#}
{#            video.pause();#}
{#        }#}
{#    });#}
{#}#}

{#introOrTailVideo("intro");#}

{#function introOrTailVideo(typeVideo) {#}
{#    const container = document.querySelector("#players");#}
{#    const overlay = document.createElement("overlay");#}
{#    const skipContainer = document.createElement("div");#}
{#    const video = document.createElement("video");#}
{#    video.setAttribute('controls', true);#}
{#    const videoContainer = document.createElement("div");#}

{#    if (typeVideo == "intro") {#}
{#        {% if intro %}#}
{#        video.src = "{{ absolute_url(track_url(intro)) }}";#}
{#        video.poster = "{{ multimediaObject|first_url_pic(true) }}";#}
{#        {% endif %}#}
{#    } else {#}
{#        {% if tail %}#}
{#        video.src = "{{ absolute_url(track_url(tail)) }}";#}
{#        {% endif %}#}
{#    }#}

{#    video.id = (typeVideo == "intro") ? 'intro' : 'tail';#}
{#    video.addEventListener('ended', onEndedVideo);#}
{#    video.autoplay = (typeVideo == "intro") ? "{{ autostart }}" : "true";#}
{#    video.muted = navigator.userAgentData.mobile;#}

{#    skipContainer.id = "skipContainer";#}
{#    videoContainer.id = (typeVideo == "intro") ? 'introContainer' : 'tailContainer';#}
{#    overlay.id = "overlay";#}
{#    skipContainer.addEventListener("click", onEndedVideo);#}

{#    skipContainer.innerHTML = (typeVideo == "intro") ? '{{ "Next up" | trans }}' : '{{ "Finish" | trans }}';#}

{#    if (!document.querySelector("#" + video.id)) {#}
{#        videoContainer.appendChild(video);#}
{#        videoContainer.appendChild(skipContainer);#}
{#        videoContainer.appendChild(overlay);#}
{#        container.appendChild(videoContainer);#}
{#    }#}
{#    playPauseCanvas(overlay, video);#}

{#    function onEndedVideo() {#}
{#        container.removeChild(videoContainer);#}
{#        if (typeVideo == "intro") {#}
{#            if (paella.player.videoLoader.loadStatus) {#}
{#                setTimeout(function () {#}
{#                    paella.player.play();#}
{#                }, 300);#}
{#            }#}
{#        }#}
{#    }#}
{#}#}

{#var firstPlay = false;#}

{#{% if intro %}#}
{#    introOrTailVideo("intro");#}
{#    loadPaella('playerContainer', '{{ multimediaObject.id }}');#}
{#{% else %}#}
{#    loadPaella('playerContainer', '{{ multimediaObject.id }}');#}
{#{% endif %}#}

{#paella.events.bind(paella.events.endVideo, function (event) #}{#}#}
{#    {% if tail %}#}
{#        introOrTailVideo("tail");#}
{#    {% endif %}#}
{#    firstPlay = true;#}
{#    paella.events.bind(paella.events.play, function (event) #}{#}#}
{#        {% if intro %}#}
{#            if (firstPlay) #}{#}#}
{#                introOrTailVideo("intro");#}
{#                paella.player.pause();#}
{#                firstPlay = false;#}
{#            }#}
{#        {% endif %}#}
{#    });#}
{#});#}
