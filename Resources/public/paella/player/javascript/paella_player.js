/*
	Paella HTML5 Multistream Player v.5.0.18
	Copyright (C) 2013  Universitat Politècnica de València
	File generated at 30-11-2016
*/
function paella_Deferred(action,timeout){timeout=timeout||50;var def=$.Deferred();return setTimeout(function(){action(def)},timeout),def}function paella_DeferredResolved(param){return paella_Deferred(function(def){def.resolve(param)})}function paella_DeferredRejected(param){return paella_Deferred(function(def){def.reject(param)})}function paella_DeferredNotImplemented(){return paella_DeferredRejected(new Error("not implemented"))}function initPaellaEngage(playerId,initDelegate){initDelegate||(initDelegate=new paella.InitDelegate),paella.initDelegate=initDelegate;navigator.language||window.navigator.userLanguage;paellaPlayer=new PaellaPlayer(playerId,paella.initDelegate)}function DeprecatedClass(name,replacedBy,p){Class(name,p,{initialize:function(){base.log.warning(name+" is deprecated, use "+replacedBy+" instead."),this.parent.apply(this,arguments)}})}function DeprecatedFunc(name,replacedBy,func){function ret(){base.log.warning(name+" is deprecated, use "+replacedBy+" instead."),func.apply(this,arguments)}return ret}function onYouTubeIframeAPIReady(){paella.youtubePlayerVars.apiReadyPromise.resolve()}var GlobalParams={video:{zIndex:1},background:{zIndex:0}},paella={};paella.player=null,paella.events={play:"paella:play",pause:"paella:pause",next:"paella:next",previous:"paella:previous",seeking:"paella:seeking",seeked:"paella:seeked",timeupdate:"paella:timeupdate",timeUpdate:"paella:timeupdate",seekTo:"paella:setseek",endVideo:"paella:endvideo",seekToTime:"paella:seektotime",setTrim:"paella:settrim",setPlaybackRate:"paella:setplaybackrate",setVolume:"paella:setVolume",setComposition:"paella:setComposition",loadStarted:"paella:loadStarted",loadComplete:"paella:loadComplete",loadPlugins:"paella:loadPlugins",error:"paella:error",setProfile:"paella:setprofile",documentChanged:"paella:documentChanged",didSaveChanges:"paella:didsavechanges",controlBarWillHide:"paella:controlbarwillhide",controlBarDidHide:"paella:controlbardidhide",controlBarDidShow:"paella:controlbardidshow",hidePopUp:"paella:hidePopUp",showPopUp:"paella:showPopUp",enterFullscreen:"paella:enterFullscreen",exitFullscreen:"paella:exitFullscreen",resize:"paella:resize",qualityChanged:"paella:qualityChanged",singleVideoReady:"paella:singleVideoReady",singleVideoUnloaded:"paella:singleVideoUnloaded",videoReady:"paella:videoReady",videoUnloaded:"paella:videoUnloaded",controlBarLoaded:"paella:controlBarLoaded",flashVideoEvent:"paella:flashVideoEvent",captionAdded:"paella:caption:add",captionsEnabled:"paella:caption:enabled",captionsDisabled:"paella:caption:disabled",trigger:function(event,params){$(document).trigger(event,params)},bind:function(event,callback){$(document).bind(event,function(event,params){callback(event,params)})},setupExternalListener:function(){window.addEventListener("message",function(event){event.data&&event.data.event&&paella.events.trigger(event.data.event,event.data.params)},!1)}},paella.events.setupExternalListener(),Class("paella.MouseManager",{targetObject:null,initialize:function(){var thisClass=this;paella.events.bind("mouseup",function(event){thisClass.up(event)}),paella.events.bind("mousemove",function(event){thisClass.move(event)}),paella.events.bind("mouseover",function(event){thisClass.over(event)})},down:function(targetObject,event){return this.targetObject=targetObject,this.targetObject&&this.targetObject.down&&(this.targetObject.down(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},up:function(event){return this.targetObject&&this.targetObject.up&&(this.targetObject.up(event,event.pageX,event.pageY),event.cancelBubble=!0),this.targetObject=null,!1},out:function(event){return this.targetObject&&this.targetObject.out&&(this.targetObject.out(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},move:function(event){return this.targetObject&&this.targetObject.move&&(this.targetObject.move(event,event.pageX,event.pageY),event.cancelBubble=!0),!1},over:function(event){return this.targetObject&&this.targetObject.over&&(this.targetObject.over(event,event.pageX,event.pageY),event.cancelBubble=!0),!1}}),paella.utils={mouseManager:new paella.MouseManager,folders:{get:function(folder){if(paella.player&&paella.player.config&&paella.player.config.folders&&paella.player.config.folders[folder])return paella.player.config.folders[folder]},profiles:function(){return paella.utils.folders.get("profiles")||"config/profiles"},resources:function(){return paella.utils.folders.get("resources")||"resources"},skins:function(){return paella.utils.folders.get("skins")||paella.utils.folders.get("resources")+"/style"}},styleSheet:{removeById:function(id){var outStyleSheet=$(document.head).find("#"+id)[0];outStyleSheet&&document.head.removeChild(outStyleSheet)},remove:function(fileName){for(var links=document.head.getElementsByTagName("link"),i=0;i<links.length;++i)if(links[i].href){document.head.removeChild(links[i]);break}},add:function(fileName,id){var link=document.createElement("link");link.rel="stylesheet",link.href=fileName,link.type="text/css",link.media="screen",link.charset="utf-8",id&&(link.id=id),document.head.appendChild(link)},swap:function(outFile,inFile){this.remove(outFile),this.add(inFile)}},skin:{set:function(skinName){var skinId="paellaSkin";paella.utils.styleSheet.removeById(skinId),paella.utils.styleSheet.add(paella.utils.folders.skins()+"/style_"+skinName+".css"),base.cookies.set("skin",skinName)},restore:function(defaultSkin){var storedSkin=base.cookies.get("skin");storedSkin&&""!=storedSkin?this.set(storedSkin):this.set(defaultSkin)}},timeParse:{timeToSeconds:function(timeString){var hours=0,minutes=0,seconds=0;return/([0-9]+)h/i.test(timeString)&&(hours=60*parseInt(RegExp.$1)*60),/([0-9]+)m/i.test(timeString)&&(minutes=60*parseInt(RegExp.$1)),/([0-9]+)s/i.test(timeString)&&(seconds=parseInt(RegExp.$1)),hours+minutes+seconds},secondsToTime:function(seconds){var hrs=~~(seconds/3600);hrs<10&&(hrs="0"+hrs);var mins=~~(seconds%3600/60);mins<10&&(mins="0"+mins);var secs=Math.floor(seconds%60);return secs<10&&(secs="0"+secs),hrs+":"+mins+":"+secs},secondsToText:function(secAgo){if(secAgo<=1)return base.dictionary.translate("1 second ago");if(secAgo<60)return base.dictionary.translate("{0} seconds ago").replace(/\{0\}/g,secAgo);var minAgo=Math.round(secAgo/60);if(minAgo<=1)return base.dictionary.translate("1 minute ago");if(minAgo<60)return base.dictionary.translate("{0} minutes ago").replace(/\{0\}/g,minAgo);var hourAgo=Math.round(secAgo/3600);if(hourAgo<=1)return base.dictionary.translate("1 hour ago");if(hourAgo<24)return base.dictionary.translate("{0} hours ago").replace(/\{0\}/g,hourAgo);var daysAgo=Math.round(secAgo/86400);if(daysAgo<=1)return base.dictionary.translate("1 day ago");if(daysAgo<24)return base.dictionary.translate("{0} days ago").replace(/\{0\}/g,daysAgo);var monthsAgo=Math.round(secAgo/2592e3);if(monthsAgo<=1)return base.dictionary.translate("1 month ago");if(monthsAgo<12)return base.dictionary.translate("{0} months ago").replace(/\{0\}/g,monthsAgo);var yearsAgo=Math.round(secAgo/31536e3);return yearsAgo<=1?base.dictionary.translate("1 year ago"):base.dictionary.translate("{0} years ago").replace(/\{0\}/g,yearsAgo)},matterhornTextDateToDate:function(mhdate){var d=new Date;return d.setFullYear(parseInt(mhdate.substring(0,4),10)),d.setMonth(parseInt(mhdate.substring(5,7),10)-1),d.setDate(parseInt(mhdate.substring(8,10),10)),d.setHours(parseInt(mhdate.substring(11,13),10)),d.setMinutes(parseInt(mhdate.substring(14,16),10)),d.setSeconds(parseInt(mhdate.substring(17,19),10)),d}}},Class("paella.DataDelegate",{read:function(context,params,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)},write:function(context,params,value,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)},remove:function(context,params,onSuccess){"function"==typeof onSuccess&&onSuccess({},!0)}}),paella.dataDelegates={},Class("paella.dataDelegates.CookieDataDelegate",paella.DataDelegate,{initialize:function(){},serializeKey:function(context,params){return"object"==typeof params&&(params=JSON.stringify(params)),context+"|"+params},read:function(context,params,onSuccess){var key=this.serializeKey(context,params),value=base.cookies.get(key);try{value=unescape(value),value=JSON.parse(value)}catch(e){}"function"==typeof onSuccess&&onSuccess(value,!0)},write:function(context,params,value,onSuccess){var key=this.serializeKey(context,params);"object"==typeof value&&(value=JSON.stringify(value)),value=escape(value),base.cookies.set(key,value),"function"==typeof onSuccess&&onSuccess({},!0)},remove:function(context,params,onSuccess){var key=this.serializeKey(context,params);"object"==typeof value&&(value=JSON.stringify(value)),base.cookies.set(key,""),"function"==typeof onSuccess&&onSuccess({},!0)}}),paella.dataDelegates.DefaultDataDelegate=paella.dataDelegates.CookieDataDelegate,Class("paella.Data",{enabled:!1,dataDelegates:{},initialize:function(config){this.enabled=config.data.enabled;for(var key in config.data.dataDelegates)try{var delegateName=config.data.dataDelegates[key],DelegateClass=paella.dataDelegates[delegateName],delegateInstance=new DelegateClass;this.dataDelegates[key]=delegateInstance}catch(e){base.log.debug("Warning: delegate not found - "+delegateName)}this.dataDelegates.default||(this.dataDelegates.default=new paella.dataDelegates.DefaultDataDelegate)},read:function(context,key,onSuccess){var del=this.getDelegate(context);del.read(context,key,onSuccess)},write:function(context,key,params,onSuccess){var del=this.getDelegate(context);del.write(context,key,params,onSuccess)},remove:function(context,key,onSuccess){var del=this.getDelegate(context);del.remove(context,key,onSuccess)},getDelegate:function(context){return this.dataDelegates[context]?this.dataDelegates[context]:this.dataDelegates.default}}),paella.data=null,Class("paella.MessageBox",{modalContainerClassName:"modalMessageContainer",frameClassName:"frameContainer",messageClassName:"messageContainer",errorClassName:"errorContainer",currentMessageBox:null,messageContainer:null,onClose:null,initialize:function(){var thisClass=this;$(window).resize(function(event){thisClass.adjustTop()})},showFrame:function(src,params){var closeButton=!0,width="80%",height="80%",onClose=null;params&&(closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowFrame(src,closeButton,width,height,onClose)},doShowFrame:function(src,closeButton,width,height,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),width||(width="80%"),height||(height="80%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=this.frameClassName,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",modalContainer.appendChild(messageContainer);var iframeContainer=document.createElement("iframe");iframeContainer.src=src,iframeContainer.setAttribute("frameborder","0"),iframeContainer.style.width="100%",iframeContainer.style.height="100%",messageContainer.appendChild(iframeContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},showElement:function(domElement,params){var closeButton=!0,width="60%",height="40%",onClose=null,className=this.messageClassName;params&&(className=params.className,closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowElement(domElement,closeButton,width,height,className,onClose)},showMessage:function(message,params){var closeButton=!0,width="60%",height="40%",onClose=null,className=this.messageClassName;params&&(className=params.className,closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowMessage(message,closeButton,width,height,className,onClose)},doShowElement:function(domElement,closeButton,width,height,className,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),className||(className=this.messageClassName),width||(width="80%"),height||(height="30%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=className,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",messageContainer.appendChild(domElement),modalContainer.appendChild(messageContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},doShowMessage:function(message,closeButton,width,height,className,onClose){this.onClose=onClose,this.currentMessageBox&&this.close(),className||(className=this.messageClassName),width||(width="80%"),height||(height="30%");var modalContainer=document.createElement("div");modalContainer.className=this.modalContainerClassName,modalContainer.style.position="fixed",modalContainer.style.top="0px",modalContainer.style.left="0px",modalContainer.style.right="0px",modalContainer.style.bottom="0px",modalContainer.style.zIndex=999999;var messageContainer=document.createElement("div");messageContainer.className=className,messageContainer.style.width=width,messageContainer.style.height=height,messageContainer.style.position="relative",messageContainer.innerHTML=message,modalContainer.appendChild(messageContainer),$("body")[0].appendChild(modalContainer),this.currentMessageBox=modalContainer,this.messageContainer=messageContainer;this.adjustTop(),closeButton&&this.createCloseButton()},showError:function(message,params){var closeButton=!1,width="60%",height="20%",onClose=null;params&&(closeButton=params.closeButton,width=params.width,height=params.height,onClose=params.onClose),this.doShowError(message,closeButton,width,height,onClose)},doShowError:function(message,closeButton,width,height,onClose){this.doShowMessage(message,closeButton,width,height,this.errorClassName,onClose)},createCloseButton:function(){if(this.messageContainer){var thisClass=this,closeButton=document.createElement("div");this.messageContainer.appendChild(closeButton),closeButton.className="paella_messageContainer_closeButton",$(closeButton).click(function(event){thisClass.onCloseButtonClick()})}},adjustTop:function(){if(this.currentMessageBox){var msgHeight=$(this.messageContainer).outerHeight(),containerHeight=$(this.currentMessageBox).height(),top=containerHeight/2-msgHeight/2;this.messageContainer.style.marginTop=top+"px"}},close:function(){if(this.currentMessageBox&&this.currentMessageBox.parentNode){var msgBox=this.currentMessageBox,parent=msgBox.parentNode;$(msgBox).animate({opacity:0},300,function(){parent.removeChild(msgBox)}),this.onClose&&this.onClose()}},onCloseButtonClick:function(){this.close()}}),paella.messageBox=new paella.MessageBox,paella.AntiXSS={htmlEscape:function(str){return String(str).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")},htmlUnescape:function(value){return String(value).replace(/&quot;/g,'"').replace(/&#39;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&")}},Class("paella.Node",{identifier:"",nodeList:null,initialize:function(id){this.nodeList={},this.identifier=id},addTo:function(parentNode){parentNode.addNode(this)},addNode:function(childNode){return this.nodeList[childNode.identifier]=childNode,childNode},getNode:function(id){return this.nodeList[id]},removeNode:function(childNode){return!!this.nodeList[childNode.identifier]&&(delete this.nodeList[childNode.identifier],!0)}}),Class("paella.DomNode",paella.Node,{domElement:null,initialize:function(elementType,id,style){this.parent(id),this.domElement=document.createElement(elementType),this.domElement.id=id,style&&$(this.domElement).css(style)},addNode:function(childNode){var returnValue=this.parent(childNode);return this.domElement.appendChild(childNode.domElement),returnValue},onresize:function(){},removeNode:function(childNode){this.parent(childNode)&&this.domElement.removeChild(childNode.domElement)}}),Class("paella.Button",paella.DomNode,{isToggle:!1,initialize:function(id,className,action,isToggle){this.isToggle=isToggle;var style={};if(this.parent("div",id,style),this.domElement.className=className,isToggle){var thisClass=this;$(this.domElement).click(function(event){thisClass.toggleIcon()})}$(this.domElement).click("click",action)},isToggled:function(){if(this.isToggle){var element=this.domElement;return/([a-zA-Z0-9_]+)_active/.test(element.className)}return!1},toggle:function(){this.toggleIcon()},toggleIcon:function(){var element=this.domElement;/([a-zA-Z0-9_]+)_active/.test(element.className)?element.className=RegExp.$1:element.className=element.className+"_active"},show:function(){$(this.domElement).show()},hide:function(){$(this.domElement).hide()},visible:function(){return this.domElement.visible()}}),Class("paella.VideoQualityStrategy",{getQualityIndex:function(source){return source.length>0?source[source.length-1]:source}}),Class("paella.BestFitVideoQualityStrategy",paella.VideoQualityStrategy,{getQualityIndex:function(source){var index=source.length-1;if(source.length>0){var selected=source[0],win_w=$(window).width(),win_h=$(window).height(),win_res=win_w*win_h;if(selected.res&&selected.res.w&&selected.res.h)for(var selected_res=parseInt(selected.res.w)*parseInt(selected.res.h),selected_diff=Math.abs(win_res-selected_res),i=0;i<source.length;++i){var res=source[i].res;if(res){var m_res=parseInt(source[i].res.w)*parseInt(source[i].res.h),m_diff=Math.abs(win_res-m_res);m_diff<=selected_diff&&(selected_diff=m_diff,index=i)}}}return index}}),Class("paella.VideoFactory",{isStreamCompatible:function(streamData){return!1},getVideoObject:function(id,streamData,rect){return null}}),paella.videoFactory={_factoryList:[],initFactories:function(){if(paella.videoFactories){var This=this;paella.player.config.player.methods.forEach(function(method){method.enabled&&This.registerFactory(new paella.videoFactories[method.factory])}),this.registerFactory(new paella.videoFactories.EmptyVideoFactory)}},getVideoObject:function(id,streamData,rect){0==this._factoryList.length&&this.initFactories();var selectedFactory=null;return this._factoryList.some(function(factory){if(factory.isStreamCompatible(streamData))return selectedFactory=factory,!0})?selectedFactory.getVideoObject(id,streamData,rect):null},registerFactory:function(factory){this._factoryList.push(factory)}},paella.Profiles={profileList:null,getDefaultProfile:function(){if(paella.player&&paella.player.config&&paella.player.config.defaultProfile)return paella.player.config.defaultProfile},loadProfile:function(profileName,onSuccessFunction){var defaultProfile=this.getDefaultProfile();this.loadProfileList(function(data){var profileData;if(data[profileName])profileData=data[profileName];else{if(!data[defaultProfile])return base.log.debug("Error loading the default profile. Check your Paella Player configuration"),!1;profileData=data[defaultProfile],base.cookies.set("lastProfile",defaultProfile)}onSuccessFunction(profileData)})},loadProfileList:function(onSuccessFunction){var thisClass=this;if(null==this.profileList){var params={url:paella.utils.folders.profiles()+"/profiles.json"};base.ajax.get(params,function(data,mimetype,code){"string"==typeof data&&(data=JSON.parse(data)),thisClass.profileList=data,onSuccessFunction(thisClass.profileList)},function(data,mimetype,code){base.log.debug("Error loading video profiles. Check your Paella Player configuration")})}else onSuccessFunction(thisClass.profileList)}},Class("paella.RelativeVideoSize",{w:1280,h:720,proportionalHeight:function(newWidth){return Math.floor(this.h*newWidth/this.w)},proportionalWidth:function(newHeight){return Math.floor(this.w*newHeight/this.h)},percentVSize:function(pxSize){return 100*pxSize/this.h},percentWSize:function(pxSize){return 100*pxSize/this.w},aspectRatio:function(){return this.w/this.h}}),Class("paella.VideoRect",paella.DomNode,{_rect:null,initialize:function(id,domType,left,top,width,height){this._rect={left:left,top:top,width:width,height:height};var relativeSize=new paella.RelativeVideoSize,percentTop=relativeSize.percentVSize(top)+"%",percentLeft=relativeSize.percentWSize(left)+"%",percentWidth=relativeSize.percentWSize(width)+"%",percentHeight=relativeSize.percentVSize(height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute",zIndex:GlobalParams.video.zIndex};this.parent(domType,id,style)},setRect:function(rect,animate){this._rect=JSON.parse(JSON.stringify(rect));var relativeSize=new paella.RelativeVideoSize,percentTop=relativeSize.percentVSize(rect.top)+"%",percentLeft=relativeSize.percentWSize(rect.left)+"%",percentWidth=relativeSize.percentWSize(rect.width)+"%",percentHeight=relativeSize.percentVSize(rect.height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute"};if(animate){this.disableClassName();var thisClass=this;$(this.domElement).animate(style,400,function(){thisClass.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:thisClass})}),this.enableClassNameAfter(400)}else $(this.domElement).css(style),paella.events.trigger(paella.events.setComposition,{video:this})},getRect:function(){return this._rect},disableClassName:function(){this.classNameBackup=this.domElement.className,this.domElement.className=""},enableClassName:function(){this.domElement.className=this.classNameBackup},enableClassNameAfter:function(millis){setTimeout("$('#"+this.domElement.id+"')[0].className = '"+this.classNameBackup+"'",millis)},setVisible:function(visible,animate){"true"==visible&&animate?($(this.domElement).show(),$(this.domElement).animate({opacity:1},300)):"true"!=visible||animate?"false"==visible&&animate?$(this.domElement).animate({opacity:0},300):"false"!=visible||animate||$(this.domElement).hide():$(this.domElement).show()},setLayer:function(layer){this.domElement.style.zIndex=layer}}),Class("paella.VideoElementBase",paella.VideoRect,{_ready:!1,_autoplay:!1,_stream:null,_videoQualityStrategy:null,initialize:function(id,stream,containerType,left,top,width,height){this._stream=stream,this.parent(id,containerType,left,top,width,height),Object.defineProperty(this,"ready",{get:function(){return this._ready}}),this._stream.preview&&this.setPosterFrame(this._stream.preview)},setVideoQualityStrategy:function(strategy){this._videoQualityStrategy=strategy},setPosterFrame:function(url){base.log.debug("TODO: implement setPosterFrame() function")},setAutoplay:function(autoplay){this._autoplay=autoplay},setMetadata:function(data){this._metadata=data},load:function(){return paella_DeferredNotImplemented()},getVideoData:function(){return paella_DeferredNotImplemented()},play:function(){return base.log.debug("TODO: implement play() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},pause:function(){return base.log.debug("TODO: implement pause() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},isPaused:function(){return base.log.debug("TODO: implement isPaused() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},duration:function(){return base.log.debug("TODO: implement duration() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setCurrentTime:function(time){return base.log.debug("TODO: implement setCurrentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},currentTime:function(){return base.log.debug("TODO: implement currentTime() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setVolume:function(volume){return base.log.debug("TODO: implement setVolume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},volume:function(){return base.log.debug("TODO: implement volume() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},setPlaybackRate:function(rate){return base.log.debug("TODO: implement setPlaybackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},playbackRate:function(){return base.log.debug("TODO: implement playbackRate() function in your VideoElementBase subclass"),paella_DeferredNotImplemented()},getQualities:function(){return paella_DeferredNotImplemented()},setQuality:function(index){return paella_DeferredNotImplemented()},getCurrentQuality:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()},goFullScreen:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return paella_DeferredNotImplemented()},setClassName:function(className){this.domElement.className=className},_callReadyEvent:function(){paella.events.trigger(paella.events.singleVideoReady,{sender:this})},_callUnloadEvent:function(){paella.events.trigger(paella.events.singleVideoUnloaded,{sender:this})}}),Class("paella.EmptyVideo",paella.VideoElementBase,{initialize:function(id,stream,left,top,width,height){this.parent(id,stream,"div",left,top,width,height)},setPosterFrame:function(url){},setAutoplay:function(auto){},load:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},play:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},pause:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},isPaused:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},duration:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setCurrentTime:function(time){return paella_DeferredRejected(new Error("no such compatible video player"))},currentTime:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setVolume:function(volume){return paella_DeferredRejected(new Error("no such compatible video player"))},volume:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},setPlaybackRate:function(rate){return paella_DeferredRejected(new Error("no such compatible video player"))},playbackRate:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unFreeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},freeze:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},unload:function(){return paella_DeferredRejected(new Error("no such compatible video player"))},getDimensions:function(){return paella_DeferredRejected(new Error("no such compatible video player"))}}),Class("paella.videoFactories.EmptyVideoFactory",paella.VideoFactory,{isStreamCompatible:function(streamData){return!0},getVideoObject:function(id,streamData,rect){return new paella.EmptyVideo(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.Html5Video",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_streamName:null,initialize:function(id,stream,left,top,width,height,streamName){function onProgress(event){This._ready||4!=This.video.readyState||(This._ready=!0,void 0!==This._initialCurrentTipe&&(This.video.currentTime=This._initialCurrentTime,delete This._initialCurrentTime),This._callReadyEvent())}function evtCallback(event){onProgress.apply(This,event)}this.parent(id,stream,"video",left,top,width,height),this._streamName=streamName||"mp4";var This=this;this._stream.sources[this._streamName]&&this._stream.sources[this._streamName].sort(function(a,b){return a.res.h-b.res.h}),Object.defineProperty(this,"video",{get:function(){return This.domElement}}),this.video.preload="auto",$(this.video).bind("progress",evtCallback),$(this.video).bind("loadstart",evtCallback),$(this.video).bind("loadedmetadata",evtCallback),$(this.video).bind("canplay",evtCallback),$(this.video).bind("oncanplay",evtCallback)},_deferredAction:function(action){var This=this,defer=new $.Deferred;if(This.ready)defer.resolve(action());else{var resolve=function(){This._ready=!0,defer.resolve(action())};$(This.video).bind("canplay",resolve)}return defer},_getQualityObject:function(index,s){return{index:index,res:s.res,src:s.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(q2){return this.res.w*this.res.h-q2.res.w*q2.res.h}}},getVideoData:function(){var defer=$.Deferred(),This=this;return this._deferredAction(function(){var videoData={duration:This.video.duration,currentTime:This.video.currentTime,volume:This.video.volume,paused:This.video.paused,ended:This.video.ended,res:{w:This.video.videoWidth,h:This.video.videoHeight}};defer.resolve(videoData)}),defer},setPosterFrame:function(url){this._posterFrame=url},setAutoplay:function(auto){this._autoplay=auto,auto&&this.video&&this.video.setAttribute("autoplay",auto)},load:function(){var sources=this._stream.sources[this._streamName];null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(sources));var stream=this._currentQuality<sources.length?sources[this._currentQuality]:null;if(stream){var sourceElem=this.video.querySelector("source");return sourceElem||(sourceElem=document.createElement("source"),this.video.appendChild(sourceElem)),this._posterFrame&&this.video.setAttribute("poster",this._posterFrame),sourceElem.src=stream.src,sourceElem.type=stream.type,this.video.load(),this._deferredAction(function(){return stream})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var This=this,defer=$.Deferred();return setTimeout(function(){var result=[],sources=This._stream.sources[This._streamName],index=-1;sources.forEach(function(s){index++,result.push(This._getQualityObject(index,s))}),defer.resolve(result)},10),defer},setQuality:function(index){var defer=$.Deferred(),This=this,paused=This.video.paused,sources=this._stream.sources[this._streamName];this._currentQuality=index<sources.length?index:0;var currentTime=this.video.currentTime;return this.freeze().then(function(){return This._ready=!1,This.load()}).then(function(){paused||This.play(),$(This.video).on("seeked",function(){This.unFreeze(),defer.resolve(),$(This.video).off("seeked")}),This.video.currentTime=currentTime}),defer},getCurrentQuality:function(){var defer=$.Deferred();return defer.resolve(this._getQualityObject(this._currentQuality,this._stream.sources[this._streamName][this._currentQuality])),defer},play:function(){var This=this;return this._deferredAction(function(){This.video.play()})},pause:function(){var This=this;return this._deferredAction(function(){This.video.pause()})},isPaused:function(){var This=this;return this._deferredAction(function(){return This.video.paused})},duration:function(){var This=this;return this._deferredAction(function(){return This.video.duration})},setCurrentTime:function(time){var This=this;return this._deferredAction(function(){This.video.currentTime=time})},currentTime:function(){var This=this;return this._deferredAction(function(){return This.video.currentTime})},setVolume:function(volume){var This=this;return this._deferredAction(function(){This.video.volume=volume;
})},volume:function(){var This=this;return this._deferredAction(function(){return This.video.volume})},setPlaybackRate:function(rate){var This=this;return this._deferredAction(function(){This.video.playbackRate=rate})},playbackRate:function(){var This=this;return this._deferredAction(function(){return This.video.playbackRate})},goFullScreen:function(){var This=this;return this._deferredAction(function(){var elem=This.video;elem.requestFullscreen?elem.requestFullscreen():elem.msRequestFullscreen?elem.msRequestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitEnterFullscreen&&elem.webkitEnterFullscreen()})},unFreeze:function(){var This=this;return this._deferredAction(function(){var c=document.getElementById(This.video.className+"canvas");$(c).remove()})},freeze:function(){var This=this;return this._deferredAction(function(){var canvas=document.createElement("canvas");canvas.id=This.video.className+"canvas",canvas.width=This.video.videoWidth,canvas.height=This.video.videoHeight,canvas.style.cssText=This.video.style.cssText,canvas.style.zIndex=2;var ctx=canvas.getContext("2d");ctx.drawImage(This.video,0,0,16*Math.ceil(canvas.width/16),16*Math.ceil(canvas.height/16)),This.video.parentElement.appendChild(canvas)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.Html5VideoFactory",{isStreamCompatible:function(streamData){try{if(paella.videoFactories.Html5VideoFactory.s_instances>0&&base.userAgent.system.iOS)return!1;for(var key in streamData.sources)if("mp4"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.Html5Video(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),paella.videoFactories.Html5VideoFactory.s_instances=0,Class("paella.ImageVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_currentTime:0,_duration:0,_ended:!1,_playTimer:null,_playbackRate:1,_frameArray:null,initialize:function(id,stream,left,top,width,height){this.parent(id,stream,"img",left,top,width,height);var This=this;this._stream.sources.image.sort(function(a,b){return a.res.h-b.res.h}),Object.defineProperty(this,"img",{get:function(){return This.domElement}}),Object.defineProperty(this,"imgStream",{get:function(){return this._stream.sources.image[this._currentQuality]}}),Object.defineProperty(this,"_paused",{get:function(){return null==this._playTimer}})},_deferredAction:function(action){var This=this,defer=new $.Deferred;if(This.ready)defer.resolve(action());else{var resolve=function(){This._ready=!0,defer.resolve(action())};$(This.video).bind("paella:imagevideoready",resolve)}return defer},_getQualityObject:function(index,s){return{index:index,res:s.res,src:s.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(q2){return this.res.w*this.res.h-q2.res.w*q2.res.h}}},_loadCurrentFrame:function(){var This=this;if(this._frameArray){var frame=this._frameArray[0];this._frameArray.some(function(f){return This._currentTime<f.time||void(frame=f.src)}),this.img.src=frame}},getVideoData:function(){var defer=$.Deferred(),This=this;return this._deferredAction(function(){var videoData={duration:This._duration,currentTime:This._currentTime,volume:0,paused:This._paused,ended:This._ended,res:{w:This.imgStream.res.w,h:This.imgStream.res.h}};defer.resolve(videoData)}),defer},setPosterFrame:function(url){this._posterFrame=url},setAutoplay:function(auto){this._autoplay=auto,auto&&this.video&&this.video.setAttribute("autoplay",auto)},load:function(){var sources=this._stream.sources.image;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(sources));var stream=this._currentQuality<sources.length?sources[this._currentQuality]:null;if(stream){this._frameArray=[];for(var key in stream.frames){var time=Math.floor(Number(key.replace("frame_","")));this._frameArray.push({src:stream.frames[key],time:time})}return this._frameArray.sort(function(a,b){return a.time-b.time}),this._ready=!0,this._currentTime=0,this._duration=stream.duration,this._loadCurrentFrame(),paella.events.trigger("paella:imagevideoready"),this._deferredAction(function(){return stream})}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var This=this,defer=$.Deferred();return setTimeout(function(){var result=[],sources=This._stream.sources[This._streamName],index=-1;sources.forEach(function(s){index++,result.push(This._getQualityObject(index,s))}),defer.resolve(result)},10),defer},setQuality:function(index){var defer=$.Deferred(),This=this,sources=(this._paused,this._stream.sources.image);this._currentQuality=index<sources.length?index:0;this._currentTime;return This.load().then(function(){This._loadCurrentFrame(),defer.resolve()}),defer},getCurrentQuality:function(){var defer=$.Deferred();return defer.resolve(this._getQualityObject(this._currentQuality,this._stream.sources.image[this._currentQuality])),defer},play:function(){var This=this;return this._deferredAction(function(){This._playTimer=new base.Timer(function(){This._currentTime+=.25*This._playbackRate,This._loadCurrentFrame()},250),This._playTimer.repeat=!0})},pause:function(){var This=this;return this._deferredAction(function(){This._playTimer.repeat=!1,This._playTimer=null})},isPaused:function(){var This=this;return this._deferredAction(function(){return This._paused})},duration:function(){var This=this;return this._deferredAction(function(){return This._duration})},setCurrentTime:function(time){var This=this;return this._deferredAction(function(){This._currentTime=time})},currentTime:function(){var This=this;return this._deferredAction(function(){return This._currentTime})},setVolume:function(volume){return this._deferredAction(function(){})},volume:function(){return this._deferredAction(function(){return 0})},setPlaybackRate:function(rate){var This=this;return this._deferredAction(function(){This._playbackRate=rate})},playbackRate:function(){var This=this;return this._deferredAction(function(){return This._playbackRate})},goFullScreen:function(){var This=this;return this._deferredAction(function(){var elem=This.img;elem.requestFullscreen?elem.requestFullscreen():elem.msRequestFullscreen?elem.msRequestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitEnterFullscreen&&elem.webkitEnterFullscreen()})},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.ImageVideoFactory",{isStreamCompatible:function(streamData){try{for(var key in streamData.sources)if("image"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return new paella.ImageVideo(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.BackgroundContainer",paella.DomNode,{initialize:function(id,image){this.parent("img",id,{position:"relative",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:GlobalParams.background.zIndex}),this.domElement.setAttribute("src",image),this.domElement.setAttribute("alt",""),this.domElement.setAttribute("width","100%"),this.domElement.setAttribute("height","100%")},setImage:function(image){this.domElement.setAttribute("src",image)}}),Class("paella.VideoOverlay",paella.DomNode,{size:{w:1280,h:720},initialize:function(){var style={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden",zIndex:10};this.parent("div","overlayContainer",style),this.domElement.setAttribute("role","main")},_generateId:function(){return Math.ceil(Date.now()*Math.random())},enableBackgroundMode:function(){this.domElement.className="overlayContainer background"},disableBackgroundMode:function(){this.domElement.className="overlayContainer"},clear:function(){this.domElement.innerHTML=""},getMasterRect:function(){return paella.player.videoContainer.getMasterVideoRect()},getSlaveRect:function(){return paella.player.videoContainer.getSlaveVideoRect()},addText:function(text,rect,isDebug){var textElem=document.createElement("div");return textElem.innerHTML=text,textElem.className="videoOverlayText",isDebug&&(textElem.style.backgroundColor="red"),this.addElement(textElem,rect)},addElement:function(element,rect){return this.domElement.appendChild(element),element.style.position="absolute",element.style.left=this.getHSize(rect.left)+"%",element.style.top=this.getVSize(rect.top)+"%",element.style.width=this.getHSize(rect.width)+"%",element.style.height=this.getVSize(rect.height)+"%",element},getLayer:function(id,zindex){return id=id||this._generateId(),$(this.domElement).find("#"+id)[0]||this.addLayer(id,zindex)},addLayer:function(id,zindex){zindex=zindex||10;var element=document.createElement("div");return element.className="row",element.id=id||this._generateId(),this.addElement(element,{left:0,top:0,width:1280,height:720})},removeLayer:function(id){var elem=$(this.domElement).find("#"+id)[0];elem&&this.domElement.removeChild(elem)},removeElement:function(element){if(element)try{this.domElement.removeChild(element)}catch(e){}},getVSize:function(px){return 100*px/this.size.h},getHSize:function(px){return 100*px/this.size.w}}),Class("paella.VideoContainerBase",paella.DomNode,{_trimming:{enabled:!1,start:0,end:0},timeupdateEventTimer:null,timeupdateInterval:250,masterVideoData:null,slaveVideoData:null,currentMasterVideoData:null,currentSlaveVideoData:null,_force:!1,initialize:function(id){var self=this,style={position:"absolute",left:"0px",right:"0px",top:"0px",bottom:"0px",overflow:"hidden"};this.parent("div",id,style),$(this.domElement).click(function(evt){self.firstClick&&base.userAgent.browser.IsMobileVersion||paella.player.videoContainer.paused().then(function(paused){self.firstClick=!0,paused?paella.player.play():paella.player.pause()})}),this.domElement.addEventListener("touchstart",function(event){paella.player.controls&&paella.player.controls.restartHideTimer()})},triggerTimeupdate:function(){var This=this,paused=0,duration=0;this.paused().then(function(p){return paused=p,This.duration()}).then(function(d){return duration=d,This.currentTime()}).then(function(currentTime){paused&&!This._force||(This._force=!1,paella.events.trigger(paella.events.timeupdate,{videoContainer:This,currentTime:currentTime,duration:duration}))})},startTimeupdate:function(){var thisClass=this;this.timeupdateEventTimer=new Timer(function(timer){thisClass.triggerTimeupdate()},this.timeupdateInterval),this.timeupdateEventTimer.repeat=!0},stopTimeupdate:function(){this.timeupdateEventTimer&&(this.timeupdateEventTimer.repeat=!1),this.timeupdateEventTimer=null},play:function(){paella.events.trigger(paella.events.play),this.startTimeupdate()},pause:function(){paella.events.trigger(paella.events.pause),this.stopTimeupdate()},seekTo:function(newPositionPercent){var thisClass=this;this.setCurrentPercent(newPositionPercent),thisClass._force=!0,this.triggerTimeupdate(),paella.events.trigger(paella.events.seekTo,{newPositionPercent:newPositionPercent})},seekToTime:function(time){this.setCurrentTime(time),this._force=!0,this.triggerTimeupdate()},setPlaybackRate:function(params){},setVolume:function(params){},volume:function(){return 1},trimStart:function(){var defer=$.Deferred();return defer.resolve(this._trimming.start),defer},trimEnd:function(){var defer=$.Deferred();return defer.resolve(this._trimming.end),defer},trimEnabled:function(){var defer=$.Deferred();return defer.resolve(this._trimming.enabled),defer},trimming:function(){var defer=$.Deferred();return defer.resolve(this._trimming),defer},enableTrimming:function(){this._trimming.enabled=!0,paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},disableTrimming:function(){this._trimming.enabled=!1,paella.events.trigger(paella.events.setTrim,{trimEnabled:this._trimming.enabled,trimStart:this._trimming.start,trimEnd:this._trimming.end})},setTrimming:function(start,end){var This=this,defer=$.Deferred(),currentTime=0,duration=0;return this.currentTime().then(function(c){return currentTime=c,This.duration()}).then(function(d){duration=d,This._trimming.start=start,This._trimming.end=end,currentTime<This._trimming.start&&This.setCurrentTime(This._trimming.start),currentTime>This._trimming.end&&This.setCurrentTime(This._trimming.end),paella.events.trigger(paella.events.setTrim,{trimEnabled:This._trimming.enabled,trimStart:This._trimming.start,trimEnd:This._trimming.end}),defer.resolve()}),defer},setTrimmingStart:function(start){return this.setTrimming(start,this._trimming.end)},setTrimmingEnd:function(end){return this.setTrimming(this._trimming.start,end)},setCurrentPercent:function(percent){var This=this,duration=0;this.duration().then(function(d){return duration=d,This.trimming()}).then(function(trimming){var position=0;if(trimming.enabled){var start=trimming.start,end=trimming.end;duration=end-start;var trimedPosition=percent*duration/100;position=parseFloat(trimedPosition)+parseFloat(start)}else position=percent*duration/100;return This.setCurrentTime(position)})},setCurrentTime:function(time){base.log.debug("VideoContainerBase.setCurrentTime("+time+")")},currentTime:function(){return base.log.debug("VideoContainerBase.currentTime()"),0},duration:function(){return base.log.debug("VideoContainerBase.duration()"),0},paused:function(){return base.log.debug("VideoContainerBase.paused()"),!0},setupVideo:function(onSuccess){base.log.debug("VideoContainerBase.setupVide()")},isReady:function(){return base.log.debug("VideoContainerBase.isReady()"),!0},onresize:function(){this.parent(onresize)}}),Class("paella.ProfileFrameStrategy",{valid:function(){return!0},adaptFrame:function(videoDimensions,frameRect){return frameRect}}),Class("paella.LimitedSizeProfileFrameStrategy",paella.ProfileFrameStrategy,{adaptFrame:function(videoDimensions,frameRect){if(videoDimensions.width<frameRect.width||videoDimensions.height<frameRect.height){var frameRectCopy=JSON.parse(JSON.stringify(frameRect));frameRectCopy.width=videoDimensions.width,frameRectCopy.height=videoDimensions.height;var diff={w:frameRect.width-videoDimensions.width,h:frameRect.height-videoDimensions.height};return frameRectCopy.top=frameRectCopy.top+diff.h/2,frameRectCopy.left=frameRectCopy.left+diff.w/2,frameRectCopy}return frameRect}}),Class("paella.VideoContainer",paella.VideoContainerBase,{containerId:"",video1Id:"",video2Id:"",backgroundId:"",container:null,profileFrameStrategy:null,videoClasses:{master:"video masterVideo",slave:"video slaveVideo"},isHidden:!1,logos:null,overlayContainer:null,videoSyncTimeMillis:5e3,currentMasterVideoRect:{},currentSlaveVideoRect:{},_maxSyncDelay:.5,_isMonostream:!1,_videoQualityStrategy:null,_sourceData:null,_isMasterReady:!1,_isSlaveReady:!1,_firstLoad:!1,_playOnLoad:!1,_seekToOnLoad:0,_defaultMasterVolume:1,_defaultSlaveVolume:1,_showPosterFrame:!0,_currentProfile:null,initialize:function(id){this.parent(id);var thisClass=this;this._sourceData=[],this.containerId=id+"_container",this.video1Id=id+"_1",this.video2Id=id+"_2",this.backgroundId=id+"_bkg",this.logos=[],this._videoQualityStrategy=new paella.VideoQualityStrategy,this.container=new paella.DomNode("div",this.containerId,{position:"relative",display:"block",marginLeft:"auto",marginRight:"auto",width:"1024px",height:"567px"}),this.container.domElement.setAttribute("role","main"),this.addNode(this.container),this.overlayContainer=new paella.VideoOverlay(this.domElement),this.container.addNode(this.overlayContainer),this.container.addNode(new paella.BackgroundContainer(this.backgroundId,paella.utils.folders.profiles()+"/resources/default_background_paella.jpg")),Object.defineProperty(this,"sourceData",{get:function(){return this._sourceData}});var timer=new base.Timer(function(timer){thisClass.syncVideos()},thisClass.videoSyncTimeMillis);timer.repeat=!0;var config=paella.player.config;try{var StrategyClass=config.player.profileFrameStrategy,ClassObject=Class.fromString(StrategyClass),strategy=new ClassObject;dynamic_cast("paella.ProfileFrameStrategy",strategy)&&this.setProfileFrameStrategy(strategy)}catch(e){}Object.defineProperty(this,"ready",{get:function(){return this._isMasterReady&&this._isSlaveReady}}),Object.defineProperty(this,"isMonostream",{get:function(){return this._isMonostream}})},setVideoQualityStrategy:function(strategy){this._videoQualityStrategy=strategy,this.masterVideo()&&this.masterVideo().setVideoQualityStrategy(this._videoQualityStrategy),this.slaveVideo()&&slaveVideo.setVideoQualityStrategy(this._videoQualityStrategy)},setProfileFrameStrategy:function(strategy){this.profileFrameStrategy=strategy},getMasterVideoRect:function(){return this.currentMasterVideoRect},getSlaveVideoRect:function(){return this.currentSlaveVideoRect},setHidden:function(hidden){this.isHidden=hidden},hideVideo:function(){this.setHidden(!0)},publishVideo:function(){this.setHidden(!1)},syncVideos:function(){var This=this,masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo(),masterCurrent=0,slaveCurrent=0;!this._isMonostream&&masterVideo&&slaveVideo&&masterVideo.currentTime().then(function(m){return masterCurrent=m,slaveVideo.currentTime()}).then(function(s){slaveCurrent=s;var diff=Math.abs(masterCurrent-slaveCurrent);diff>This._maxSyncDelay&&(base.log.debug("Sync videos performed, diff="+diff),slaveVideo.setCurrentTime(masterCurrent))})},checkVideoBounds:function(trimming,current,paused,actualDuration){var start=trimming.start,end=trimming.end,enabled=trimming.enabled;enabled?current>=Math.floor(end)&&!paused?(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause()):current<start&&this.setCurrentTime(start+1):current>=actualDuration&&(paella.events.trigger(paella.events.endVideo,{videoContainer:this}),this.pause())},play:function(){var This=this,defer=$.Deferred();this._firstLoad?this._playOnLoad=!0:this._firstLoad=!0;var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();return masterVideo?masterVideo.play().then(function(){slaveVideo&&slaveVideo.play(),This.parent(),defer.resolve()}):defer.reject(new Error("Invalid master video")),defer},pause:function(){var This=this,defer=$.Deferred(),masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();return masterVideo?masterVideo.pause().then(function(){slaveVideo&&slaveVideo.pause(),This.parent(),defer.resolve()}):defer.reject(new Error("invalid master video")),defer},next:function(){0!==this._trimming.end?this.setCurrentTime(this._trimming.end):this.duration(!0).then(function(d){this.setCurrentTime(d)}),this.parent()},previous:function(){this.setCurrentTime(this._trimming.start),this.parent()},setCurrentTime:function(time){this._trimming.enabled&&(time<this._trimming.start&&(time=this._trimming.start),time>this._trimming.end&&(time=this._trimming.end)),this.masterVideo().setCurrentTime(time),this.slaveVideo()&&this.slaveVideo().setCurrentTime(time),this.parent()},currentTime:function(){if(this._trimming.enabled){var trimStart=this._trimming.start,defer=$.Deferred();return this.masterVideo().currentTime().then(function(t){defer.resolve(t-trimStart)}),defer}return this.masterVideo().currentTime()},setPlaybackRate:function(rate){var masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo();masterVideo&&masterVideo.setPlaybackRate(rate),slaveVideo&&slaveVideo.setPlaybackRate(rate),this.parent()},setVolume:function(params){function setVolumes(){"object"==typeof params?(masterVolume=void 0!==params.master?params.master:masterVolume,slaveVolume=void 0!==params.slave?params.slave:slaveVolume):(masterVolume=params,slaveVolume=0),masterVideo.setVolume(masterVolume),slaveVideo&&slaveVideo.setVolume(slaveVolume),paella.events.trigger(paella.events.setVolume,{master:masterVolume,slave:slaveVolume})}var defer=$.Deferred(),masterVideo=this.masterVideo(),slaveVideo=this.slaveVideo(),masterVolume=0,slaveVolume=0;return masterVideo.volume().then(function(v){return masterVolume=v,slaveVideo?slaveVideo.volume():0}).then(function(v){slaveVolume=v,setVolumes(),defer.resolve(params)}),defer},volume:function(video){return video?"master"==video&&this.masterVideo()?this.masterVideo().volume():"slave"==video&&this.slaveVideo()?this.slaveVideo().volume():void 0:this.masterVideo().volume()},setDefaultMasterVolume:function(vol){this._defaultMasterVolume=vol},setDefaultSlaveVolume:function(vol){this._defaultSlaveVolume=vol},masterVideo:function(){return this.container.getNode(this.video1Id)},slaveVideo:function(){return this.container.getNode(this.video2Id)},duration:function(ignoreTrimming){var This=this;return this.masterVideo().duration().then(function(d){return This._trimming.enabled&&!ignoreTrimming&&(d=This._trimming.end-This._trimming.start),d})},paused:function(){return this.masterVideo().isPaused()},trimEnabled:function(){return this._trimming.enabled},trimStart:function(){return this._trimming.enabled?this._trimming.start:0},trimEnd:function(){return this._trimming.enabled?this._trimming.end:this.duration()},getQualities:function(){var defer=$.Deferred();return this.masterVideo().getQualities().then(function(q){defer.resolve(q)}),defer},setQuality:function(index){function doSetQuality(){var masterIndex=index<masterQualities.length?index:masterQualities.length-1,slaveIndex=index<slaveQualities.length?index:slaveQualities.length-1;This.masterVideo().setQuality(masterIndex).then(function(){return This.slaveVideo()?This.slaveVideo().setQuality(slaveIndex):paella_DeferredResolved()}).then(function(){paella.events.trigger(paella.events.qualityChanged),defer.resolve()})}var masterQualities=[],slaveQualities=[],defer=$.Deferred(),This=this;return this.masterVideo().getQualities().then(function(q){return masterQualities=q,This.slaveVideo()?This.slaveVideo().getQualities():paella_DeferredResolved()}).then(function(q){slaveQualities=q||[],doSetQuality()}),defer},getCurrentQuality:function(){return this.masterVideo().getCurrentQuality()},setStartTime:function(time){this.seekToTime(time)},setStreamData:function(videoData){var This=this;this._sourceData=videoData;var overlayLoader=document.createElement("div");overlayLoader.className="videoLoaderOverlay",this.overlayContainer.addElement(overlayLoader,{left:0,top:0,width:1280,height:720});var masterRect=videoData.length>1?{x:850,y:140,w:360,h:550}:{x:0,y:0,w:1280,h:720},slaveRect={x:10,y:40,w:800,h:600};this._isMonostream=1==videoData.length;var masterVideoData=videoData.length>0?videoData[0]:{sources:[]},slaveVideoData=videoData.length>1?videoData[1]:{sources:[]},masterVideo=paella.videoFactory.getVideoObject(this.video1Id,masterVideoData,masterRect),slaveVideo=paella.videoFactory.getVideoObject(this.video2Id,slaveVideoData,slaveRect),autoplay=this.autoplay();return masterVideo.setAutoplay(autoplay),slaveVideo.setAutoplay(autoplay),masterVideo.setVideoQualityStrategy(this._videoQualityStrategy),slaveVideo.setVideoQualityStrategy(this._videoQualityStrategy),this.container.addNode(masterVideo),videoData.length>1&&this.container.addNode(slaveVideo),masterVideo.load().then(function(){return videoData.length>1?slaveVideo.load():paella_DeferredResolved(!0)}).then(function(){$(masterVideo.video).bind("timeupdate",function(evt){var trimming=This._trimming,current=evt.currentTarget.currentTime,duration=evt.currentTarget.duration;trimming.enabled&&(current-=trimming.start,duration=trimming.end-trimming.start),paella.events.trigger(paella.events.timeupdate,{videoContainer:This,currentTime:current,duration:duration}),This.checkVideoBounds(trimming,evt.currentTarget.currentTime,evt.currentTarget.paused,duration)}),This.overlayContainer.removeElement(overlayLoader),This._isMasterReady=!0,This._isSlaveReady=!0;var config=paella.player.config,masterVolume=config.player.audio&&void 0!=config.player.audio.master?config.player.audio.master:1,slaveVolume=config.player.audio&&void 0!=config.player.audio.slave?config.player.audio.slave:0;masterVideo.setVolume(masterVolume),videoData.length>1&&slaveVideo.setVolume(slaveVolume),paella.events.trigger(paella.events.videoReady);var getProfile=base.parameters.get("profile"),cookieProfile=base.cookies.get("lastProfile");return getProfile?This.setProfile(getProfile,!1):cookieProfile?This.setProfile(cookieProfile,!1):This.setProfile(paella.Profiles.getDefaultProfile(),!1)})},setAutoplay:function(){this._autoplay=!0,this.masterVideo()&&this.masterVideo().setAutoplay(!0),this.slaveVideo()&&this.slaveVideo().setAutoplay(!0)},autoplay:function(){return"true"==base.parameters.get("autoplay")&&paella.player.config.experimental&&paella.player.config.experimental.autoplay&&!base.userAgent.browser.IsMobileVersion},numberOfStreams:function(){return this._sourceData.length},getMonostreamMasterProfile:function(){return{content:"presenter",visible:!0,layer:1,rect:[{aspectRatio:"16/9",left:0,top:0,width:1280,height:720},{aspectRatio:"4/3",left:160,top:0,width:960,height:720}]}},getMonostreamSlaveProfile:function(){return{content:"slides",visible:!1,layer:0,rect:[{aspectRatio:"16/9",left:0,top:0,width:0,height:0},{aspectRatio:"4/3",left:0,top:0,width:0,height:0}]}},getCurrentProfileName:function(){return this._currentProfile},setProfile:function(profileName,animate){var This=this,defer=$.Deferred();return animate=!base.userAgent.browser.Explorer&&animate,paella.Profiles.loadProfile(profileName,function(profileData){This._currentProfile=profileName,1==This.numberOfStreams()&&(profileData.masterVideo=This.getMonostreamMasterProfile(),profileData.slaveVideo=This.getMonostreamSlaveProfile()),This.applyProfileWithJson(profileData,animate),base.cookies.set("lastProfile",profileName),defer.resolve(profileName)}),defer},hideAllLogos:function(){for(var i=0;i<this.logos.length;++i){var logoId=this.logos[i],logo=this.container.getNode(logoId);$(logo.domElement).hide()}},showLogos:function(logos){if(void 0!=logos)for(var relativeSize=new paella.RelativeVideoSize,i=0;i<logos.length;++i){var logo=logos[i],logoId=logo.content,logoNode=this.container.getNode(logoId),rect=logo.rect;logoNode?$(logoNode.domElement).show():(style={},logoNode=this.container.addNode(new paella.DomNode("img",logoId,style)),logoNode.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+logoId),logoNode.domElement.setAttribute("src",paella.utils.folders.profiles()+"/resources/"+logoId));var percentTop=relativeSize.percentVSize(rect.top)+"%",percentLeft=relativeSize.percentWSize(rect.left)+"%",percentWidth=relativeSize.percentWSize(rect.width)+"%",percentHeight=relativeSize.percentVSize(rect.height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute",zIndex:logo.zIndex};$(logoNode.domElement).css(style)}},getClosestRect:function(profileData,videoDimensions){var minDiff=10,re=/([0-9]+)\/([0-9]+)/,result=profileData.rect[0],videoAspectRatio=0==videoDimensions.h?1.333333:videoDimensions.w/videoDimensions.h,profileAspectRatio=1;return profileData.rect.forEach(function(rect){(reResult=re.exec(rect.aspectRatio))&&(profileAspectRatio=Number(reResult[1])/Number(reResult[2]));var diff=Math.abs(profileAspectRatio-videoAspectRatio);minDiff>diff&&(minDiff=diff,result=rect)}),result},applyProfileWithJson:function(profileData,animate){var doApply=function(masterData,slaveData){void 0==animate&&(animate=!0);var video1=this.masterVideo(),video2=this.slaveVideo(),background=this.container.getNode(this.backgroundId),masterDimensions=masterData.res,slaveDimensions=slaveData&&slaveData.res,rectMaster=this.getClosestRect(profileData.masterVideo,masterData.res),rectSlave=slaveData&&this.getClosestRect(profileData.slaveVideo,slaveData.res);if(this.hideAllLogos(),this.showLogos(profileData.logos),dynamic_cast("paella.ProfileFrameStrategy",this.profileFrameStrategy)){var containerSize={width:$(this.domElement).width(),height:$(this.domElement).height()},scaleFactor=rectMaster.width/containerSize.width,scaledMaster={width:masterDimensions.w*scaleFactor,height:masterDimensions.h*scaleFactor};if(rectMaster.left=Number(rectMaster.left),rectMaster.top=Number(rectMaster.top),rectMaster.width=Number(rectMaster.width),rectMaster.height=Number(rectMaster.height),rectMaster=this.profileFrameStrategy.adaptFrame(scaledMaster,rectMaster),video2){var scaledSlave={width:slaveDimensions.w*scaleFactor,height:slaveDimensions.h*scaleFactor};rectSlave.left=Number(rectSlave.left),rectSlave.top=Number(rectSlave.top),rectSlave.width=Number(rectSlave.width),rectSlave.height=Number(rectSlave.height),rectSlave=this.profileFrameStrategy.adaptFrame(scaledSlave,rectSlave)}}video1.setRect(rectMaster,animate),this.currentMasterVideoRect=rectMaster,video1.setVisible(profileData.masterVideo.visible,animate),this.currentMasterVideoRect.visible=!!/true/i.test(profileData.masterVideo.visible),this.currentMasterVideoRect.layer=parseInt(profileData.masterVideo.layer),video2&&(video2.setRect(rectSlave,animate),this.currentSlaveVideoRect=rectSlave,this.currentSlaveVideoRect.visible=!!/true/i.test(profileData.slaveVideo.visible),this.currentSlaveVideoRect.layer=parseInt(profileData.slaveVideo.layer),video2.setVisible(profileData.slaveVideo.visible,animate),video2.setLayer(profileData.slaveVideo.layer)),video1.setLayer(profileData.masterVideo.layer),background.setImage(paella.utils.folders.profiles()+"/resources/"+profileData.background.content)},This=this;if(this.masterVideo())if(this.slaveVideo()){var masterVideoData={};this.masterVideo().getVideoData().then(function(data){return masterVideoData=data,This.slaveVideo().getVideoData()}).then(function(slaveVideoData){doApply.apply(This,[masterVideoData,slaveVideoData])})}else this.masterVideo().getVideoData().then(function(data){doApply.apply(This,[data])})},resizePortrail:function(){var width=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),relativeSize=new paella.RelativeVideoSize,height=relativeSize.proportionalHeight(width);this.container.domElement.style.width=width+"px",this.container.domElement.style.height=height+"px";var containerHeight=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),newTop=containerHeight/2-height/2;this.container.domElement.style.top=newTop+"px"},resizeLandscape:function(){var height=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),relativeSize=new paella.RelativeVideoSize,width=relativeSize.proportionalWidth(height);this.container.domElement.style.width=width+"px",this.container.domElement.style.height=height+"px",this.container.domElement.style.top="0px"},onresize:function(){this.parent();var relativeSize=new paella.RelativeVideoSize,aspectRatio=relativeSize.aspectRatio(),width=1==paella.player.isFullScreen()?$(window).width():$(this.domElement).width(),height=1==paella.player.isFullScreen()?$(window).height():$(this.domElement).height(),containerAspectRatio=width/height;containerAspectRatio>aspectRatio?this.resizeLandscape():this.resizePortrail()}}),Class("paella.PluginManager",{targets:null,pluginList:[],eventDrivenPlugins:[],enabledPlugins:[],setupPlugin:function(plugin){plugin.setup(),this.enabledPlugins.push(plugin),dynamic_cast("paella.UIPlugin",plugin)&&plugin.checkVisibility()},checkPluginsVisibility:function(){this.enabledPlugins.forEach(function(plugin){dynamic_cast("paella.UIPlugin",plugin)&&plugin.checkVisibility()})},initialize:function(){this.targets={};var This=this;paella.events.bind(paella.events.loadPlugins,function(event){This.loadPlugins("paella.DeferredLoadPlugin")});var timer=new base.Timer(function(){paella.player&&paella.player.controls&&paella.player.controls.onresize()},1e3);timer.repeat=!0},setTarget:function(pluginType,target){target.addPlugin&&(this.targets[pluginType]=target);
},getTarget:function(pluginType){if("eventDriven"==pluginType)return this;var target=this.targets[pluginType];return target},registerPlugin:function(plugin){this.importLibraries(plugin),this.pluginList.push(plugin),this.pluginList.sort(function(a,b){return a.getIndex()-b.getIndex()})},importLibraries:function(plugin){plugin.getDependencies().forEach(function(lib){var script=document.createElement("script");script.type="text/javascript",script.src="javascript/"+lib+".js",document.head.appendChild(script)})},loadPlugins:function(pluginBaseClass){if(void 0!=pluginBaseClass){var This=this;this.foreach(function(plugin,config){null!=dynamic_cast(pluginBaseClass,plugin)&&config.enabled&&(base.log.debug("Load plugin ("+pluginBaseClass+"): "+plugin.getName()),plugin.config=config,plugin.load(This))})}},foreach:function(callback){var enablePluginsByDefault=!1,pluginsConfig={};try{enablePluginsByDefault=paella.player.config.plugins.enablePluginsByDefault}catch(e){}try{pluginsConfig=paella.player.config.plugins.list}catch(e){}this.pluginList.forEach(function(plugin){var name=plugin.getName(),config=pluginsConfig[name];config||(config={enabled:enablePluginsByDefault}),callback(plugin,config)})},addPlugin:function(plugin){var thisClass=this;plugin.checkEnabled(function(isEnabled){if("eventDriven"==plugin.type&&isEnabled){paella.pluginManager.setupPlugin(plugin),thisClass.eventDrivenPlugins.push(plugin);for(var events=plugin.getEvents(),eventBind=function(event,params){plugin.onEvent(event.type,params)},i=0;i<events.length;++i){var eventName=events[i];paella.events.bind(eventName,eventBind)}}})},getPlugin:function(name){for(var i=0;i<this.pluginList.length;++i)if(this.pluginList[i].getName()==name)return this.pluginList[i];return null}}),paella.pluginManager=new paella.PluginManager,Class("paella.Plugin",{type:"",initialize:function(){paella.pluginManager.registerPlugin(this)},getDependencies:function(){return[]},load:function(pluginManager){var target=pluginManager.getTarget(this.type);target&&target.addPlugin&&target.addPlugin(this)},getRootNode:function(id){return null},checkEnabled:function(onSuccess){onSuccess(!0)},setup:function(){},getIndex:function(){return 0},getName:function(){return""}}),Class("paella.FastLoadPlugin",paella.Plugin,{}),Class("paella.EarlyLoadPlugin",paella.Plugin,{}),Class("paella.DeferredLoadPlugin",paella.Plugin,{}),Class("paella.PopUpContainer",paella.DomNode,{containers:null,currentContainerId:-1,initialize:function(id,className){var style={};this.parent("div",id,style),this.domElement.className=className,this.containers={}},hideContainer:function(identifier,button){var container=this.containers[identifier];container&&this.currentContainerId==identifier&&(container.identifier=identifier,paella.events.trigger(paella.events.hidePopUp,{container:container}),container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),$(this.domElement).css({width:"0px"}),this.currentContainerId=-1,container.plugin.didHideContent())},showContainer:function(identifier,button){function hideContainer(container){paella.events.trigger(paella.events.hidePopUp,{container:container}),container.plugin.willHideContent(),$(container.element).hide(),$(thisClass.domElement).css({width:"0px"}),container.button.className=container.button.className.replace(" selected",""),thisClass.currentContainerId=-1,container.plugin.didHideContent()}function showContainer(container){if(paella.events.trigger(paella.events.showPopUp,{container:container}),container.plugin.willShowContent(),container.button.className=container.button.className+" selected",$(container.element).show(),width=$(container.element).width(),"right"==container.plugin.getAlignment()){var right=$(button.parentElement).width()-$(button).position().left-$(button).width();$(thisClass.domElement).css({width:width+"px",right:right+"px",left:""})}else{var left=$(button).position().left;$(thisClass.domElement).css({width:width+"px",left:left+"px",right:""})}thisClass.currentContainerId=identifier,container.plugin.didShowContent()}var thisClass=this,width=0,container=this.containers[identifier];if(container&&this.currentContainerId!=identifier&&this.currentContainerId!=-1){var prevContainer=this.containers[this.currentContainerId];hideContainer(prevContainer),showContainer(container)}else container&&this.currentContainerId==identifier?hideContainer(container):container&&showContainer(container)},registerContainer:function(identifier,domElement,button,plugin){var containerInfo={identifier:identifier,button:button,element:domElement,plugin:plugin};this.containers[identifier]=containerInfo,$(domElement).hide(),button.popUpIdentifier=identifier,button.sourcePlugin=plugin,$(button).click(function(event){this.plugin.isPopUpOpen()?paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),$(button).keyup(function(event){13!=event.keyCode||this.plugin.isPopUpOpen()?27==event.keyCode&&paella.player.controls.playbackControl().hidePopUp(this.popUpIdentifier,this):paella.player.controls.playbackControl().showPopUp(this.popUpIdentifier,this)}),plugin.containerManager=this}}),Class("paella.TimelineContainer",paella.PopUpContainer,{hideContainer:function(identifier,button){var container=this.containers[identifier];container&&this.currentContainerId==identifier&&(paella.events.trigger(paella.events.hidePopUp,{container:container}),container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),this.currentContainerId=-1,$(this.domElement).css({height:"0px"}),container.plugin.didHideContent())},showContainer:function(identifier,button){var height=0,container=this.containers[identifier];if(container&&this.currentContainerId!=identifier&&this.currentContainerId!=-1){var prevContainer=this.containers[this.currentContainerId];prevContainer.button.className=prevContainer.button.className.replace(" selected",""),container.button.className=container.button.className+" selected",paella.events.trigger(paella.events.hidePopUp,{container:prevContainer}),prevContainer.plugin.willHideContent(),$(prevContainer.element).hide(),prevContainer.plugin.didHideContent(),paella.events.trigger(paella.events.showPopUp,{container:container}),container.plugin.willShowContent(),$(container.element).show(),this.currentContainerId=identifier,height=$(container.element).height(),$(this.domElement).css({height:height+"px"}),container.plugin.didShowContent()}else container&&this.currentContainerId==identifier?(paella.events.trigger(paella.events.hidePopUp,{container:container}),container.plugin.willHideContent(),$(container.element).hide(),container.button.className=container.button.className.replace(" selected",""),$(this.domElement).css({height:"0px"}),this.currentContainerId=-1,container.plugin.didHideContent()):container&&(paella.events.trigger(paella.events.showPopUp,{container:container}),container.plugin.willShowContent(),container.button.className=container.button.className+" selected",$(container.element).show(),this.currentContainerId=identifier,height=$(container.element).height(),$(this.domElement).css({height:height+"px"}),container.plugin.didShowContent())}}),Class("paella.UIPlugin",paella.DeferredLoadPlugin,{ui:null,checkVisibility:function(){var modes=this.config.visibleOn||[paella.PaellaPlayer.mode.standard,paella.PaellaPlayer.mode.fullscreen,paella.PaellaPlayer.mode.embed],visible=!1;modes.forEach(function(m){m==paella.player.getPlayerMode()&&(visible=!0)}),visible?this.showUI():this.hideUI()},hideUI:function(){this.ui.setAttribute("aria-hidden","true"),$(this.ui).hide()},showUI:function(){var thisClass=this;paella.pluginManager.enabledPlugins.forEach(function(p){p==thisClass&&(thisClass.ui.setAttribute("aria-hidden","false"),$(thisClass.ui).show())})}}),Class("paella.ButtonPlugin",paella.UIPlugin,{type:"button",subclass:"",container:null,containerManager:null,getAlignment:function(){return"left"},getSubclass:function(){return"myButtonPlugin"},addSubclass:function($subclass){$(this.container).addClass($subclass)},removeSubclass:function($subclass){$(this.container).removeClass($subclass)},action:function(button){},getName:function(){return"ButtonPlugin"},getMinWindowSize:function(){return 0},buildContent:function(domElement){},willShowContent:function(){base.log.debug(this.getName()+" willDisplayContent")},didShowContent:function(){base.log.debug(this.getName()+" didDisplayContent")},willHideContent:function(){base.log.debug(this.getName()+" willHideContent")},didHideContent:function(){base.log.debug(this.getName()+" didHideContent")},getButtonType:function(){return paella.ButtonPlugin.type.actionButton},getText:function(){return""},setText:function(text){this.container.innerHTML=text},hideButton:function(){this.hideUI()},showButton:function(){this.showUI()},changeSubclass:function(newSubclass){this.subclass=newSubclass,this.container.className=this.getClassName()},getClassName:function(){return paella.ButtonPlugin.kClassName+" "+this.getAlignment()+" "+this.subclass},getContainerClassName:function(){return this.getButtonType()==paella.ButtonPlugin.type.timeLineButton?paella.ButtonPlugin.kTimeLineClassName+" "+this.getSubclass():this.getButtonType()==paella.ButtonPlugin.type.popUpButton?paella.ButtonPlugin.kPopUpClassName+" "+this.getSubclass():void 0},setToolTip:function(message){this.button.setAttribute("title",message),this.button.setAttribute("aria-label",message)},getDefaultToolTip:function(){return""},isPopUpOpen:function(){return this.button.popUpIdentifier==this.containerManager.currentContainerId}}),paella.ButtonPlugin.alignment={left:"left",right:"right"},paella.ButtonPlugin.kClassName="buttonPlugin",paella.ButtonPlugin.kPopUpClassName="buttonPluginPopUp",paella.ButtonPlugin.kTimeLineClassName="buttonTimeLine",paella.ButtonPlugin.type={actionButton:1,popUpButton:2,timeLineButton:3},paella.ButtonPlugin.buildPluginButton=function(plugin,id){function onAction(self){paella.userTracking.log("paella:button:action",self.plugin.getName()),self.plugin.action(self)}plugin.subclass=plugin.getSubclass();var elem=document.createElement("div");return elem.className=plugin.getClassName(),elem.id=id,elem.innerHTML=plugin.getText(),elem.setAttribute("tabindex",1e3+plugin.getIndex()),elem.setAttribute("alt",""),elem.setAttribute("role","button"),elem.plugin=plugin,plugin.button=elem,plugin.container=elem,plugin.ui=elem,plugin.setToolTip(plugin.getDefaultToolTip()),$(elem).click(function(event){onAction(this)}),$(elem).keyup(function(event){13==event.keyCode&&onAction(this)}),elem},paella.ButtonPlugin.buildPluginPopUp=function(parent,plugin,id){plugin.subclass=plugin.getSubclass();var elem=document.createElement("div");return parent.appendChild(elem),elem.className=plugin.getContainerClassName(),elem.id=id,elem.plugin=plugin,plugin.buildContent(elem),elem},Class("paella.VideoOverlayButtonPlugin",paella.ButtonPlugin,{type:"videoOverlayButton",getSubclass:function(){return"myVideoOverlayButtonPlugin"},action:function(button){},getName:function(){return"VideoOverlayButtonPlugin"}}),Class("paella.EventDrivenPlugin",paella.EarlyLoadPlugin,{type:"eventDriven",initialize:function(){this.parent();for(var events=this.getEvents(),i=0;i<events.length;++i){var event=events[i];event==paella.events.loadStarted&&this.onEvent(paella.events.loadStarted)}},getEvents:function(){return[]},onEvent:function(eventType,params){},getName:function(){return"EventDrivenPlugin"}}),function(){var captionParserManager=new(Class({_formats:{},addPlugin:function(plugin){var self=this,ext=plugin.ext;0==(Array.isArray&&Array.isArray(ext)||ext instanceof Array)&&(ext=[ext]),0==ext.length?base.log.debug("No extension provided by the plugin "+plugin.getName()):(base.log.debug("New captionParser added: "+plugin.getName()),ext.forEach(function(f){self._formats[f]=plugin}))},initialize:function(){paella.pluginManager.setTarget("captionParser",this)}})),SearchCallback=Class(base.AsyncLoaderCallback,{initialize:function(caption,text){this.name="captionSearchCallback",this.caption=caption,this.text=text},load:function(onSuccess,onError){var self=this;this.caption.search(this.text,function(err,result){err?onError():(self.result=result,onSuccess())})}});paella.captions={parsers:{},_captions:{},_activeCaption:void 0,addCaptions:function(captions){var cid=captions._captionsProvider+":"+captions._id;this._captions[cid]=captions,paella.events.trigger(paella.events.captionAdded,cid)},getAvailableLangs:function(){var ret=[],self=this;return Object.keys(this._captions).forEach(function(k){var c=self._captions[k];ret.push({id:k,lang:c._lang})}),ret},getCaptions:function(cid){if(cid&&this._captions[cid])return this._captions[cid]},getActiveCaptions:function(cid){return this._activeCaption},setActiveCaptions:function(cid){return this._activeCaption=this.getCaptions(cid),void 0!=this._activeCaption?paella.events.trigger(paella.events.captionsEnabled,cid):paella.events.trigger(paella.events.captionsDisabled),this._activeCaption},getCaptionAtTime:function(cid,time){var c=this.getCaptions(cid);if(void 0!=c)return c.getCaptionAtTime(time)},search:function(text,next){var self=this,asyncLoader=new base.AsyncLoader;this.getAvailableLangs().forEach(function(l){asyncLoader.addCallback(new SearchCallback(self.getCaptions(l.id),text))}),asyncLoader.load(function(){var res=[];Object.keys(asyncLoader.callbackArray).forEach(function(k){res=res.concat(asyncLoader.getCallback(k).result)}),next&&next(!1,res)},function(){next&&next(!0)})}},Class("paella.captions.Caption",{initialize:function(id,format,url,lang,next){this._id=id,this._format=format,this._url=url,this._captions=void 0,this._index=lunr(function(){this.ref("id"),this.field("content",{boost:10})}),"string"==typeof lang&&(lang={code:lang,txt:lang}),this._lang=lang,this._captionsProvider="downloadCaptionsProvider",this.reloadCaptions(next)},canEdit:function(next){next(!1,!1)},goToEdit:function(){},reloadCaptions:function(next){var self=this;jQuery.ajax({url:self._url,cache:!1,type:"get",dataType:"text"}).done(function(dataRaw){var parser=captionParserManager._formats[self._format];void 0==parser?(base.log.debug("Error adding captions: Format not supported!"),next&&next(!0)):parser.parse(dataRaw,self._lang.code,function(err,c){err||(self._captions=c,self._captions.forEach(function(cap){self._index.add({id:cap.id,content:cap.content})})),next&&next(err)})}).fail(function(error){base.log.debug("Error loading captions: "+self._url),next&&next(!0)})},getCaptions:function(){return this._captions},getCaptionAtTime:function(time){if(void 0!=this._captions)for(var i=0;i<this._captions.length;++i)if(l_cap=this._captions[i],l_cap.begin<=time&&l_cap.end>=time)return l_cap},getCaptionById:function(id){if(void 0!=this._captions)for(var i=0;i<this._captions.length;++i)if(l_cap=this._captions[i],l_cap.id==id)return l_cap},search:function(txt,next){var self=this;if(void 0==this._index)next&&next(!0,"Error. No captions found.");else{var results=[];this._index.search(txt).forEach(function(s){var c=self.getCaptionById(s.ref);results.push({time:c.begin,content:c.content,score:s.score})}),next&&next(!1,results)}}}),Class("paella.CaptionParserPlugIn",paella.FastLoadPlugin,{type:"captionParser",getIndex:function(){return-1},ext:[],parse:function(content,lang,next){throw new Error("paella.CaptionParserPlugIn#parse must be overridden by subclass")}})}(),function(){var searchServiceManager=new(Class({_plugins:[],addPlugin:function(plugin){this._plugins.push(plugin)},initialize:function(){paella.pluginManager.setTarget("SearchServicePlugIn",this)}})),SearchCallback=Class(base.AsyncLoaderCallback,{initialize:function(plugin,text){this.name="searchCallback",this.plugin=plugin,this.text=text},load:function(onSuccess,onError){var self=this;this.plugin.search(this.text,function(err,result){err?onError():(self.result=result,onSuccess())})}});paella.searchService={search:function(text,next){var asyncLoader=new base.AsyncLoader;paella.userTracking.log("paella:searchService:search",text),searchServiceManager._plugins.forEach(function(p){asyncLoader.addCallback(new SearchCallback(p,text))}),asyncLoader.load(function(){var res=[];Object.keys(asyncLoader.callbackArray).forEach(function(k){res=res.concat(asyncLoader.getCallback(k).result)}),next&&next(!1,res)},function(){next&&next(!0)})}},Class("paella.SearchServicePlugIn",paella.FastLoadPlugin,{type:"SearchServicePlugIn",getIndex:function(){return-1},search:function(text,next){throw new Error("paella.SearchServicePlugIn#search must be overridden by subclass")}})}(),function(){var userTrackingManager=new(Class({_plugins:[],addPlugin:function(plugin){var self=this;plugin.checkEnabled(function(isEnabled){isEnabled&&(plugin.setup(),self._plugins.push(plugin))})},initialize:function(){paella.pluginManager.setTarget("userTrackingSaverPlugIn",this)}}));paella.userTracking={},Class("paella.userTracking.SaverPlugIn",paella.FastLoadPlugin,{type:"userTrackingSaverPlugIn",getIndex:function(){return-1},checkEnabled:function(onSuccess){onSuccess(!0)},log:function(event,params){throw new Error("paella.userTracking.SaverPlugIn#log must be overridden by subclass")}});var evsentsToLog={};paella.userTracking.log=function(event,params){void 0!=evsentsToLog[event]&&evsentsToLog[event].cancel(),evsentsToLog[event]=new base.Timer(function(timer){userTrackingManager._plugins.forEach(function(p){p.log(event,params)}),delete evsentsToLog[event]},500)},[paella.events.play,paella.events.pause,paella.events.endVideo,paella.events.showEditor,paella.events.hideEditor,paella.events.enterFullscreen,paella.events.exitFullscreen,paella.events.loadComplete].forEach(function(event){paella.events.bind(event,function(ev,params){paella.userTracking.log(event)})}),[paella.events.showPopUp,paella.events.hidePopUp].forEach(function(event){paella.events.bind(event,function(ev,params){paella.userTracking.log(event,params.identifier)})}),[paella.events.captionsEnabled,paella.events.captionsDisabled].forEach(function(event){paella.events.bind(event,function(ev,params){var log;if(void 0!=params){var c=paella.captions.getCaptions(params);log={id:params,lang:c._lang,url:c._url}}paella.userTracking.log(event,log)})}),[paella.events.setProfile].forEach(function(event){paella.events.bind(event,function(ev,params){paella.userTracking.log(event,params.profileName)})}),[paella.events.seekTo,paella.events.seekToTime].forEach(function(event){paella.events.bind(event,function(ev,params){var log;try{JSON.stringify(params),log=params}catch(e){}paella.userTracking.log(event,log)})}),[paella.events.setVolume,paella.events.resize,paella.events.setPlaybackRate].forEach(function(event){paella.events.bind(event,function(ev,params){var log;try{JSON.stringify(params),log=params}catch(e){}paella.userTracking.log(event,log)})})}(),Class("paella.TimeControl",paella.DomNode,{initialize:function(id){this.parent("div",id,{left:"0%"}),this.domElement.className="timeControlOld",this.domElement.className="timeControl";var thisClass=this;paella.events.bind(paella.events.timeupdate,function(event,params){thisClass.onTimeUpdate(params)})},onTimeUpdate:function(memo){memo.videoContainer,100*memo.currentTime/memo.duration;this.domElement.innerHTML=this.secondsToHours(parseInt(memo.currentTime))},secondsToHours:function(sec_numb){var hours=Math.floor(sec_numb/3600),minutes=Math.floor((sec_numb-3600*hours)/60),seconds=sec_numb-3600*hours-60*minutes;return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),hours+":"+minutes+":"+seconds}}),Class("paella.PlaybackBar",paella.DomNode,{playbackFullId:"",updatePlayBar:!0,timeControlId:"",_images:null,_keys:null,_prev:null,_next:null,_videoLength:null,_lastSrc:null,_aspectRatio:1.777777778,_hasSlides:null,_imgNode:null,_canvas:null,initialize:function(id){var self=this;self.imageSetup();var style={};this.parent("div",id,style),this.domElement.className="playbackBar",this.domElement.setAttribute("alt",""),this.domElement.setAttribute("aria-label","Timeline Slider"),this.domElement.setAttribute("role","slider"),this.domElement.setAttribute("aria-valuemin","0"),this.domElement.setAttribute("aria-valuemax","100"),this.domElement.setAttribute("aria-valuenow","0"),this.domElement.setAttribute("tabindex","1100"),$(this.domElement).keyup(function(event){var currentTime=0,duration=0;paella.player.videoContainer.currentTime().then(function(t){return currentTime=t,paella.player.videoContainer.duration()}).then(function(d){duration=d;var curr,selectedPosition;switch(event.keyCode){case 37:curr=100*currentTime/duration,selectedPosition=curr-5,paella.player.videoContainer.seekTo(selectedPosition);break;case 39:curr=100*currentTime/duration,selectedPosition=curr+5,paella.player.videoContainer.seekTo(selectedPosition)}})}),this.playbackFullId=id+"_full",this.timeControlId=id+"_timeControl";var playbackFull=new paella.DomNode("div",this.playbackFullId,{width:"0%"});playbackFull.domElement.className="playbackBarFull",this.addNode(playbackFull),this.addNode(new paella.TimeControl(this.timeControlId));var thisClass=this;paella.events.bind(paella.events.timeupdate,function(event,params){thisClass.onTimeUpdate(params)}),$(this.domElement).bind("mousedown",function(event){paella.utils.mouseManager.down(thisClass,event),event.stopPropagation()}),$(playbackFull.domElement).bind("mousedown",function(event){paella.utils.mouseManager.down(thisClass,event),event.stopPropagation()}),base.userAgent.browser.IsMobileVersion||($(this.domElement).bind("mousemove",function(event){thisClass.movePassive(event),paella.utils.mouseManager.move(event)}),$(playbackFull.domElement).bind("mousemove",function(event){paella.utils.mouseManager.move(event)}),$(this.domElement).bind("mouseout",function(event){thisClass.mouseOut(event)})),$(this.domElement).bind("mouseup",function(event){paella.utils.mouseManager.up(event)}),$(playbackFull.domElement).bind("mouseup",function(event){paella.utils.mouseManager.up(event)}),paella.player.isLiveStream()&&$(this.domElement).hide(),setTimeout(function(){self.drawTimeMarks()},200)},mouseOut:function(event){var self=this;self._hasSlides?$("#divTimeImageOverlay").remove():$("#divTimeOverlay").remove()},drawTimeMarks:function(){var self=this,parent=$("#playerContainer_controls_playback_playbackBar");this.clearCanvas(),this._keys&&paella.player.config.player.slidesMarks.enabled&&this._keys.forEach(function(l){var aux=parseInt(l)*parent.width()/self._videoLength;self.drawTimeMark(parseInt(aux))})},drawTimeMark:function(sec){var ht=12,ctx=this.getCanvasContext();ctx.fillStyle=paella.player.config.player.slidesMarks.color,ctx.fillRect(sec,0,1,ht)},clearCanvas:function(){if(this._canvas){var ctx=this.getCanvasContext();ctx.clearRect(0,0,this._canvas.width,this._canvas.height)}},getCanvas:function(){if(!this._canvas){var parent=$("#playerContainer_controls_playback_playbackBar"),canvas=document.createElement("canvas");canvas.className="playerContainer_controls_playback_playbackBar_canvas",canvas.id="playerContainer_controls_playback_playbackBar_canvas",canvas.width=parent.width(),ht=canvas.height=parent.height(),parent.prepend(canvas),this._canvas=document.getElementById("playerContainer_controls_playback_playbackBar_canvas")}return this._canvas},getCanvasContext:function(){return this.getCanvas().getContext("2d")},movePassive:function(event){function updateTimePreview(duration){var p=$(This.domElement),pos=p.offset(),width=p.width(),left=event.clientX-pos.left;left=left<0?0:left;var position=100*left/width,time=position*duration/100,hou=Math.floor(time/3600)%24;hou=("00"+hou).slice(hou.toString().length);var min=Math.floor(time/60)%60;min=("00"+min).slice(min.toString().length);var sec=Math.floor(time%60);sec=("00"+sec).slice(sec.toString().length);var timestr=hou+":"+min+":"+sec;if(This._hasSlides?(0==$("#divTimeImageOverlay").length?This.setupTimeImageOverlay(timestr,pos.top,width):$("#divTimeOverlay")[0].innerHTML=timestr,This.imageUpdate(time)):0==$("#divTimeOverlay").length?This.setupTimeOnly(timestr,pos.top,width):$("#divTimeOverlay")[0].innerHTML=timestr,This._hasSlides){var ancho=$("#divTimeImageOverlay").width(),posx=event.clientX-ancho/2;event.clientX>ancho/2+pos.left&&event.clientX<pos.left+width-ancho/2?$("#divTimeImageOverlay").css("left",posx):event.clientX<width/2?$("#divTimeImageOverlay").css("left",pos.left):$("#divTimeImageOverlay").css("left",pos.left+width-ancho)}var ancho2=$("#divTimeOverlay").width(),posx2=event.clientX-ancho2/2;event.clientX>ancho2/2+pos.left&&event.clientX<pos.left+width-ancho2/2?$("#divTimeOverlay").css("left",posx2):event.clientX<width/2?$("#divTimeOverlay").css("left",pos.left):$("#divTimeOverlay").css("left",pos.left+width-ancho2-2),This._hasSlides&&$("#divTimeImageOverlay").css("bottom",$(".playbackControls").height())}var This=this;paella.player.videoContainer.duration().then(function(d){updateTimePreview(d)})},imageSetup:function(){var This=this;paella.player.videoContainer.duration().then(function(duration){This._images={};var n=paella.initDelegate.initParams.videoLoader.frameList;return n&&0!==Object.keys(n).length?(This._hasSlides=!0,This._images=n,This._videoLength=duration,This._keys=Object.keys(This._images),This._keys=This._keys.sort(function(a,b){return parseInt(a)-parseInt(b)}),This._next=0,void(This._prev=0)):void(This._hasSlides=!1)})},imageUpdate:function(sec){var self=this,src=$("#imgOverlay").attr("src");if($(self._imgNode).show(),sec>this._next||sec<this._prev)src=self.getPreviewImageSrc(sec),src?(self._lastSrc=src,$("#imgOverlay").attr("src",src)):self.hideImg();else{if(void 0!=src)return;$("#imgOverlay").attr("src",self._lastSrc)}},hideImg:function(){var self=this;$(self._imgNode).hide()},getPreviewImageSrc:function(sec){var keys=Object.keys(this._images);keys.push(sec),keys.sort(function(a,b){return parseInt(a)-parseInt(b)});var n=keys.indexOf(sec)-1;n=n>0?n:0;var i=keys[n],next=keys[n+2],prev=keys[n];return next=void 0==next?keys.length-1:parseInt(next),this._next=next,prev=void 0==prev?0:parseInt(prev),this._prev=prev,i=parseInt(i),!!this._images[i]&&(this._images[i].url||this._images[i].url)},setupTimeImageOverlay:function(time_str,top,width){var self=this,div=document.createElement("div");div.className="divTimeImageOverlay",div.id="divTimeImageOverlay";var aux=Math.round(width/10);if(div.style.width=Math.round(aux*self._aspectRatio)+"px",self._hasSlides){var img=document.createElement("img");img.className="imgOverlay",img.id="imgOverlay",self._imgNode=img,div.appendChild(img)}var div2=document.createElement("div");div2.className="divTimeOverlay",div2.style.top=top-20+"px",div2.id="divTimeOverlay",div2.innerHTML=time_str,div.appendChild(div2),$(this.domElement).parent().append(div)},setupTimeOnly:function(time_str,top,width){var div2=document.createElement("div");div2.className="divTimeOverlay",div2.style.top=top-20+"px",div2.id="divTimeOverlay",div2.innerHTML=time_str,$(this.domElement).parent().append(div2)},playbackFull:function(){return this.getNode(this.playbackFullId)},timeControl:function(){return this.getNode(this.timeControlId)},setPlaybackPosition:function(percent){this.playbackFull().domElement.style.width=percent+"%"},isSeeking:function(){return!this.updatePlayBar},onTimeUpdate:function(memo){if(this.updatePlayBar){var currentTime=memo.currentTime,duration=memo.duration;this.setPlaybackPosition(100*currentTime/duration)}},down:function(event,x,y){this.updatePlayBar=!1,this.move(event,x,y)},move:function(event,x,y){var width=$(this.domElement).width(),selectedPosition=x-$(this.domElement).offset().left;selectedPosition=selectedPosition<0?0:selectedPosition>width?100:100*selectedPosition/width,this.setPlaybackPosition(selectedPosition)},up:function(event,x,y){var width=$(this.domElement).width(),selectedPosition=x-$(this.domElement).offset().left;selectedPosition=selectedPosition<0?0:selectedPosition>width?100:100*selectedPosition/width,paella.player.videoContainer.seekTo(selectedPosition),this.updatePlayBar=!0},onresize:function(){this.drawTimeMarks()}}),Class("paella.PlaybackControl",paella.DomNode,{playbackBarId:"",pluginsContainer:null,_popUpPluginContainer:null,_timeLinePluginContainer:null,playbackPluginsWidth:0,popupPluginsWidth:0,minPlaybackBarSize:120,playbackBarInstance:null,buttonPlugins:[],addPlugin:function(plugin){var This=this,id="buttonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(plugin);var button=paella.ButtonPlugin.buildPluginButton(plugin,id);plugin.button=button,this.pluginsContainer.domElement.appendChild(button),$(button).hide(),plugin.checkEnabled(function(isEnabled){var parent;if(isEnabled){$(plugin.button).show(),paella.pluginManager.setupPlugin(plugin);var id="buttonPlugin"+This.buttonPlugins.length;if(plugin.getButtonType()==paella.ButtonPlugin.type.popUpButton){parent=This.popUpPluginContainer.domElement;var popUpContent=paella.ButtonPlugin.buildPluginPopUp(parent,plugin,id+"_container");This.popUpPluginContainer.registerContainer(plugin.getName(),popUpContent,button,plugin)}else if(plugin.getButtonType()==paella.ButtonPlugin.type.timeLineButton){parent=This.timeLinePluginContainer.domElement;var timeLineContent=paella.ButtonPlugin.buildPluginPopUp(parent,plugin,id+"_timeline");This.timeLinePluginContainer.registerContainer(plugin.getName(),timeLineContent,button,plugin)}}else This.pluginsContainer.domElement.removeChild(plugin.button)})},initialize:function(id){var style={};this.parent("div",id,style),this.domElement.className="playbackControls",this.playbackBarId=id+"_playbackBar";this.pluginsContainer=new paella.DomNode("div",id+"_playbackBarPlugins"),this.pluginsContainer.domElement.className="playbackBarPlugins",this.pluginsContainer.domElement.setAttribute("role","toolbar"),this.addNode(this.pluginsContainer),this.addNode(new paella.PlaybackBar(this.playbackBarId)),paella.pluginManager.setTarget("button",this),Object.defineProperty(this,"popUpPluginContainer",{get:function(){return this._popUpPluginContainer||(this._popUpPluginContainer=new paella.PopUpContainer(id+"_popUpPluginContainer","popUpPluginContainer"),this.addNode(this._popUpPluginContainer)),this._popUpPluginContainer}}),Object.defineProperty(this,"timeLinePluginContainer",{get:function(){return this._timeLinePluginContainer||(this._timeLinePluginContainer=new paella.TimelineContainer(id+"_timelinePluginContainer","timelinePluginContainer"),this.addNode(this._timeLinePluginContainer)),this._timeLinePluginContainer}})},showPopUp:function(identifier,button){this.popUpPluginContainer.showContainer(identifier,button),this.timeLinePluginContainer.showContainer(identifier,button)},hidePopUp:function(identifier,button){this.popUpPluginContainer.hideContainer(identifier,button),this.timeLinePluginContainer.hideContainer(identifier,button)},playbackBar:function(){return null==this.playbackBarInstance&&(this.playbackBarInstance=this.getNode(this.playbackBarId)),this.playbackBarInstance},onresize:function(){var windowSize=$(this.domElement).width();base.log.debug("resize playback bar (width="+windowSize+")");for(var i=0;i<this.buttonPlugins.length;++i){var plugin=this.buttonPlugins[i],minSize=plugin.getMinWindowSize();minSize>0&&windowSize<minSize?plugin.hideUI():plugin.checkVisibility()}this.getNode(this.playbackBarId).onresize()}}),Class("paella.ControlsContainer",paella.DomNode,{playbackControlId:"",editControlId:"",isEnabled:!0,autohideTimer:null,hideControlsTimeMillis:3e3,playbackControlInstance:null,videoOverlayButtons:null,buttonPlugins:[],_hidden:!1,addPlugin:function(plugin){var id="videoOverlayButtonPlugin"+this.buttonPlugins.length;this.buttonPlugins.push(plugin);var button=paella.ButtonPlugin.buildPluginButton(plugin,id);this.videoOverlayButtons.domElement.appendChild(button),plugin.button=button,$(button).hide(),plugin.checkEnabled(function(isEnabled){isEnabled&&($(plugin.button).show(),
paella.pluginManager.setupPlugin(plugin))})},initialize:function(id){this.parent("div",id),this.viewControlId=id+"_view",this.playbackControlId=id+"_playback",this.editControlId=id+"_editor",this.addNode(new paella.PlaybackControl(this.playbackControlId));var thisClass=this;paella.events.bind(paella.events.showEditor,function(event){thisClass.onShowEditor()}),paella.events.bind(paella.events.hideEditor,function(event){thisClass.onHideEditor()}),paella.events.bind(paella.events.play,function(event){thisClass.onPlayEvent()}),paella.events.bind(paella.events.pause,function(event){thisClass.onPauseEvent()}),$(document).mousemove(function(event){paella.player.controls.restartHideTimer()}),paella.events.bind(paella.events.endVideo,function(event){thisClass.onEndVideoEvent()}),paella.events.bind("keydown",function(event){thisClass.onKeyEvent()}),this.videoOverlayButtons=new paella.DomNode("div",id+"_videoOverlayButtonPlugins"),this.videoOverlayButtons.domElement.className="videoOverlayButtonPlugins",this.videoOverlayButtons.domElement.setAttribute("role","toolbar"),this.addNode(this.videoOverlayButtons),paella.pluginManager.setTarget("videoOverlayButton",this)},onShowEditor:function(){var editControl=this.editControl();editControl&&$(editControl.domElement).hide()},onHideEditor:function(){var editControl=this.editControl();editControl&&$(editControl.domElement).show()},enterEditMode:function(){var playbackControl=this.playbackControl(),editControl=this.editControl();playbackControl&&editControl&&$(playbackControl.domElement).hide()},exitEditMode:function(){var playbackControl=this.playbackControl(),editControl=this.editControl();playbackControl&&editControl&&$(playbackControl.domElement).show()},playbackControl:function(){return null==this.playbackControlInstance&&(this.playbackControlInstance=this.getNode(this.playbackControlId)),this.playbackControlInstance},editControl:function(){return this.getNode(this.editControlId)},disable:function(){this.isEnabled=!1,this.hide()},enable:function(){this.isEnabled=!0,this.show()},isHidden:function(){return this._hidden},hide:function(){function hideIfNotCanceled(){This._doHide&&($(This.domElement).css({opacity:0}),$(This.domElement).hide(),This.domElement.setAttribute("aria-hidden","true"),This._hidden=!0,paella.events.trigger(paella.events.controlBarDidHide))}var This=this;this._doHide=!0,paella.events.trigger(paella.events.controlBarWillHide),This._doHide&&(base.userAgent.browser.IsMobileVersion||base.userAgent.browser.Explorer?hideIfNotCanceled():$(this.domElement).animate({opacity:0},{duration:300,complete:hideIfNotCanceled}))},showPopUp:function(identifier){this.playbackControl().showPopUp(identifier)},hidePopUp:function(identifier){this.playbackControl().hidePopUp(identifier)},show:function(){this.isEnabled&&($(this.domElement).stop(),this._doHide=!1,this.domElement.style.opacity=1,this.domElement.setAttribute("aria-hidden","false"),this._hidden=!1,$(this.domElement).show(),paella.events.trigger(paella.events.controlBarDidShow))},autohideTimeout:function(){var playbackBar=this.playbackControl().playbackBar();playbackBar.isSeeking()?paella.player.controls.restartHideTimer():paella.player.controls.hideControls()},hideControls:function(){var This=this;paella.player.videoContainer.paused().then(function(paused){paused?This.show():This.hide()})},showControls:function(){this.show()},onPlayEvent:function(){this.restartHideTimer()},onPauseEvent:function(){this.clearAutohideTimer()},onEndVideoEvent:function(){this.show(),this.clearAutohideTimer()},onKeyEvent:function(){this.restartHideTimer(),paella.player.videoContainer.paused().then(function(paused){paused||paella.player.controls.restartHideTimer()})},cancelHideBar:function(){this.restartTimerEvent()},restartTimerEvent:function(){var This=this;this.isHidden()&&this.showControls(),this._doHide=!1,paella.player.videoContainer.paused(function(paused){paused||This.restartHideTimer()})},clearAutohideTimer:function(){null!=this.autohideTimer&&(this.autohideTimer.cancel(),this.autohideTimer=null)},restartHideTimer:function(){this.showControls(),this.clearAutohideTimer();var thisClass=this;this.autohideTimer=new base.Timer(function(timer){thisClass.autohideTimeout()},this.hideControlsTimeMillis)},onresize:function(){this.playbackControl().onresize()}}),Class("paella.LoaderContainer",paella.DomNode,{timer:null,loader:null,loaderPosition:0,initialize:function(id){this.parent("div",id,{position:"fixed",backgroundColor:"white",opacity:"0.7",top:"0px",left:"0px",right:"0px",bottom:"0px",zIndex:1e4}),this.loader=this.addNode(new paella.DomNode("div","",{position:"fixed",width:"128px",height:"128px",top:"50%",left:"50%",marginLeft:"-64px",marginTop:"-64px",backgroundImage:"url("+paella.utils.folders.resources()+"/images/loader.png)"}));var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(params)}),this.timer=new base.Timer(function(timer){thisClass.loaderPosition-=128,thisClass.loader.domElement.style.backgroundPosition=thisClass.loaderPosition+"px"},1e3),this.timer.repeat=!0},loadComplete:function(params){$(this.domElement).hide(),this.timer.repeat=!1}}),Class("paella.KeyManager",{isPlaying:!1,Keys:{Space:32,Left:37,Up:38,Right:39,Down:40,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90},enabled:!0,initialize:function(){var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(event,params)}),paella.events.bind(paella.events.play,function(event){thisClass.onPlay()}),paella.events.bind(paella.events.pause,function(event){thisClass.onPause()})},loadComplete:function(event,params){var thisClass=this;paella.events.bind("keyup",function(event){thisClass.keyUp(event)})},onPlay:function(){this.isPlaying=!0},onPause:function(){this.isPlaying=!1},keyUp:function(event){this.enabled&&(event.altKey&&event.ctrlKey?event.which==this.Keys.P?this.togglePlayPause():event.which==this.Keys.S?this.pause():event.which==this.Keys.M?this.mute():event.which==this.Keys.U?this.volumeUp():event.which==this.Keys.D&&this.volumeDown():event.which==this.Keys.Space?this.togglePlayPause():event.which==this.Keys.Up?this.volumeUp():event.which==this.Keys.Down?this.volumeDown():event.which==this.Keys.M&&this.mute())},togglePlayPause:function(){this.isPlaying?paella.player.pause():paella.player.play()},pause:function(){paella.player.pause()},mute:function(){var videoContainer=paella.player.videoContainer;videoContainer.volume().then(function(volume){var newVolume=0;0==volume&&(newVolume=1),paella.player.videoContainer.setVolume({master:newVolume,slave:0})})},volumeUp:function(){var videoContainer=paella.player.videoContainer;videoContainer.volume().then(function(volume){volume+=.1,volume=volume>1?1:volume,paella.player.videoContainer.setVolume({master:volume,slave:0})})},volumeDown:function(){var videoContainer=paella.player.videoContainer;videoContainer.volume().then(function(volume){volume-=.1,volume=volume<0?0:volume,paella.player.videoContainer.setVolume({master:volume,slave:0})})}}),paella.keyManager=new paella.KeyManager,Class("paella.VideoLoader",{metadata:{title:"",duration:0},streams:[],frameList:[],loadStatus:!1,codecStatus:!1,getMetadata:function(){return this.metadata},loadVideo:function(videoId,onSuccess){onSuccess()}}),Class("paella.AccessControl",{canRead:function(){return paella_DeferredResolved(!0)},canWrite:function(){return paella_DeferredResolved(!1)},userData:function(){return paella_DeferredResolved({username:"anonymous",name:"Anonymous",avatar:paella.utils.folders.resources()+"/images/default_avatar.png",isAnonymous:!0})},getAuthenticationUrl:function(callbackParams){var authCallback=this._authParams.authCallbackName&&window[this._authParams.authCallbackName];return!authCallback&&paella.player.config.auth&&(authCallback=paella.player.config.auth.authCallbackName&&window[paella.player.config.auth.authCallbackName]),"function"==typeof authCallback?authCallback(callbackParams):""}}),Class("paella.PlayerBase",{config:null,playerId:"",mainContainer:null,videoContainer:null,controls:null,accessControl:null,checkCompatibility:function(){var message="";if(base.parameters.get("ignoreBrowserCheck"))return!0;if(base.userAgent.browser.IsMobileVersion)return!0;var isCompatible=base.userAgent.browser.Chrome||base.userAgent.browser.Safari||base.userAgent.browser.Firefox||base.userAgent.browser.Opera||base.userAgent.browser.Edge||base.userAgent.browser.Explorer&&base.userAgent.browser.Version.major>=9;if(isCompatible)return!0;var errorMessage=base.dictionary.translate("It seems that your browser is not HTML 5 compatible");return paella.events.trigger(paella.events.error,{error:errorMessage}),message=errorMessage+'<div style="display:block;width:470px;height:140px;margin-left:auto;margin-right:auto;font-family:Verdana,sans-sherif;font-size:12px;"><a href="http://www.google.es/chrome" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/chrome.png" style="width:80px;height:80px" alt="Google Chrome"></img><p>Google Chrome</p></a><a href="http://windows.microsoft.com/en-US/internet-explorer/products/ie/home" style="color:#004488;float:left;margin-right:20px;"><img src="'+paella.utils.folders.resources()+'images/explorer.png" style="width:80px;height:80px" alt="Internet Explorer 9"></img><p>Internet Explorer 9</p></a><a href="http://www.apple.com/safari/" style="float:left;margin-right:20px;color:#004488"><img src="'+paella.utils.folders.resources()+'images/safari.png" style="width:80px;height:80px" alt="Safari"></img><p>Safari 5</p></a><a href="http://www.mozilla.org/firefox/" style="float:left;color:#004488"><img src="'+paella.utils.folders.resources()+'images/firefox.png" style="width:80px;height:80px" alt="Firefox"></img><p>Firefox 12</p></a></div>',message+='<div style="margin-top:30px;"><a id="ignoreBrowserCheckLink" href="#" onclick="window.location = window.location + \'&ignoreBrowserCheck=true\'">'+base.dictionary.translate("Continue anyway")+"</a></div>",paella.messageBox.showError(message,{height:"40%"}),!1},initialize:function(playerId){if(void 0!=base.parameters.get("log")){var log=0;switch(base.parameters.get("log")){case"error":log=base.Log.kLevelError;break;case"warn":log=base.Log.kLevelWarning;break;case"debug":log=base.Log.kLevelDebug;break;case"log":case"true":log=base.Log.kLevelLog}base.log.setLevel(log)}if(this.checkCompatibility()){paella.player=this,this.playerId=playerId,this.mainContainer=$("#"+this.playerId)[0];var thisClass=this;paella.events.bind(paella.events.loadComplete,function(event,params){thisClass.loadComplete(event,params)})}else base.log.debug("It seems that your browser is not HTML 5 compatible")},loadComplete:function(event,params){},auth:{login:function(redirect){redirect=redirect||window.location.href;var url=paella.initDelegate.initParams.accessControl.getAuthenticationUrl(redirect);url&&(window.location.href=url)},canRead:function(){return paella.initDelegate.initParams.accessControl.canRead()},canWrite:function(){return paella.initDelegate.initParams.accessControl.canWrite()},userData:function(){return paella.initDelegate.initParams.accessControl.userData()}}}),Class("paella.InitDelegate",{initParams:{configUrl:"config/config.json",dictionaryUrl:"localization/paella",accessControl:null,videoLoader:null},initialize:function(params){if(params)for(var key in params)this.initParams[key]=params[key]},getId:function(){return base.parameters.get("id")||"noid"},loadDictionary:function(){var defer=new $.Deferred;return base.ajax.get({url:this.initParams.dictionaryUrl+"_"+base.dictionary.currentLanguage()+".json"},function(data,type,returnCode){base.dictionary.addDictionary(data),defer.resolve(data)},function(data,type,returnCode){defer.resolve()}),defer},loadConfig:function(){var This=this,defer=new $.Deferred,configUrl=this.initParams.configUrl,params={};return params.url=configUrl,base.ajax.get(params,function(data,type,returnCode){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){return void defer.reject()}base.dictionary.addDictionary(data);var AccessControlClass=Class.fromString(data.player.accessControlClass||"paella.AccessControl");This.initParams.accessControl=new AccessControlClass,defer.resolve(data)},function(data,type,returnCode){paella.messageBox.showError(base.dictionary.translate("Error! Config file not found. Please configure paella!"))}),defer}});var paellaPlayer=null;paella.plugins={},paella.plugins.events={},paella.initDelegate=null,Class("paella.PaellaPlayer",paella.PlayerBase,{player:null,videoIdentifier:"",loader:null,videoData:null,getPlayerMode:function(){return paella.player.isFullScreen()?paella.PaellaPlayer.mode.fullscreen:window.self!==window.top?paella.PaellaPlayer.mode.embed:paella.PaellaPlayer.mode.standard},checkFullScreenCapability:function(){var fs=document.getElementById(paella.player.mainContainer.id);return!!(fs.webkitRequestFullScreen||fs.mozRequestFullScreen||fs.msRequestFullscreen||fs.requestFullScreen)||!(!base.userAgent.browser.IsMobileVersion||!paella.player.videoContainer.isMonostream)},addFullScreenListeners:function(){var thisClass=this,onFullScreenChangeEvent=function(){setTimeout(function(){paella.pluginManager.checkPluginsVisibility()},1e3);var fs=document.getElementById(paella.player.mainContainer.id);paella.player.isFullScreen()?(fs.style.width="100%",fs.style.height="100%"):(fs.style.width="",fs.style.height=""),thisClass.isFullScreen()?paella.events.trigger(paella.events.enterFullscreen):paella.events.trigger(paella.events.exitFullscreen)};this.eventFullScreenListenerAdded||(this.eventFullScreenListenerAdded=!0,document.addEventListener("fullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("webkitfullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("mozfullscreenchange",onFullScreenChangeEvent,!1),document.addEventListener("MSFullscreenChange",onFullScreenChangeEvent,!1),document.addEventListener("webkitendfullscreen",onFullScreenChangeEvent,!1))},isFullScreen:function(){var webKitIsFullScreen=document.webkitIsFullScreen===!0,msIsFullScreen=void 0!==document.msFullscreenElement&&null!==document.msFullscreenElement,mozIsFullScreen=document.mozFullScreen===!0,stdIsFullScreen=void 0!==document.fullScreenElement&&null!==document.fullScreenElement;return webKitIsFullScreen||msIsFullScreen||mozIsFullScreen||stdIsFullScreen},goFullScreen:function(){if(!this.isFullScreen())if(base.userAgent.browser.IsMobileVersion&&paella.player.videoContainer.isMonostream)paella.player.videoContainer.masterVideo().goFullScreen();else{var fs=document.getElementById(paella.player.mainContainer.id);fs.webkitRequestFullScreen?fs.webkitRequestFullScreen():fs.mozRequestFullScreen?fs.mozRequestFullScreen():fs.msRequestFullscreen?fs.msRequestFullscreen():fs.requestFullScreen&&fs.requestFullScreen()}},exitFullScreen:function(){this.isFullScreen()&&(document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.msExitFullscreen()?document.msExitFullscreen():document.cancelFullScreen&&document.cancelFullScreen())},setProfile:function(profileName,animate){this.videoContainer.setProfile(profileName,animate)},initialize:function(playerId){if(this.parent(playerId),this.playerId==playerId){this.loadPaellaPlayer();var thisClass=this;paella.events.bind(paella.events.setProfile,function(event,params){thisClass.setProfile(params.profileName)})}Object.defineProperty(this,"selectedProfile",{get:function(){return this.videoContainer.getCurrentProfileName()}})},loadPaellaPlayer:function(){var This=this;this.loader=new paella.LoaderContainer("paellaPlayer_loader"),$("body")[0].appendChild(this.loader.domElement),paella.events.trigger(paella.events.loadStarted),paella.initDelegate.loadDictionary().then(function(){return paella.initDelegate.loadConfig()}).then(function(config){if(This.accessControl=paella.initDelegate.initParams.accessControl,This.onLoadConfig(config),config.skin){var skin=config.skin.default||"dark";paella.utils.skin.restore(skin)}})},onLoadConfig:function(configData){if(paella.data=new paella.Data(configData),this.config=configData,this.videoIdentifier=paella.initDelegate.getId(),this.videoIdentifier){if(this.mainContainer){this.videoContainer=new paella.VideoContainer(this.playerId+"_videoContainer");var videoQualityStrategy=new paella.BestFitVideoQualityStrategy;try{var StrategyClass=this.config.player.videoQualityStrategy,ClassObject=Class.fromString(StrategyClass);videoQualityStrategy=new ClassObject}catch(e){base.log.warning("Error selecting video quality strategy: strategy not found")}this.videoContainer.setVideoQualityStrategy(videoQualityStrategy),this.mainContainer.appendChild(this.videoContainer.domElement)}$(window).resize(function(event){paella.player.onresize()}),this.onload()}paella.pluginManager.loadPlugins("paella.FastLoadPlugin")},onload:function(){var thisClass=this,canRead=(this.accessControl,!1),userData={};this.accessControl.canRead().then(function(c){return canRead=c,thisClass.accessControl.userData()}).then(function(d){if(userData=d,canRead)thisClass.loadVideo(),thisClass.videoContainer.publishVideo();else if(userData.isAnonymous){var redirectUrl=paella.initDelegate.initParams.accessControl.getAuthenticationUrl("player/?id="+paella.player.videoIdentifier),message="<div>"+base.dictionary.translate("You are not authorized to view this resource")+"</div>";redirectUrl&&(message+='<div class="login-link"><a href="'+redirectUrl+'">'+base.dictionary.translate("Login")+"</a></div>"),thisClass.unloadAll(message)}else errorMessage=base.dictionary.translate("You are not authorized to view this resource"),thisClass.unloadAll(errorMessage),paella.events.trigger(paella.events.error,{error:errorMessage})}).fail(function(){errorMessage=base.dictionary.translate("Error loading video"),thisClass.unloadAll(errorMessage),paella.events.trigger(paella.events.error,{error:errorMessage})})},onresize:function(){this.videoContainer.onresize(),this.controls&&this.controls.onresize();var cookieProfile=paella.utils.cookies.get("lastProfile");cookieProfile?this.setProfile(cookieProfile,!1):this.setProfile(paella.Profiles.getDefaultProfile(),!1),paella.events.trigger(paella.events.resize,{width:$(this.videoContainer.domElement).width(),height:$(this.videoContainer.domElement).height()})},unloadAll:function(message){$("#paellaPlayer_loader")[0];this.mainContainer.innerHTML="",paella.messageBox.showError(message)},reloadVideos:function(masterQuality,slaveQuality){this.videoContainer&&(this.videoContainer.reloadVideos(masterQuality,slaveQuality),this.onresize())},loadVideo:function(){if(this.videoIdentifier){var This=this,loader=paella.initDelegate.initParams.videoLoader;paella.player.videoLoader=loader,this.onresize(),loader.loadVideo(this.videoIdentifier,function(){This.videoContainer.setStreamData(loader.streams).done(function(){paella.events.trigger(paella.events.loadComplete),This.addFullScreenListeners(),This.onresize(),This.videoContainer.autoplay()&&This.play()}).fail(function(error){console.log(error)})})}},showPlaybackBar:function(){this.controls||(this.controls=new paella.ControlsContainer(this.playerId+"_controls"),this.mainContainer.appendChild(this.controls.domElement),this.controls.onresize(),paella.events.trigger(paella.events.loadPlugins,{pluginManager:paella.pluginManager}))},isLiveStream:function(){if(void 0===this._isLiveStream){var loader=paella.initDelegate.initParams.videoLoader,checkSource=function(sources,index){if(sources.length>index){var source=sources[index];for(var key in source.sources)if("object"==typeof source.sources[key])for(var i=0;i<source.sources[key].length;++i){var stream=source.sources[key][i];if(stream.isLiveStream)return!0}}return!1};this._isLiveStream=checkSource(loader.streams,0)||checkSource(loader.streams,1)}return this._isLiveStream},loadPreviews:function(){var streams=paella.initDelegate.initParams.videoLoader.streams,slavePreviewImg=null,masterPreviewImg=streams[0].preview;if(streams.length>=2&&(slavePreviewImg=streams[1].preview),masterPreviewImg){var masterRect=paella.player.videoContainer.overlayContainer.getMasterRect();this.masterPreviewElem=document.createElement("img"),this.masterPreviewElem.src=masterPreviewImg,paella.player.videoContainer.overlayContainer.addElement(this.masterPreviewElem,masterRect)}if(slavePreviewImg){var slaveRect=paella.player.videoContainer.overlayContainer.getSlaveRect();this.slavePreviewElem=document.createElement("img"),this.slavePreviewElem.src=slavePreviewImg,paella.player.videoContainer.overlayContainer.addElement(this.slavePreviewElem,slaveRect)}paella.events.bind(paella.events.timeUpdate,function(event){paella.player.unloadPreviews()})},unloadPreviews:function(){this.masterPreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.masterPreviewElem),this.masterPreviewElem=null),this.slavePreviewElem&&(paella.player.videoContainer.overlayContainer.removeElement(this.slavePreviewElem),this.slavePreviewElem=null)},loadComplete:function(event,params){paella.pluginManager.loadPlugins("paella.EarlyLoadPlugin"),paella.player.videoContainer._autoplay&&this.play()},play:function(){if(!this.controls){this.showPlaybackBar();var urlParamTime=base.parameters.get("time"),hashParamTime=base.hashParams.get("time"),timeString=hashParamTime?hashParamTime:urlParamTime?urlParamTime:"0s",startTime=paella.utils.timeParse.timeToSeconds(timeString);startTime&&paella.player.videoContainer.setStartTime(startTime),paella.events.trigger(paella.events.controlBarLoaded),this.controls.onresize()}return this.videoContainer.play()},pause:function(){return this.videoContainer.pause()},playing:function(){var defer=$.Deferred();return this.paused().then(function(p){defer.resolve(!p)}),defer},paused:function(){return this.videoContainer.paused()}});var PaellaPlayer=paella.PaellaPlayer;paella.PaellaPlayer.mode={standard:"standard",fullscreen:"fullscreen",embed:"embed"},Class("paella.DefaultVideoLoader",paella.VideoLoader,{_url:null,initialize:function(data){if("object"==typeof data)this._data=data;else try{this._data=JSON.parse(data)}catch(e){this._url=data}},loadVideo:function(videoId,onSuccess){if(this._data)this.loadVideoData(this._data,onSuccess);else if(this._url){var This=this;this._url=(/\/$/.test(this._url)?this._url:this._url+"/")+videoId+"/",base.ajax.get({url:this._url+"data.json"},function(data,type,err){if("string"==typeof data)try{data=JSON.parse(data)}catch(e){}This._data=data,This.loadVideoData(This._data,onSuccess)},function(data,type,err){switch(err){case 401:paella.messageBox.showError(base.dictionary.translate("You are not logged in"));break;case 403:paella.messageBox.showError(base.dictionary.translate("You are not authorized to view this resource"));break;case 404:paella.messageBox.showError(base.dictionary.translate("The specified video identifier does not exist"));break;default:paella.messageBox.showError(base.dictionary.translate("Could not load the video"))}})}},loadVideoData:function(data,onSuccess){var This=this;data.metadata&&(this.metadata=data.metadata),data.streams&&data.streams.forEach(function(stream){This.loadStream(stream)}),data.frameList&&this.loadFrameData(data),data.captions&&this.loadCaptions(data.captions),data.blackboard&&this.loadBlackboard(data.streams[0],data.blackboard),this.streams=data.streams,this.frameList=data.frameList,this.loadStatus=this.streams.length>0,onSuccess()},loadFrameData:function(data){var This=this;if(data.frameList&&data.frameList.forEach){var newFrames={};data.frameList.forEach(function(frame){/^[a-zA-Z]+:\/\//.test(frame.url)||/^data:/.test(frame.url)||(frame.url=This._url+frame.url),!frame.thumb||/^[a-zA-Z]+:\/\//.test(frame.thumb)||/^data:/.test(frame.thumb)||(frame.thumb=This._url+frame.thumb);var id=frame.time;newFrames[id]=frame}),data.frameList=newFrames}},loadStream:function(stream){var This=this;!stream.preview||/^[a-zA-Z]+:\/\//.test(stream.preview)||/^data:/.test(stream.preview)||(stream.preview=This._url+stream.preview),stream.sources.image&&stream.sources.image.forEach(function(image){if(image.frames.forEach){var newFrames={};image.frames.forEach(function(frame){!frame.src||/^[a-zA-Z]+:\/\//.test(frame.src)||/^data:/.test(frame.src)||(frame.src=This._url+frame.src),!frame.thumb||/^[a-zA-Z]+:\/\//.test(frame.thumb)||/^data:/.test(frame.thumb)||(frame.thumb=This._url+frame.thumb);var id="frame_"+frame.time;newFrames[id]=frame.src}),image.frames=newFrames}});for(var type in stream.sources)if(stream.sources[type]){if("image"!=type){var source=stream.sources[type];source.forEach(function(sourceItem){var pattern=/^[a-zA-Z\:]+\:\/\//gi;"string"==typeof sourceItem.src&&null==sourceItem.src.match(pattern)&&(sourceItem.src=This._url+sourceItem.src),sourceItem.type=sourceItem.mimetype})}}else delete stream.sources[type]},loadCaptions:function(captions){if(captions)for(var i=0;i<captions.length;++i){var url=captions[i].url;/^[a-zA-Z]+:\/\//.test(url)||(url=this._url+url);var c=new paella.captions.Caption(i,captions[i].format,url,{code:captions[i].lang,txt:captions[i].text});paella.captions.addCaptions(c)}},loadBlackboard:function(stream,blackboard){var This=this;stream.sources.image||(stream.sources.image=[]);var imageObject={count:blackboard.frames.length,duration:blackboard.duration,mimetype:blackboard.mimetype,res:blackboard.res,frames:{}};blackboard.frames.forEach(function(frame){var id="frame_"+Math.round(frame.time);/^[a-zA-Z]+:\/\//.test(frame.src)||(frame.src=This._url+frame.src),imageObject.frames[id]=frame.src}),stream.sources.image.push(imageObject)}}),Class("paella.DefaultInitDelegate",paella.InitDelegate,{initialize:function(config,params){1==arguments.length?this.parent(arguments[0]):2==arguments.length&&(this._config=arguments[0],this.parent(arguments[1]))},loadConfig:function(){if(this._config){var defer=new $.Deferred;return defer.resolve(this._config),defer}return this.parent()}}),paella.load=function(playerContainer,params){var initObjects=(params&&params.auth||{},{videoLoader:new paella.DefaultVideoLoader(params.data||params.url)});params.config?paella.initDelegate=new paella.DefaultInitDelegate(params.config,initObjects):paella.initDelegate=new paella.DefaultInitDelegate(initObjects),new PaellaPlayer(playerContainer,paella.initDelegate)},Class("paella.RightBarPlugin",paella.DeferredLoadPlugin,{type:"rightBarPlugin",getName:function(){return"es.upv.paella.RightBarPlugin"},buildContent:function(domElement){}}),Class("paella.TabBarPlugin",paella.DeferredLoadPlugin,{type:"tabBarPlugin",getName:function(){return"es.upv.paella.TabBarPlugin"},getTabName:function(){return"New Tab"},action:function(tab){},buildContent:function(domElement){},setToolTip:function(message){this.button.setAttribute("title",message),this.button.setAttribute("aria-label",message)},getDefaultToolTip:function(){return""}}),Class("paella.ExtendedAdapter",{rightContainer:null,bottomContainer:null,rightBarPlugins:[],tabBarPlugins:[],currentTabIndex:0,bottomContainerTabs:null,bottomContainerContent:null,initialize:function(){this.rightContainer=document.createElement("div"),this.rightContainer.className="rightPluginContainer",this.bottomContainer=document.createElement("div"),this.bottomContainer.className="tabsPluginContainer";var tabs=document.createElement("div");tabs.className="tabsLabelContainer",this.bottomContainerTabs=tabs,this.bottomContainer.appendChild(tabs);var bottomContent=document.createElement("div");bottomContent.className="tabsContentContainer",this.bottomContainerContent=bottomContent,this.bottomContainer.appendChild(bottomContent),this.initPlugins()},initPlugins:function(){paella.pluginManager.setTarget("rightBarPlugin",this),paella.pluginManager.setTarget("tabBarPlugin",this)},addPlugin:function(plugin){var thisClass=this;plugin.checkEnabled(function(isEnabled){isEnabled&&(paella.pluginManager.setupPlugin(plugin),"rightBarPlugin"==plugin.type&&(thisClass.rightBarPlugins.push(plugin),thisClass.addRightBarPlugin(plugin)),"tabBarPlugin"==plugin.type&&(thisClass.tabBarPlugins.push(plugin),thisClass.addTabPlugin(plugin)))})},showTab:function(tabIndex){var i=0,labels=this.bottomContainer.getElementsByClassName("tabLabel"),contents=this.bottomContainer.getElementsByClassName("tabContent");for(i=0;i<labels.length;++i)labels[i].getAttribute("tab")==tabIndex?labels[i].className="tabLabel enabled":labels[i].className="tabLabel disabled";for(i=0;i<contents.length;++i)contents[i].getAttribute("tab")==tabIndex?contents[i].className="tabContent enabled":contents[i].className="tabContent disabled"},addTabPlugin:function(plugin){var thisClass=this,tabIndex=this.currentTabIndex,tabItem=document.createElement("div");tabItem.setAttribute("tab",tabIndex),tabItem.className="tabLabel disabled",tabItem.innerHTML=plugin.getTabName(),tabItem.plugin=plugin,$(tabItem).click(function(event){/disabled/.test(this.className)&&(thisClass.showTab(tabIndex),this.plugin.action(this))}),$(tabItem).keyup(function(event){13==event.keyCode&&/disabledTabItem/.test(this.className)&&(thisClass.showTab(tabIndex),this.plugin.action(this))}),this.bottomContainerTabs.appendChild(tabItem);var tabContent=document.createElement("div");tabContent.setAttribute("tab",tabIndex),tabContent.className="tabContent disabled "+plugin.getSubclass(),this.bottomContainerContent.appendChild(tabContent),plugin.buildContent(tabContent),plugin.button=tabItem,plugin.container=tabContent,plugin.button.setAttribute("tabindex",3e3+plugin.getIndex()),plugin.button.setAttribute("alt",""),plugin.setToolTip(plugin.getDefaultToolTip()),void 0===this.firstTabShown&&(this.showTab(tabIndex),this.firstTabShown=!0),++this.currentTabIndex},addRightBarPlugin:function(plugin){var container=document.createElement("div");container.className="rightBarPluginContainer "+plugin.getSubclass(),this.rightContainer.appendChild(container),plugin.buildContent(container)}}),paella.extendedAdapter=new paella.ExtendedAdapter,Class("paella.editor.EmbedPlayer",base.AsyncLoaderCallback,{editar:null,initialize:function(){this.editor=paella.editor.instance},load:function(onSuccess,onError){var barHeight=this.editor.bottomBar.getHeight()+20,rightBarWidth=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:barHeight+"px",right:rightBarWidth+"px",left:"20px",top:"20px"}),paella.player.mainContainer.className="paellaMainContainerEditorMode",new Timer(function(timer){paella.player.controls.disable(),paella.player.onresize(),onSuccess&&onSuccess()},500)},restorePlayer:function(){$("body")[0].appendChild(paella.player.mainContainer),paella.player.controls.enable(),paella.player.mainContainer.className="",$(paella.player.mainContainer).css({position:"",width:"",bottom:"",left:"",right:"",top:""}),paella.player.onresize()},onresize:function(){var barHeight=this.editor.bottomBar.getHeight()+20,rightBarWidth=this.editor.rightBar.getWidth()+20;$(paella.player.mainContainer).css({position:"fixed",width:"",bottom:barHeight+"px",right:rightBarWidth+"px",left:"20px",top:"20px"})}}),DeprecatedClass("paella.Dictionary","base.Dictionary",base.Dictionary),paella.dictionary=base.dictionary,DeprecatedClass("paella.AsyncLoaderCallback","base.AsyncLoaderCallback",base.AsyncLoaderCallback),DeprecatedClass("paella.AjaxCallback","base.AjaxCallback",base.AjaxCallback),DeprecatedClass("paella.JSONCallback","base.JSONCallback",base.JSONCallback),DeprecatedClass("paella.DictionaryCallback","base.DictionaryCallback",base.DictionaryCallback),DeprecatedClass("paella.AsyncLoader","base.AsyncLoader",base.AsyncLoader),DeprecatedClass("paella.Timer","base.Timer",base.Timer),DeprecatedClass("paella.utils.Timer","base.Timer",base.Timer),paella.ajax={},paella.ajax.send=DeprecatedFunc("paella.ajax.send","base.ajax.send",base.ajax.send),paella.ajax.get=DeprecatedFunc("paella.ajax.get","base.ajax.get",base.ajax.get),
paella.ajax.put=DeprecatedFunc("paella.ajax.put","base.ajax.put",base.ajax.put),paella.ajax.post=DeprecatedFunc("paella.ajax.post","base.ajax.post",base.ajax.post),paella.ajax.delete=DeprecatedFunc("paella.ajax.delete","base.ajax.delete",base.ajax.send),paella.ui={},paella.ui.Container=function(params){var elem=document.createElement("div");return params.id&&(elem.id=params.id),params.className&&(elem.className=params.className),params.style&&$(elem).css(params.style),elem},paella.utils.ajax=base.ajax,paella.utils.cookies=base.cookies,paella.utils.parameters=base.parameters,paella.utils.require=base.require,paella.utils.importStylesheet=base.importStylesheet,paella.utils.language=base.dictionary.currentLanguage,paella.utils.uuid=base.uuid,paella.utils.userAgent=base.userAgent,paella.debug={log:function(msg){base.log.warning("paella.debug.log is deprecated, use base.debug.[error/warning/debug/log] instead."),base.log.log(msg)}},Class("paella.plugins.FlexSkipPlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getName:function(){return"edu.harvard.dce.paella.flexSkipPlugin"},getIndex:function(){return 121},getSubclass:function(){return"flexSkip_Rewind_10"},formatMessage:function(){return"Rewind 10 seconds"},getDefaultToolTip:function(){return base.dictionary.translate(this.formatMessage())},getMinWindowSize:function(){return 510},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},action:function(button){paella.player.videoContainer.currentTime().then(function(currentTime){paella.player.videoContainer.seekToTime(currentTime-10)})}}),paella.plugins.flexSkipPlugin=new paella.plugins.FlexSkipPlugin,Class("paella.plugins.FlexSkipForwardPlugin",paella.plugins.FlexSkipPlugin,{getIndex:function(){return 122},getName:function(){return"edu.harvard.dce.paella.flexSkipForwardPlugin"},getSubclass:function(){return"flexSkip_Forward_30"},formatMessage:function(){return"Forward 30 seconds"},action:function(button){paella.player.videoContainer.currentTime().then(function(currentTime){paella.player.videoContainer.seekToTime(currentTime+30)})}}),paella.plugins.flexSkipForwardPlugin=new paella.plugins.FlexSkipForwardPlugin,Class("paella.plugins.playlistPlugin",paella.ButtonPlugin,{currentPlaylistId:null,currentVideoId:null,currentVideoPos:null,currentVideo:null,playlistVideos:[],getAlignment:function(){return"left"},getSubclass:function(){return"playlistPlugin"},getIndex:function(){return 400},getName:function(){return"es.teltek.paella.playlistPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Playlist")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(onSuccess){this.currentPlaylistId=base.parameters.get("playlistId"),this.currentVideoId=base.parameters.get("videoId"),this.currentVideoPos=base.parameters.get("videoPos"),onSuccess(this.currentPlaylistId&&this.currentVideoId&&this.currentVideoPos?!0:!1)},findVideo:function(){var currentVideo=null,playlistPlugin=this;return this.playlistVideos.find(function(item){if(item.id==playlistPlugin.currentVideoId)return currentVideo=item,item.pos==playlistPlugin.currentVideoPos}),currentVideo},setup:function(){var url=this.config.playlistApi+"/"+this.currentPlaylistId,playlistPlugin=this;base.ajax.get({url:url},function(data,contentType,returnCode){playlistPlugin.playlistVideos=data,playlistPlugin.currentVideo=playlistPlugin.findVideo(),container=playlistPlugin.containerManager.containers[playlistPlugin.getName()],container&&container.element&&playlistPlugin.buildContent(container.element)}),paella.events.bind(paella.events.endVideo,function(event){playlistPlugin.goToNextVideo()})},buildContent:function(domElement){for(;domElement.hasChildNodes();)domElement.removeChild(domElement.lastChild);var playlistPlugin=this;this.playlistVideos.forEach(function(item){var elem=document.createElement("div");elem.className="videobutton"+(item==playlistPlugin.currentVideo?" playing":""),elem.innerHTML=item.name,$(elem).click(function(event){window.location.href=item.url}),domElement.appendChild(elem)})},goToNextVideo:function(){var playlistPlugin=this,index=this.playlistVideos.findIndex(function(elem){return elem==playlistPlugin.currentVideo}),length=this.playlistVideos.length,next=this.playlistVideos[(index+1)%length];window.location.href=next.url}}),paella.plugins.playlistPlugin=new paella.plugins.playlistPlugin,paella.plugins.TrimmingTrackPlugin=Class.create(paella.editor.MainTrackPlugin,{trimmingTrack:null,trimmingData:{s:0,e:0},getTrackItems:function(){null==this.trimmingTrack&&(this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=paella.player.videoContainer.trimStart(),this.trimmingTrack.e=paella.player.videoContainer.trimEnd(),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e);var tracks=[];return tracks.push(this.trimmingTrack),tracks},getName:function(){return"es.upv.paella.editor.trimmingTrackPlugin"},getTools:function(){if(this.config.enableResetButton)return[{name:"reset",label:base.dictionary.translate("Reset"),hint:base.dictionary.translate("Resets the trimming bar to the default length of the video.")}]},onToolSelected:function(toolName){if(this.config.enableResetButton&&"reset"==toolName)return this.trimmingTrack={id:1,s:0,e:0},this.trimmingTrack.s=0,this.trimmingTrack.e=paella.player.videoContainer.duration(!0),!0},getTrackName:function(){return base.dictionary.translate("Trimming")},getColor:function(){return"rgb(0, 51, 107)"},onSave:function(onDone){paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimmingStart(this.trimmingTrack.s),paella.player.videoContainer.setTrimmingEnd(this.trimmingTrack.e),this.trimmingData.s=this.trimmingTrack.s,this.trimmingData.e=this.trimmingTrack.e,paella.data.write("trimming",{id:paella.initDelegate.getId()},{start:this.trimmingTrack.s,end:this.trimmingTrack.e},function(data,status){onDone(status)})},onDiscard:function(onDone){this.trimmingTrack.s=this.trimmingData.s,this.trimmingTrack.e=this.trimmingData.e,onDone(!0)},allowDrag:function(){return!1},onTrackChanged:function(id,start,end){playerEnd=paella.player.videoContainer.duration(!0),start=start<0?0:start,end=end>playerEnd?playerEnd:end,this.trimmingTrack.s=start,this.trimmingTrack.e=end,this.parent(id,start,end)},contextHelpString:function(){return"es"==base.dictionary.currentLanguage()?'Utiliza la herramienta de recorte para definir el instante inicial y el instante final de la clase. Para cambiar la duración solo hay que arrastrar el inicio o el final de la pista "Recorte", en la linea de tiempo.':"Use this tool to define the start and finish time."}}),paella.plugins.trimmingTrackPlugin=new paella.plugins.TrimmingTrackPlugin,Class("paella.plugins.TrimmingLoaderPlugin",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.trimmingPlayerPlugin"},getEvents:function(){return[paella.events.controlBarLoaded,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(eventType,params){switch(eventType){case paella.events.controlBarLoaded:this.loadTrimming();break;case paella.events.showEditor:paella.player.videoContainer.disableTrimming();break;case paella.events.hideEditor:paella.player.config.trimming&&paella.player.config.trimming.enabled&&paella.player.videoContainer.enableTrimming()}},loadTrimming:function(){var videoId=paella.initDelegate.getId();paella.data.read("trimming",{id:videoId},function(data,status){if(data&&status&&data.end>0)paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimming(data.start,data.end);else{var startTime=base.parameters.get("start"),endTime=base.parameters.get("end");startTime&&endTime&&(paella.player.videoContainer.enableTrimming(),paella.player.videoContainer.setTrimming(startTime,endTime))}})}}),paella.plugins.trimmingLoaderPlugin=new paella.plugins.TrimmingLoaderPlugin,Class("paella.plugins.AnnotationsPlayerPlugin",paella.EventDrivenPlugin,{annotations:null,lastEvent:0,visibleAnnotations:null,getName:function(){return"es.upv.paella.annotationsPlayerPlugin"},checkEnabled:function(onSuccess){var This=this;this.annotations=[],this.visibleAnnotations=[],paella.data.read("annotations",{id:paella.initDelegate.getId()},function(data,status){data&&"object"==typeof data&&data.annotations&&data.annotations.length>0&&(This.annotations=data.annotations),onSuccess(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(eventType,params){this.checkAnnotations(params)},checkAnnotations:function(params){for(var a,i=0;i<this.annotations.length;++i)a=this.annotations[i],a.s<params.currentTime&&a.e>params.currentTime&&this.showAnnotation(a);for(var key in this.visibleAnnotations)"object"==typeof a&&(a=this.visibleAnnotations[key],a&&(a.s>=params.currentTime||a.e<=params.currentTime)&&this.removeAnnotation(a))},showAnnotation:function(annotation){if(!this.visibleAnnotations[annotation.s]){var rect={left:100,top:10,width:1080,height:20};annotation.elem=paella.player.videoContainer.overlayContainer.addText(annotation.content,rect),annotation.elem.className="textAnnotation",this.visibleAnnotations[annotation.s]=annotation}},removeAnnotation:function(annotation){if(this.visibleAnnotations[annotation.s]){var elem=this.visibleAnnotations[annotation.s].elem;paella.player.videoContainer.overlayContainer.removeElement(elem),this.visibleAnnotations[annotation.s]=null}}}),paella.plugins.annotationsPlayerlugin=new paella.plugins.AnnotationsPlayerPlugin,Class("paella.BlackBoard2",paella.EventDrivenPlugin,{_blackBoardProfile:"s_p_blackboard2",_blackBoardDIV:null,_hasImages:null,_active:!1,_creationTimer:500,_zImages:null,_videoLength:null,_keys:null,_actualImage:null,_next:null,_ant:null,_lensDIV:null,_lensContainer:null,_lensWidth:null,_lensHeight:null,_conImg:null,_zoom:250,_currentZoom:null,_maxZoom:500,_mousePos:null,_containerRect:null,getName:function(){return"es.upv.paella.blackBoardPlugin"},getIndex:function(){return 10},getAlignment:function(){return"right"},getSubclass:function(){return"blackBoardButton2"},getDefaultToolTip:function(){return base.dictionary.translate("BlackBoard")},checkEnabled:function(onSuccess){onSuccess(!0)},getEvents:function(){return[paella.events.setProfile,paella.events.timeUpdate]},onEvent:function(event,params){var self=this;switch(event){case paella.events.setProfile:if(params.profileName!=self._blackBoardProfile){self._active&&(self.destroyOverlay(),self._active=!1);break}self._hasImages||paella.player.setProfile("slide_professor"),self._hasImages&&!self._active&&(self.createOverlay(),self._active=!0);break;case paella.events.timeUpdate:self._active&&self._hasImages&&self.imageUpdate(event,params)}},setup:function(){var self=this,n=paella.player.videoContainer.sourceData[0].sources;n.hasOwnProperty("image")?(self._hasImages=!0,self._zImages={},self._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,self._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,self._keys=Object.keys(self._zImages),self._keys=self._keys.sort(function(a,b){return a=a.slice(6),b=b.slice(6),parseInt(a)-parseInt(b)})):(self._hasImages=!1,paella.player.selectedProfile==self._blackBoardProfile&&(defaultprofile=paella.player.config.defaultProfile,paella.player.setProfile(defaultprofile))),this._next=0,this._ant=0,paella.player.selectedProfile==self._blackBoardProfile&&(self.createOverlay(),self._active=!0),self._mousePos={},paella.Profiles.loadProfile(self._blackBoardProfile,function(profileData){self._containerRect=profileData.blackBoardImages})},createLens:function(){var self=this;null==self._currentZoom&&(self._currentZoom=self._zoom);var lens=document.createElement("div");lens.className="lensClass",self._lensDIV=lens;var p=$(".conImg").offset(),width=$(".conImg").width(),height=$(".conImg").height();lens.style.width=width/(self._currentZoom/100)+"px",lens.style.height=height/(self._currentZoom/100)+"px",self._lensWidth=parseInt(lens.style.width),self._lensHeight=parseInt(lens.style.height),$(self._lensContainer).append(lens),$(self._lensContainer).mousemove(function(event){if(mouseX=event.pageX-p.left,mouseY=event.pageY-p.top,self._mousePos.x=mouseX,self._mousePos.y=mouseY,lensTop=mouseY-self._lensHeight/2,lensTop=lensTop<0?0:lensTop,lensTop=lensTop>height-self._lensHeight?height-self._lensHeight:lensTop,lensLeft=mouseX-self._lensWidth/2,lensLeft=lensLeft<0?0:lensLeft,lensLeft=lensLeft>width-self._lensWidth?width-self._lensWidth:lensLeft,self._lensDIV.style.left=lensLeft+"px",self._lensDIV.style.top=lensTop+"px",100!=self._currentZoom)x=100*lensLeft/(width-self._lensWidth),y=100*lensTop/(height-self._lensHeight),self._blackBoardDIV.style.backgroundPosition=x.toString()+"% "+y.toString()+"%";else if(100==self._currentZoom){var xRelative=100*mouseX/width,yRelative=100*mouseY/height;self._blackBoardDIV.style.backgroundPosition=xRelative.toString()+"% "+yRelative.toString()+"%"}self._blackBoardDIV.style.backgroundSize=self._currentZoom+"%"}),$(self._lensContainer).bind("wheel mousewheel",function(e){var delta;delta=void 0!==e.originalEvent.wheelDelta?e.originalEvent.wheelDelta:e.originalEvent.deltaY*-1,delta>0&&self._currentZoom<self._maxZoom?self.reBuildLens(10):self._currentZoom>100?self.reBuildLens(-10):100==self._currentZoom&&(self._lensDIV.style.left="0px",self._lensDIV.style.top="0px"),self._blackBoardDIV.style.backgroundSize=self._currentZoom+"%"})},reBuildLens:function(zoomValue){var self=this;self._currentZoom+=zoomValue;var width=($(".conImg").offset(),$(".conImg").width()),height=$(".conImg").height();if(self._lensDIV.style.width=width/(self._currentZoom/100)+"px",self._lensDIV.style.height=height/(self._currentZoom/100)+"px",self._lensWidth=parseInt(self._lensDIV.style.width),self._lensHeight=parseInt(self._lensDIV.style.height),100!=self._currentZoom){var mouseX=self._mousePos.x,mouseY=self._mousePos.y;lensTop=mouseY-self._lensHeight/2,lensTop=lensTop<0?0:lensTop,lensTop=lensTop>height-self._lensHeight?height-self._lensHeight:lensTop,lensLeft=mouseX-self._lensWidth/2,lensLeft=lensLeft<0?0:lensLeft,lensLeft=lensLeft>width-self._lensWidth?width-self._lensWidth:lensLeft,self._lensDIV.style.left=lensLeft+"px",self._lensDIV.style.top=lensTop+"px",x=100*lensLeft/(width-self._lensWidth),y=100*lensTop/(height-self._lensHeight),self._blackBoardDIV.style.backgroundPosition=x.toString()+"% "+y.toString()+"%"}},destroyLens:function(){var self=this;self._lensDIV&&($(self._lensDIV).remove(),self._blackBoardDIV.style.backgroundSize="100%",self._blackBoardDIV.style.opacity=0)},createOverlay:function(){var self=this,blackBoardDiv=document.createElement("div");blackBoardDiv.className="blackBoardDiv",self._blackBoardDIV=blackBoardDiv,self._blackBoardDIV.style.opacity=0;var lensContainer=document.createElement("div");lensContainer.className="lensContainer",self._lensContainer=lensContainer;var conImg=document.createElement("img");conImg.className="conImg",self._conImg=conImg,self._actualImage&&(self._conImg.src=self._actualImage,$(self._blackBoardDIV).css("background-image","url("+self._actualImage+")")),$(lensContainer).append(conImg),$(self._lensContainer).mouseenter(function(){self.createLens(),self._blackBoardDIV.style.opacity=1}),$(self._lensContainer).mouseleave(function(){self.destroyLens()}),setTimeout(function(){overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(blackBoardDiv,overlayContainer.getMasterRect()),overlayContainer.addElement(lensContainer,self._containerRect)},self._creationTimer)},destroyOverlay:function(){var self=this;self._blackBoardDIV&&$(self._blackBoardDIV).remove(),self._lensContainer&&$(self._lensContainer).remove()},imageUpdate:function(event,params){var self=this,sec=Math.round(params.currentTime),src=$(self._blackBoardDIV).css("background-image");if($(self._blackBoardDIV).length>0){if(self._zImages.hasOwnProperty("frame_"+sec)){if(src==self._zImages["frame_"+sec])return;src=self._zImages["frame_"+sec]}else{if(!(sec>self._next||sec<self._ant))return;src=self.returnSrc(sec)}var image=new Image;image.onload=function(){$(self._blackBoardDIV).css("background-image","url("+src+")")},image.src=src,self._actualImage=src,self._conImg.src=self._actualImage}},returnSrc:function(sec){var self=this,ant=0;for(i=0;i<self._keys.length;i++){var id=parseInt(self._keys[i].slice(6)),lastId=parseInt(self._keys[self._keys.length-1].slice(6));if(sec<id)return self._next=id,self._ant=ant,self._imageNumber=i-1,self._zImages["frame_"+ant];if(sec>lastId&&sec<self._videoLength)return self._next=self._videoLength,self._ant=lastId,self._zImages["frame_"+ant];ant=id}}}),paella.plugins.blackBoard2=new paella.BlackBoard2,Class("paella.plugins.BreaksPlayerPlugin",paella.EventDrivenPlugin,{breaks:null,lastEvent:0,visibleBreaks:null,getName:function(){return"es.upv.paella.breaksPlayerPlugin"},checkEnabled:function(onSuccess){var This=this;this.breaks=[],this.visibleBreaks=[],paella.data.read("breaks",{id:paella.initDelegate.getId()},function(data,status){data&&"object"==typeof data&&data.breaks&&data.breaks.length>0&&(This.breaks=data.breaks),onSuccess(!0)})},getEvents:function(){return[paella.events.timeUpdate]},onEvent:function(eventType,params){this.checkBreaks(params)},checkBreaks:function(params){for(var a,i=0;i<this.breaks.length;++i)a=this.breaks[i],a.s<params.currentTime&&a.e>params.currentTime?this.areBreaksClickable()?this.avoidBreak(a):this.showBreaks(a):a.s.toFixed(0)==params.currentTime.toFixed(0)&&this.avoidBreak(a);if(!this.areBreaksClickable())for(var key in this.visibleBreaks)"object"==typeof a&&(a=this.visibleBreaks[key],a&&(a.s>=params.currentTime||a.e<=params.currentTime)&&this.removeBreak(a))},areBreaksClickable:function(){return this.config.neverShow&&!(paella.editor.instance&&paella.editor.instance.isLoaded)},showBreaks:function(br){if(!this.visibleBreaks[br.s]){var rect={left:100,top:350,width:1080,height:20};br.elem=paella.player.videoContainer.overlayContainer.addText(br.content,rect),br.elem.className="textBreak",this.visibleBreaks[br.s]=br}},removeBreak:function(br){if(this.visibleBreaks[br.s]){var elem=this.visibleBreaks[br.s].elem;paella.player.videoContainer.overlayContainer.removeElement(elem),this.visibleBreaks[br.s]=null}},avoidBreak:function(br){var newTime=br.e+(this.config.neverShow?.01:0);paella.player.videoContainer.seekToTime(newTime)}}),paella.plugins.breaksPlayerPlugin=new paella.plugins.BreaksPlayerPlugin,function(){Class("paella.captions.parsers.DFXPParserPlugin",paella.CaptionParserPlugIn,{ext:["dfxp"],getName:function(){return"es.upv.paella.captions.DFXPParserPlugin"},parse:function(content,lang,next){for(var captions=[],self=this,xml=$(content),g_lang=xml.attr("xml:lang"),lls=xml.find("div"),idx=0;idx<lls.length;++idx){var ll=$(lls[idx]),l_lang=ll.attr("xml:lang");if(void 0!=l_lang&&""!=l_lang||(void 0==g_lang||""==g_lang?(base.log.debug("No xml:lang found! Using '"+lang+"' lang instead."),l_lang=lang):l_lang=g_lang),l_lang==lang){ll.find("p").each(function(i,cap){var c={id:i,begin:self.parseTimeTextToSeg(cap.getAttribute("begin")),end:self.parseTimeTextToSeg(cap.getAttribute("end")),content:$(cap).text().trim()};captions.push(c)});break}}captions.length>0?next(!1,captions):next(!0)},parseTimeTextToSeg:function(ttime){var nseg=0,segtime=/^([0-9]*([.,][0-9]*)?)s/.test(ttime);if(segtime)nseg=parseFloat(RegExp.$1);else{var split=ttime.split(":"),h=parseInt(split[0]),m=parseInt(split[1]),s=parseInt(split[2]);nseg=s+60*m+60*h*60}return nseg}}),new paella.captions.parsers.DFXPParserPlugin}(),Class("paella.plugins.CaptionsPlugin",paella.ButtonPlugin,{_searchTimerTime:1500,_searchTimer:null,_pluginButton:null,_open:0,_parent:null,_body:null,_inner:null,_bar:null,_input:null,_select:null,_editor:null,_activeCaptions:null,_lastSel:null,_browserLang:null,_defaultBodyHeight:280,_autoScroll:!0,_searchOnCaptions:null,getAlignment:function(){return"right"},getSubclass:function(){return"captionsPluginButton"},getName:function(){return"es.upv.paella.captionsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Subtitles")},getIndex:function(){return 509},checkEnabled:function(onSuccess){onSuccess(!0)},showUI:function(){paella.captions.getAvailableLangs().length>=1&&this.parent()},setup:function(){var self=this;paella.captions.getAvailableLangs().length||paella.plugins.captionsPlugin.hideUI(),paella.events.bind(paella.events.captionsEnabled,function(event,params){self.onChangeSelection(params)}),paella.events.bind(paella.events.captionsDisabled,function(event,params){self.onChangeSelection(params)}),paella.events.bind(paella.events.captionAdded,function(event,params){self.onCaptionAdded(params),paella.plugins.captionsPlugin.showUI()}),paella.events.bind(paella.events.timeUpdate,function(event,params){self._searchOnCaptions&&self.updateCaptionHiglighted(params)}),paella.events.bind(paella.events.controlBarWillHide,function(evt){self.cancelHideBar()}),self._activeCaptions=paella.captions.getActiveCaptions(),self._searchOnCaptions=self.config.searchOnCaptions||!1},cancelHideBar:function(){var thisClass=this;thisClass._open>0&&paella.player.controls.cancelHideBar()},updateCaptionHiglighted:function(time){var thisClass=this,sel=null,id=null;time&&(id=thisClass.searchIntervaltoHighlight(time),null!=id&&(sel=$(".bodyInnerContainer[sec-id='"+id+"']"),sel!=thisClass._lasSel&&$(thisClass._lasSel).removeClass("Highlight"),sel&&($(sel).addClass("Highlight"),thisClass._autoScroll&&thisClass.updateScrollFocus(id),thisClass._lasSel=sel)))},searchIntervaltoHighlight:function(time){var thisClass=this;return paella.captions.getActiveCaptions()&&(n=paella.captions.getActiveCaptions()._captions,n.forEach(function(l){l.begin<time.currentTime&&time.currentTime<l.end&&(thisClass.resul=l.id)})),null!=thisClass.resul?thisClass.resul:null},updateScrollFocus:function(id){var thisClass=this,resul=0,t=$(".bodyInnerContainer").slice(0,id);t=t.toArray(),t.forEach(function(l){var i=$(l).outerHeight(!0);resul+=i});var x=parseInt(resul/280);$(".captionsBody").scrollTop(x*thisClass._defaultBodyHeight)},onCaptionAdded:function(obj){var thisClass=this,newCap=paella.captions.getCaptions(obj),defOption=document.createElement("option");defOption.text=newCap._lang.txt,defOption.value=obj,thisClass._select.add(defOption)},changeSelection:function(){var thisClass=this,sel=$(thisClass._select).val();return""==sel?($(thisClass._body).empty(),void paella.captions.setActiveCaptions(sel)):(paella.captions.setActiveCaptions(sel),thisClass._activeCaptions=sel,thisClass._searchOnCaptions&&thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"),void thisClass.setButtonHideShow())},onChangeSelection:function(obj){var thisClass=this;thisClass._activeCaptions!=obj&&($(thisClass._body).empty(),void 0==obj?(thisClass._select.value="",$(thisClass._input).prop("disabled",!0)):($(thisClass._input).prop("disabled",!1),thisClass._select.value=obj,thisClass._searchOnCaptions&&thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list")),thisClass._activeCaptions=obj,thisClass.setButtonHideShow())},action:function(){var self=this;switch(self._browserLang=base.dictionary.currentLanguage(),self._autoScroll=!0,self._open){case 0:self._browserLang&&void 0==paella.captions.getActiveCaptions()&&self.selectDefaultBrowserLang(self._browserLang),self._open=1,paella.keyManager.enabled=!1;break;case 1:paella.keyManager.enabled=!0,self._open=0}},buildContent:function(domElement){var thisClass=this;thisClass._parent=document.createElement("div"),thisClass._parent.className="captionsPluginContainer",thisClass._bar=document.createElement("div"),thisClass._bar.className="captionsBar",thisClass._searchOnCaptions&&(thisClass._body=document.createElement("div"),thisClass._body.className="captionsBody",thisClass._parent.appendChild(thisClass._body),$(thisClass._body).scroll(function(){thisClass._autoScroll=!1}),thisClass._input=document.createElement("input"),thisClass._input.className="captionsBarInput",thisClass._input.type="text",thisClass._input.id="captionsBarInput",thisClass._input.name="captionsString",thisClass._input.placeholder=base.dictionary.translate("Search captions"),thisClass._bar.appendChild(thisClass._input),$(thisClass._input).change(function(){var text=$(thisClass._input).val();thisClass.doSearch(text)}),$(thisClass._input).keyup(function(){var text=$(thisClass._input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),thisClass._searchTimer=new base.Timer(function(timer){thisClass.doSearch(text)},thisClass._searchTimerTime)})),thisClass._select=document.createElement("select"),thisClass._select.className="captionsSelector";var defOption=document.createElement("option");defOption.text=base.dictionary.translate("None"),defOption.value="",thisClass._select.add(defOption),paella.captions.getAvailableLangs().forEach(function(l){var option=document.createElement("option");option.text=l.lang.txt,option.value=l.id,thisClass._select.add(option)}),thisClass._bar.appendChild(thisClass._select),thisClass._parent.appendChild(thisClass._bar),$(thisClass._select).change(function(){thisClass.changeSelection()}),thisClass._editor=document.createElement("button"),thisClass._editor.className="editorButton",thisClass._editor.innerHTML="",thisClass._bar.appendChild(thisClass._editor),$(thisClass._editor).prop("disabled",!0),$(thisClass._editor).click(function(){var c=paella.captions.getActiveCaptions();paella.userTracking.log("paella:caption:edit",{id:c._captionsProvider+":"+c._id,lang:c._lang}),c.goToEdit()}),domElement.appendChild(thisClass._parent)},selectDefaultBrowserLang:function(code){var provider=null;paella.captions.getAvailableLangs().forEach(function(l){l.lang.code==code&&(provider=l.id)}),provider&&paella.captions.setActiveCaptions(provider)},doSearch:function(text){thisClass=this;var c=paella.captions.getActiveCaptions();c&&(""==text?thisClass.buildBodyContent(paella.captions.getActiveCaptions()._captions,"list"):c.search(text,function(err,resul){err||thisClass.buildBodyContent(resul,"search")}))},setButtonHideShow:function(){var thisClass=this,editor=$(".editorButton"),c=paella.captions.getActiveCaptions(),res=null;null!=c?($(thisClass._select).width("39%"),c.canEdit(function(err,r){res=r}),res?($(editor).prop("disabled",!1),$(editor).show()):($(editor).prop("disabled",!0),$(editor).hide(),$(thisClass._select).width("47%"))):($(editor).prop("disabled",!0),$(editor).hide(),$(thisClass._select).width("47%")),thisClass._searchOnCaptions||(res?$(thisClass._select).width("92%"):$(thisClass._select).width("100%"))},buildBodyContent:function(obj,type){var thisClass=this;$(thisClass._body).empty(),obj.forEach(function(l){thisClass._inner=document.createElement("div"),thisClass._inner.className="bodyInnerContainer",thisClass._inner.innerHTML=l.content,"list"==type&&(thisClass._inner.setAttribute("sec-begin",l.begin),thisClass._inner.setAttribute("sec-end",l.end),thisClass._inner.setAttribute("sec-id",l.id),thisClass._autoScroll=!0),"search"==type&&thisClass._inner.setAttribute("sec-begin",l.time),thisClass._body.appendChild(thisClass._inner),$(thisClass._inner).hover(function(){$(this).css("background-color","rgba(250, 161, 102, 0.5)")},function(){$(this).removeAttr("style")}),$(thisClass._inner).click(function(){var secBegin=$(this).attr("sec-begin");paella.player.videoContainer.seekToTime(parseInt(secBegin))})})}}),paella.plugins.captionsPlugin=new paella.plugins.CaptionsPlugin,Class("paella.plugins.CaptionsOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_CaptionsOnScreen",container:null,innerContainer:null,top:null,actualPos:null,lastEvent:null,controlsPlayback:null,captions:!1,captionProvider:null,checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},setup:function(){},getEvents:function(){return[paella.events.controlBarDidHide,paella.events.resize,paella.events.controlBarDidShow,paella.events.captionsEnabled,paella.events.captionsDisabled,paella.events.timeUpdate]},onEvent:function(eventType,params){var thisClass=this;switch(eventType){case paella.events.controlBarDidHide:if(thisClass.lastEvent==eventType||0==thisClass.captions)break;thisClass.moveCaptionsOverlay("down");break;case paella.events.resize:if(0==thisClass.captions)break;paella.player.controls.isHidden()?thisClass.moveCaptionsOverlay("down"):thisClass.moveCaptionsOverlay("top");break;case paella.events.controlBarDidShow:if(thisClass.lastEvent==eventType||0==thisClass.captions)break;thisClass.moveCaptionsOverlay("top");break;case paella.events.captionsEnabled:thisClass.buildContent(params),thisClass.captions=!0,paella.player.controls.isHidden()?thisClass.moveCaptionsOverlay("down"):thisClass.moveCaptionsOverlay("top");break;case paella.events.captionsDisabled:thisClass.hideContent(),thisClass.captions=!1;break;case paella.events.timeUpdate:thisClass.captions&&thisClass.updateCaptions(params)}thisClass.lastEvent=eventType},buildContent:function(provider){var thisClass=this;thisClass.captionProvider=provider,null==thisClass.container?(thisClass.container=document.createElement("div"),thisClass.container.className="CaptionsOnScreen",thisClass.container.id=thisClass.containerId,thisClass.innerContainer=document.createElement("div"),thisClass.innerContainer.className="CaptionsOnScreenInner",thisClass.container.appendChild(thisClass.innerContainer),null==thisClass.controlsPlayback&&(thisClass.controlsPlayback=$("#playerContainer_controls_playback")),paella.player.videoContainer.domElement.appendChild(thisClass.container)):$(thisClass.container).show()},updateCaptions:function(time){var thisClass=this;if(thisClass.captions){var c=paella.captions.getActiveCaptions(),caption=c.getCaptionAtTime(time.currentTime);caption?($(thisClass.container).show(),thisClass.innerContainer.innerHTML=caption.content):thisClass.innerContainer.innerHTML=""}},hideContent:function(){var thisClass=this;$(thisClass.container).hide()},moveCaptionsOverlay:function(pos){var thisClass=this;if(null==thisClass.controlsPlayback&&(thisClass.controlsPlayback=$("#playerContainer_controls_playback")),"down"==pos){thisClass.controlsPlayback.offset().top;thisClass.innerContainer.style.bottom=-thisClass.container.offsetHeight+50+"px"}if("top"==pos){var t2=thisClass.controlsPlayback.offset().top;t2-=thisClass.innerContainer.offsetHeight+10,thisClass.innerContainer.style.bottom=0-t2+"px"}},getIndex:function(){return 1050},getName:function(){return"es.upv.paella.overlayCaptionsPlugin"}}),new paella.plugins.CaptionsOnScreen,Class("paella.plugins.CommentsPlugin",paella.TabBarPlugin,{divPublishComment:null,divComments:null,publishCommentTextArea:null,publishCommentButtons:null,canPublishAComment:!1,comments:[],commentsTree:[],domElement:null,getSubclass:function(){return"showCommentsTabBar"},getName:function(){return"es.upv.paella.commentsPlugin"},getTabName:function(){return base.dictionary.translate("Comments")},checkEnabled:function(onSuccess){onSuccess(!0)},getIndex:function(){return 40},getDefaultToolTip:function(){return base.dictionary.translate("Comments")},action:function(tab){this.loadContent()},buildContent:function(domElement){this.domElement=domElement,this.canPublishAComment=paella.initDelegate.initParams.accessControl.permissions.canWrite,this.loadContent()},loadContent:function(){this.divRoot=this.domElement,this.divRoot.innerHTML="",this.divPublishComment=document.createElement("div"),this.divPublishComment.className="CommentPlugin_Publish",this.divPublishComment.id="CommentPlugin_Publish",this.divComments=document.createElement("div"),this.divComments.className="CommentPlugin_Comments",this.divComments.id="CommentPlugin_Comments",this.canPublishAComment&&(this.divRoot.appendChild(this.divPublishComment),this.createPublishComment()),this.divRoot.appendChild(this.divComments),this.reloadComments()},createPublishComment:function(){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry";
divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.style.width="48px",divSil.src=paella.initDelegate.initParams.accessControl.userData.avatar,divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divTextAreaContainer;divTextAreaContainer=document.createElement("div"),divTextAreaContainer.className="comments_entry_container",divTextAreaContainer.id=rootID+"_textarea_container",divEntry.appendChild(divTextAreaContainer),this.publishCommentTextArea=document.createElement("textarea"),this.publishCommentTextArea.id=rootID+"_textarea",this.publishCommentTextArea.onclick=function(){paella.keyManager.enabled=!1},this.publishCommentTextArea.onblur=function(){paella.keyManager.enabled=!0},divTextAreaContainer.appendChild(this.publishCommentTextArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=rootID+"_buttons_area",divTextAreaContainer.appendChild(this.publishCommentButtons);var btnAddComment;btnAddComment=document.createElement("button"),btnAddComment.id=rootID+"_btnAddComment",btnAddComment.className="publish",btnAddComment.onclick=function(){var txtValue=thisClass.publishCommentTextArea.value;""!=txtValue.replace(/\s/g,"")&&thisClass.addComment()},btnAddComment.innerHTML=base.dictionary.translate("Publish"),this.publishCommentButtons.appendChild(btnAddComment),divTextAreaContainer.commentsTextArea=this.publishCommentTextArea,divTextAreaContainer.commentsBtnAddComment=btnAddComment,divTextAreaContainer.commentsBtnAddCommentToInstant=this.btnAddCommentToInstant,this.divPublishComment.appendChild(divEntry)},addComment:function(){var thisClass=this,txtValue=paella.AntiXSS.htmlEscape(thisClass.publishCommentTextArea.value),now=new Date;this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"normal",value:txtValue,created:now});var data={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},data,function(response,status){status&&thisClass.loadContent()})},addReply:function(annotationID,domNodeId){var thisClass=this,textArea=document.getElementById(domNodeId),txtValue=paella.AntiXSS.htmlEscape(textArea.value),now=new Date;paella.keyManager.enabled=!0,this.comments.push({id:base.uuid(),userName:paella.initDelegate.initParams.accessControl.userData.name,mode:"reply",parent:annotationID,value:txtValue,created:now});var data={allComments:this.comments};paella.data.write("comments",{id:paella.initDelegate.getId()},data,function(response,status){status&&thisClass.reloadComments()})},reloadComments:function(){var thisClass=this;thisClass.commentsTree=[],thisClass.comments=[],this.divComments.innerHTML="",paella.data.read("comments",{id:paella.initDelegate.getId()},function(data,status){var i,valueText,comment;if(data&&"object"==typeof data&&data.allComments&&data.allComments.length>0){thisClass.comments=data.allComments;var tempDict={};for(i=0;i<data.allComments.length;++i)valueText=data.allComments[i].value,"reply"!==data.allComments[i].mode&&(comment={},comment.id=data.allComments[i].id,comment.userName=data.allComments[i].userName,comment.mode=data.allComments[i].mode,comment.value=valueText,comment.created=data.allComments[i].created,comment.replies=[],thisClass.commentsTree.push(comment),tempDict[comment.id]=thisClass.commentsTree.length-1);for(i=0;i<data.allComments.length;++i)if(valueText=data.allComments[i].value,"reply"===data.allComments[i].mode){comment={},comment.id=data.allComments[i].id,comment.userName=data.allComments[i].userName,comment.mode=data.allComments[i].mode,comment.value=valueText,comment.created=data.allComments[i].created;var index=tempDict[data.allComments[i].parent];thisClass.commentsTree[index].replies.push(comment)}thisClass.displayComments()}})},displayComments:function(){for(var thisClass=this,i=0;i<thisClass.commentsTree.length;++i){var comment=thisClass.commentsTree[i],e=thisClass.createACommentEntry(comment);thisClass.divComments.appendChild(e)}},createACommentEntry:function(comment){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry"+comment.id;divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container",divCommentContainer.id=rootID+"_comment_container",divEntry.appendChild(divCommentContainer);var divCommentMetadata;divCommentMetadata=document.createElement("div"),divCommentMetadata.id=rootID+"_comment_metadata",divCommentContainer.appendChild(divCommentMetadata);var datePublish="";if(comment.created){var dateToday=new Date,dateComment=paella.utils.timeParse.matterhornTextDateToDate(comment.created);datePublish=paella.utils.timeParse.secondsToText((dateToday.getTime()-dateComment.getTime())/1e3)}var divCommentValue;divCommentValue=document.createElement("div"),divCommentValue.id=rootID+"_comment_value",divCommentValue.className="comments_entry_comment",divCommentContainer.appendChild(divCommentValue),divCommentValue.innerHTML=comment.value;var divCommentReply=document.createElement("div");if(divCommentReply.id=rootID+"_comment_reply",divCommentContainer.appendChild(divCommentReply),paella.data.read("userInfo",{username:comment.userName},function(data,status){if(data){divSil.src=data.avatar;var headLine="<span class='comments_entry_username'>"+data.name+" "+data.lastname+"</span>";headLine+="<span class='comments_entry_datepublish'>"+datePublish+"</span>",divCommentMetadata.innerHTML=headLine}}),1==this.canPublishAComment){var btnRplyComment=document.createElement("div");btnRplyComment.className="reply_button",btnRplyComment.innerHTML=base.dictionary.translate("Reply"),btnRplyComment.id=rootID+"_comment_reply_button",btnRplyComment.onclick=function(){var e=thisClass.createAReplyEntry(comment.id);this.style.display="none",this.parentElement.parentElement.appendChild(e)},divCommentReply.appendChild(btnRplyComment)}for(var i=0;i<comment.replies.length;++i){var e=thisClass.createACommentReplyEntry(comment.id,comment.replies[i]);divCommentContainer.appendChild(e)}return divEntry},createACommentReplyEntry:function(parentID,comment){var divEntry,rootID=this.divPublishComment.id+"_entry_"+parentID+"_reply_"+comment.id;divEntry=document.createElement("div"),divEntry.id=rootID,divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.id=rootID+"_silhouette",divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container",divCommentContainer.id=rootID+"_comment_container",divEntry.appendChild(divCommentContainer);var divCommentMetadata;divCommentMetadata=document.createElement("div"),divCommentMetadata.id=rootID+"_comment_metadata",divCommentContainer.appendChild(divCommentMetadata);var datePublish="";if(comment.created){var dateToday=new Date,dateComment=paella.utils.timeParse.matterhornTextDateToDate(comment.created);datePublish=paella.utils.timeParse.secondsToText((dateToday.getTime()-dateComment.getTime())/1e3)}var divCommentValue;return divCommentValue=document.createElement("div"),divCommentValue.id=rootID+"_comment_value",divCommentValue.className="comments_entry_comment",divCommentContainer.appendChild(divCommentValue),divCommentValue.innerHTML=comment.value,paella.data.read("userInfo",{username:comment.userName},function(data,status){if(data){divSil.src=data.avatar;var headLine="<span class='comments_entry_username'>"+data.name+" "+data.lastname+"</span>";headLine+="<span class='comments_entry_datepublish'>"+datePublish+"</span>",divCommentMetadata.innerHTML=headLine}}),divEntry},createAReplyEntry:function(annotationID){var divEntry,thisClass=this,rootID=this.divPublishComment.id+"_entry_"+annotationID+"_reply";divEntry=document.createElement("div"),divEntry.id=rootID+"_entry",divEntry.className="comments_entry";var divSil;divSil=document.createElement("img"),divSil.className="comments_entry_silhouette",divSil.style.width="48px",divSil.id=rootID+"_silhouette",divSil.src=paella.initDelegate.initParams.accessControl.userData.avatar,divEntry.appendChild(divSil);var divCommentContainer;divCommentContainer=document.createElement("div"),divCommentContainer.className="comments_entry_container comments_reply_container",divCommentContainer.id=rootID+"_reply_container",divEntry.appendChild(divCommentContainer);var textArea;textArea=document.createElement("textArea"),textArea.onclick=function(){paella.keyManager.enabled=!1},textArea.draggable=!1,textArea.id=rootID+"_textarea",divCommentContainer.appendChild(textArea),this.publishCommentButtons=document.createElement("div"),this.publishCommentButtons.id=rootID+"_buttons_area",divCommentContainer.appendChild(this.publishCommentButtons);var btnAddComment;return btnAddComment=document.createElement("button"),btnAddComment.id=rootID+"_btnAddComment",btnAddComment.className="publish",btnAddComment.onclick=function(){var txtValue=textArea.value;""!=txtValue.replace(/\s/g,"")&&thisClass.addReply(annotationID,textArea.id)},btnAddComment.innerHTML=base.dictionary.translate("Reply"),this.publishCommentButtons.appendChild(btnAddComment),divEntry}}),paella.plugins.commentsPlugin=new paella.plugins.CommentsPlugin,Class("paella.plugins.DescriptionPlugin",paella.TabBarPlugin,{getSubclass:function(){return"showDescriptionTabBar"},getName:function(){return"es.upv.paella.descriptionPlugin"},getTabName:function(){return"Descripción"},domElement:null,buildContent:function(domElement){this.domElement=domElement,this.loadContent()},action:function(tab){this.loadContent()},loadContent:function(){var container=this.domElement;container.innerHTML="Loading...",new paella.Timer(function(t){container.innerHTML="Loading done"},2e3)}}),paella.plugins.descriptionPlugin=new paella.plugins.DescriptionPlugin,Class("paella.plugins.extendedTabAdapterPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],showWidthRes:null,getAlignment:function(){return"right"},getSubclass:function(){return"extendedTabAdapterPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.extendedTabAdapterPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Extended Tab Adapter")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(domElement){domElement.appendChild(paella.extendedAdapter.bottomContainer)}}),new paella.plugins.extendedTabAdapterPlugin,Class("paella.plugins.FootPrintsPlugin",paella.ButtonPlugin,{INTERVAL_LENGTH:5,inPosition:0,outPosition:0,canvas:null,footPrintsTimer:null,footPrintsData:{},getAlignment:function(){return"right"},getSubclass:function(){return"footPrints"},getIndex:function(){return 590},getDefaultToolTip:function(){return base.dictionary.translate("Show statistics")},getName:function(){return"es.upv.paella.footprintsPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},setup:function(){var thisClass=this;switch(paella.events.bind(paella.events.timeUpdate,function(event){thisClass.onTimeUpdate()}),this.config.skin){case"custom":this.fillStyle=this.config.fillStyle,this.strokeStyle=this.config.strokeStyle;break;case"dark":this.fillStyle="#727272",this.strokeStyle="#424242";break;case"light":this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff";break;default:this.fillStyle="#d8d8d8",this.strokeStyle="#ffffff"}},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},buildContent:function(domElement){var container=document.createElement("div");container.className="footPrintsContainer",this.canvas=document.createElement("canvas"),this.canvas.id="footPrintsCanvas",this.canvas.className="footPrintsCanvas",container.appendChild(this.canvas),domElement.appendChild(container)},onTimeUpdate:function(){var videoCurrentTime=Math.round(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart());this.inPosition<=videoCurrentTime&&videoCurrentTime<=this.inPosition+this.INTERVAL_LENGTH?(this.outPosition=videoCurrentTime,this.inPosition+this.INTERVAL_LENGTH===this.outPosition&&(this.trackFootPrint(this.inPosition,this.outPosition),this.inPosition=this.outPosition)):(this.trackFootPrint(this.inPosition,this.outPosition),this.inPosition=videoCurrentTime,this.outPosition=videoCurrentTime)},trackFootPrint:function(inPosition,outPosition){var data={in:inPosition,out:outPosition};paella.data.write("footprints",{id:paella.initDelegate.getId()},data)},willShowContent:function(){var thisClass=this;this.loadFootprints(),this.footPrintsTimer=new base.Timer(function(timer){thisClass.loadFootprints()},5e3),this.footPrintsTimer.repeat=!0},didHideContent:function(){null!=this.footPrintsTimer&&(this.footPrintsTimer.cancel(),this.footPrintsTimer=null)},loadFootprints:function(){var thisClass=this;paella.data.read("footprints",{id:paella.initDelegate.getId()},function(data,status){for(var footPrintsData={},duration=Math.floor(paella.player.videoContainer.duration()),trimStart=Math.floor(paella.player.videoContainer.trimStart()),lastPosition=-1,lastViews=0,i=0;i<data.length;i++)if(position=data[i].position-trimStart,position<duration){if(views=data[i].views,position-1!=lastPosition)for(var j=lastPosition+1;j<position;j++)footPrintsData[j]=lastViews;footPrintsData[position]=views,lastPosition=position,lastViews=views}thisClass.drawFootPrints(footPrintsData)})},drawFootPrints:function(footPrintsData){if(this.canvas){var i,duration=Object.keys(footPrintsData).length,ctx=this.canvas.getContext("2d"),h=20;for(i=0;i<duration;++i)footPrintsData[i]>h&&(h=footPrintsData[i]);for(this.canvas.setAttribute("width",duration),this.canvas.setAttribute("height",h),ctx.clearRect(0,0,this.canvas.width,this.canvas.height),ctx.fillStyle=this.fillStyle,ctx.strokeStyle=this.strokeStyle,ctx.lineWidth=2,ctx.webkitImageSmoothingEnabled=!1,ctx.mozImageSmoothingEnabled=!1,i=0;i<duration-1;++i)ctx.beginPath(),ctx.moveTo(i,h),ctx.lineTo(i,h-footPrintsData[i]),ctx.lineTo(i+1,h-footPrintsData[i+1]),ctx.lineTo(i+1,h),ctx.closePath(),ctx.fill(),ctx.beginPath(),ctx.moveTo(i,h-footPrintsData[i]),ctx.lineTo(i+1,h-footPrintsData[i+1]),ctx.closePath(),ctx.stroke()}}}),paella.plugins.footPrintsPlugin=new paella.plugins.FootPrintsPlugin,Class("paella.plugins.FrameControlPlugin",paella.ButtonPlugin,{frames:null,highResFrames:null,currentFrame:null,navButtons:null,buttons:[],contx:null,_img:null,_searchTimer:null,_searchTimerTime:250,getAlignment:function(){return"right"},getSubclass:function(){return"frameControl"},getIndex:function(){return 510},getMinWindowSize:function(){return 200},getName:function(){return"es.upv.paella.frameControlPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.timeLineButton},getDefaultToolTip:function(){return base.dictionary.translate("Navigate by slides")},checkEnabled:function(onSuccess){onSuccess(null==paella.initDelegate.initParams.videoLoader.frameList?!1:0===paella.initDelegate.initParams.videoLoader.frameList.length?!1:0==Object.keys(paella.initDelegate.initParams.videoLoader.frameList).length?!1:!0)},setup:function(){var oldClassName,jumpAtItem,thisClass=this,blockCounter=1,correctJump=0,selectedItem=-1;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){var visibleItems=Math.floor(thisClass.contx.offsetWidth/100),rest=thisClass.buttons.length%visibleItems,blocks=Math.floor(thisClass.buttons.length/visibleItems);thisClass.isPopUpOpen()&&(event.keyCode==Keys.Left?selectedItem>0&&(thisClass.buttons[selectedItem].className=oldClassName,selectedItem--,blockCounter>blocks&&(correctJump=visibleItems-rest),jumpAtItem=visibleItems*(blockCounter-1)-1-correctJump,selectedItem==jumpAtItem&&0!=selectedItem&&(thisClass.navButtons.left.scrollContainer.scrollLeft-=105*visibleItems,--blockCounter),this.hiResFrame&&thisClass.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||thisClass.buttons[selectedItem].frameControl.onMouseOver(null,thisClass.buttons[selectedItem].frameData),oldClassName=thisClass.buttons[selectedItem].className,thisClass.buttons[selectedItem].className="frameControlItem selected"):event.keyCode==Keys.Right?selectedItem<thisClass.buttons.length-1&&(selectedItem>=0&&(thisClass.buttons[selectedItem].className=oldClassName),selectedItem++,1==blockCounter&&(correctJump=0),jumpAtItem=visibleItems*blockCounter-correctJump,selectedItem==jumpAtItem&&(thisClass.navButtons.left.scrollContainer.scrollLeft+=105*visibleItems,++blockCounter),this.hiResFrame&&thisClass.removeHiResFrame(),base.userAgent.browser.IsMobileVersion||thisClass.buttons[selectedItem].frameControl.onMouseOver(null,thisClass.buttons[selectedItem].frameData),oldClassName=thisClass.buttons[selectedItem].className,thisClass.buttons[selectedItem].className="frameControlItem selected"):event.keyCode==Keys.Return?(thisClass.buttons[selectedItem].frameControl.onClick(null,thisClass.buttons[selectedItem].frameData),oldClassName="frameControlItem current"):event.keyCode==Keys.Esc&&thisClass.removeHiResFrame())})},buildContent:function(domElement){var thisClass=this;this.frames=[];var container=document.createElement("div");container.className="frameControlContainer",thisClass.contx=container;var content=document.createElement("div");content.className="frameControlContent",this.navButtons={left:document.createElement("div"),right:document.createElement("div")},this.navButtons.left.className="frameControl navButton left",this.navButtons.right.className="frameControl navButton right";var frame=this.getFrame(null);domElement.appendChild(this.navButtons.left),domElement.appendChild(container),container.appendChild(content),domElement.appendChild(this.navButtons.right),this.navButtons.left.scrollContainer=container,$(this.navButtons.left).click(function(event){this.scrollContainer.scrollLeft-=100}),this.navButtons.right.scrollContainer=container,$(this.navButtons.right).click(function(event){this.scrollContainer.scrollLeft+=100}),content.appendChild(frame);var itemWidth=$(frame).outerWidth(!0);content.innerHTML="",$(window).mousemove(function(event){($(content).offset().top>event.pageY||!$(content).is(":visible")||$(content).offset().top+$(content).height()<event.pageY)&&This.removeHiResFrame()});var numFrames,frames=paella.initDelegate.initParams.videoLoader.frameList;if(frames){var framesKeys=Object.keys(frames);numFrames=framesKeys.length,framesKeys.map(function(i){return Number(i,10)}).sort(function(a,b){return a-b}).forEach(function(key){var frameItem=thisClass.getFrame(frames[key]);content.appendChild(frameItem,"frameContrlItem_"+numFrames),thisClass.frames.push(frameItem)})}$(content).css({width:numFrames*itemWidth+"px"});var This=this;paella.events.bind(paella.events.setTrim,function(event,params){This.isFrameVisible(params.trimEnabled,params.trimStart,params.trimEnd)}),paella.events.bind(paella.events.timeupdate,function(event,params){This.onTimeUpdate(params.currentTime)})},showHiResFrame:function(url){var thisClass=this,frameRoot=document.createElement("div"),frame=document.createElement("div"),hiResImage=document.createElement("img");thisClass._img=hiResImage,hiResImage.className="frameHiRes",hiResImage.setAttribute("src",url),hiResImage.setAttribute("style","width: 100%;"),$(frame).append(hiResImage),$(frameRoot).append(frame),frameRoot.setAttribute("style","display: table;"),frame.setAttribute("style","display: table-cell; vertical-align:middle;"),overlayContainer=paella.player.videoContainer.overlayContainer;var streams=paella.initDelegate.initParams.videoLoader.streams;1==streams.length?overlayContainer.addElement(frameRoot,overlayContainer.getMasterRect()):streams.length>=2&&overlayContainer.addElement(frameRoot,overlayContainer.getSlaveRect()),overlayContainer.enableBackgroundMode(),this.hiResFrame=frameRoot},removeHiResFrame:function(){var thisClass=this;overlayContainer=paella.player.videoContainer.overlayContainer,this.hiResFrame&&overlayContainer.removeElement(this.hiResFrame),overlayContainer.disableBackgroundMode(),thisClass._img=null},isFrameVisible:function(trimEnabled,trimStart,trimEnd){var i;if(trimEnabled)for(i=0;i<this.frames.length;++i){var frameElem=this.frames[i],frameData=frameElem.frameData;frameData.time<trimStart?this.frames.length>i+1&&this.frames[i+1].frameData.time>trimStart?$(frameElem).show():$(frameElem).hide():frameData.time>trimEnd?$(frameElem).hide():$(frameElem).show()}else for(i=0;i<this.frames.length;++i)$(this.frames[i]).show()},getFrame:function(frameData,id){var frame=document.createElement("div");if(frame.className="frameControlItem",id&&(frame.id=id),frameData){this.buttons.push(frame),frame.frameData=frameData,frame.frameControl=this,image=frameData.thumb?frameData.thumb:frameData.url;var labelTime=paella.utils.timeParse.secondsToTime(frameData.time);frame.innerHTML='<img src="'+image+'" alt="" class="frameControlImage" title="'+labelTime+'" aria-label="'+labelTime+'"></img>',base.userAgent.browser.IsMobileVersion||$(frame).mouseover(function(event){this.frameControl.onMouseOver(event,this.frameData)}),$(frame).mouseout(function(event){this.frameControl.onMouseOut(event,this.frameData)}),$(frame).click(function(event){this.frameControl.onClick(event,this.frameData)})}return frame},onMouseOver:function(event,frameData){var thisClass=this,frames=paella.initDelegate.initParams.videoLoader.frameList,frame=frames[frameData.time];if(frame){var image=frame.url;thisClass._img?thisClass._img.setAttribute("src",image):this.showHiResFrame(image)}null!=thisClass._searchTimer&&thisClass._searchTimer.cancel()},onMouseOut:function(event,frameData){var thisClass=this;thisClass._searchTimer=new base.Timer(function(timer){thisClass.removeHiResFrame()},thisClass._searchTimerTime)},onClick:function(event,frameData){paella.player.videoContainer.seekToTime(frameData.time+1)},onTimeUpdate:function(currentTime){for(var frame=null,i=0;i<this.frames.length&&(this.frames[i].frameData&&this.frames[i].frameData.time<=currentTime);++i)frame=this.frames[i];this.currentFrame!=frame&&frame&&(this.currentFrame&&(this.currentFrame.className="frameControlItem"),this.currentFrame=frame,this.currentFrame.className="frameControlItem current")}}),paella.plugins.frameControlPlugin=new paella.plugins.FrameControlPlugin,Class("paella.plugins.FullScreenPlugin",paella.ButtonPlugin,{_reload:null,getIndex:function(){return 551},getAlignment:function(){return"right"},getSubclass:function(){return"showFullScreenButton"},getName:function(){return"es.upv.paella.fullScreenButtonPlugin"},checkEnabled:function(onSuccess){var enabled=paella.player.checkFullScreenCapability();onSuccess(enabled)},getDefaultToolTip:function(){return base.dictionary.translate("Go Fullscreen")},setup:function(){var thisClass=this;this._reload=!!this.config.reloadOnFullscreen&&this.config.reloadOnFullscreen.enabled,this._keepUserQuality=!this.config.reloadOnFullscreen||this.config.reloadOnFullscreen.keepUserSelection,paella.events.bind(paella.events.enterFullscreen,function(event){thisClass.onEnterFullscreen()}),paella.events.bind(paella.events.exitFullscreen,function(event){thisClass.onExitFullscreen()})},action:function(button){var self=this;if(paella.player.isFullScreen())paella.player.exitFullScreen();else{if((!paella.player.checkFullScreenCapability()||base.userAgent.browser.Explorer)&&window.location!==window.parent.location){var url=window.location.href;return paella.player.pause(),void paella.player.videoContainer.currentTime().then(function(currentTime){var obj=self.secondsToHours(currentTime);window.open(url+"&time="+obj.h+"h"+obj.m+"m"+obj.s+"s&autoplay=true")})}paella.player.goFullScreen()}setTimeout(function(){self._reload&&paella.player.videoContainer.setQuality(null).then(function(){})},1e3)},secondsToHours:function(sec_numb){var hours=Math.floor(sec_numb/3600),minutes=Math.floor((sec_numb-3600*hours)/60),seconds=Math.floor(sec_numb-3600*hours-60*minutes),obj={};return hours<10&&(hours="0"+hours),minutes<10&&(minutes="0"+minutes),seconds<10&&(seconds="0"+seconds),obj.h=hours,obj.m=minutes,obj.s=seconds,obj},onEnterFullscreen:function(){this.setToolTip(base.dictionary.translate("Exit Fullscreen")),this.button.className=this.getButtonItemClass(!0)},onExitFullscreen:function(){this.setToolTip(base.dictionary.translate("Go Fullscreen")),this.button.className=this.getButtonItemClass(!1),setTimeout(function(){paella.player.onresize()},100)},getButtonItemClass:function(selected){return"buttonPlugin "+this.getAlignment()+" "+this.getSubclass()+(selected?" active":"")}}),paella.plugins.fullScreenPlugin=new paella.plugins.FullScreenPlugin,Class("paella.plugins.HelpPlugin",paella.ButtonPlugin,{getIndex:function(){return 509},getAlignment:function(){return"right"},getSubclass:function(){return"helpButton"},getName:function(){return"es.upv.paella.helpPlugin"},getMinWindowSize:function(){return 650},getDefaultToolTip:function(){return base.dictionary.translate("Show help")+" ("+base.dictionary.translate("Paella version:")+" "+paella.version+")"},checkEnabled:function(onSuccess){var availableLangs=this.config&&this.config.langs||[];onSuccess(availableLangs.length>0)},action:function(button){var mylang=base.dictionary.currentLanguage(),availableLangs=this.config&&this.config.langs||[],idx=availableLangs.indexOf(mylang);idx<0&&(idx=0),paella.messageBox.showFrame("resources/style/help/help_"+availableLangs[idx]+".html")}}),paella.plugins.helpPlugin=new paella.plugins.HelpPlugin,Class("paella.HLSPlayer",paella.Html5Video,{initialize:function(id,stream,left,top,width,height){this.parent(id,stream,left,top,width,height,"hls")}}),Class("paella.videoFactories.HLSVideoFactory",{isStreamCompatible:function(streamData){if(base.userAgent.system.iOS&&0==paella.videoFactories.Html5VideoFactory.s_instances)try{for(var key in streamData.sources)if("hls"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.HLSPlayer(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.LiveStreamIndicator",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"liveIndicator"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("This video is a live stream")},checkEnabled:function(onSuccess){onSuccess(paella.player.isLiveStream())},setup:function(){},action:function(button){paella.messageBox.showMessage(base.dictionary.translate("Live streaming mode: This is a live video, so, some capabilities of the player are disabled"))},getName:function(){return"es.upv.paella.liveStreamingIndicatorPlugin"}}),paella.plugins.liveStreamIndicator=new paella.LiveStreamIndicator,Class("paella.MpegDashVideo",paella.Html5Video,{_posterFrame:null,_player:null,initialize:function(id,stream,left,top,width,height){this.parent(id,stream,left,top,width,height)},_loadDeps:function(){var defer=$.Deferred();return window.$paella_mpd?defer.resolve(window.$paella_mpd):require(["resources/deps/dash.all.js"],function(){window.$paella_mpd=!0,defer.resolve()}),defer},_getQualityObject:function(item,index,bitrates){var total=bitrates.length,percent=Math.round(100*index/total),label=0==index?"min":index==total-1?"max":percent+"%";return{index:index,res:{w:null,h:null},bitrate:item.bitrate,src:null,toString:function(){return percent},shortLabel:function(){return label},compare:function(q2){return this.bitrate-q2.bitrate}}},load:function(){var This=this,defer=$.Deferred(),source=this._stream.sources.mpd;return source&&source.length>0?(source=source[0],this._loadDeps().then(function(){var context=new Dash.di.DashContext;player=new MediaPlayer(context),dashContext=context,player.startup(),player.debug.setLogToBrowserConsole(!1),player.attachView(This.video),player.setAutoPlay(!1),player.setAutoSwitchQuality(!0),This._player=player,player.addEventListener(MediaPlayer.events.STREAM_INITIALIZED,function(a,b){bitrates=player.getBitrateInfoListFor("video"),This._deferredAction(function(){defer.resolve()})}),player.attachSource(source.src)})):defer.reject(new Error("Invalid source")),defer},getQualities:function(){var This=this,defer=$.Deferred();return this._deferredAction(function(){This._qualities||(This._qualities=[],This._player.getBitrateInfoListFor("video").sort(function(a,b){return a.bitrate-b.bitrate}).forEach(function(item,index){This._qualities.push(This._getQualityObject(item,index,bitrates))}),This.autoQualityIndex=This._qualities.length,This._qualities.push({index:This.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(q2){return this.bitrate-q2.bitrate}})),defer.resolve(This._qualities)}),defer},setQuality:function(index){var defer=$.Deferred(),This=this,currentQuality=this._player.getQualityFor("video");return index==This.autoQualityIndex?(this._player.setAutoSwitchQuality(!0),defer.resolve()):index!=currentQuality?(this._player.setAutoSwitchQuality(!1),this._player.removeEventListener(MediaPlayer.events.METRIC_CHANGED),this._player.addEventListener(MediaPlayer.events.METRIC_CHANGED,function(a,b){"metricchanged"==a.type&&"video"==a.data.stream&&currentQuality!=This._player.getQualityFor("video")&&(currentQuality=This._player.getQualityFor("video"),defer.resolve())}),This._player.setQualityFor("video",index)):defer.resolve(),defer},getCurrentQuality:function(){var defer=$.Deferred();if(this._player.getAutoSwitchQuality())defer.resolve({index:this.autoQualityIndex,res:{w:null,h:null},bitrate:-1,src:null,toString:function(){return"auto"},shortLabel:function(){return"auto"},compare:function(q2){return this.bitrate-q2.bitrate}});else{var index=this._player.getQualityFor("video");defer.resolve(this._getQualityObject(this._qualities[index],index,this._player.getBitrateInfoListFor("video")))}return defer},unFreeze:function(){return paella_DeferredNotImplemented()},freeze:function(){return paella_DeferredNotImplemented()},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()}}),Class("paella.videoFactories.MpegDashVideoFactory",{isStreamCompatible:function(streamData){try{if(base.userAgent.system.iOS&&paella.videoFactories.Html5VideoFactory.s_instances>0)return!1;for(var key in streamData.sources)if("mpd"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return++paella.videoFactories.Html5VideoFactory.s_instances,new paella.MpegDashVideo(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.plugins.MultipleQualitiesPlugin",paella.ButtonPlugin,{_available:[],getAlignment:function(){return"right"},getSubclass:function(){return"showMultipleQualitiesPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 550},getName:function(){return"es.upv.paella.multipleQualitiesPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change video quality")},checkEnabled:function(onSuccess){var This=this;paella.player.videoContainer.getQualities().then(function(q){This._available=q,onSuccess(q.length>1)})},setup:function(){var This=this;this.setQualityLabel(),paella.events.bind(paella.events.qualityChanged,function(event){This.setQualityLabel()})},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buildContent:function(domElement){var This=this;this._available.forEach(function(q){q.shortLabel();domElement.appendChild(This.getItemButton(q))})},getItemButton:function(quality){var elem=document.createElement("div"),This=this;
return paella.player.videoContainer.getCurrentQuality().then(function(currentIndex,currentData){var label=quality.shortLabel();elem.className=This.getButtonItemClass(label,quality.index==currentIndex),elem.id=label,elem.innerHTML=label,elem.data=quality,$(elem).click(function(event){$(".multipleQualityItem").removeClass("selected"),$(".multipleQualityItem."+this.data.toString()).addClass("selected"),paella.player.videoContainer.setQuality(this.data.index).then(function(){paella.player.controls.hidePopUp(This.getName()),This.setQualityLabel()})})}),elem},setQualityLabel:function(){var This=this;paella.player.videoContainer.getCurrentQuality().then(function(q){This.setText(q.shortLabel())})},getButtonItemClass:function(profileName,selected){return"multipleQualityItem "+profileName+(selected?" selected":"")}}),paella.plugins.multipleQualitiesPlugin=new paella.plugins.MultipleQualitiesPlugin,Class("paella.plugins.PlayPauseButtonPlugin",paella.ButtonPlugin,{playSubclass:"playButton",pauseSubclass:"pauseButton",getAlignment:function(){return"left"},getSubclass:function(){return this.playSubclass},getName:function(){return"es.upv.paella.playPauseButtonPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Play")},getIndex:function(){return 110},checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},setup:function(){var This=this;paella.player.playing()&&this.changeSubclass(This.pauseSubclass),paella.events.bind(paella.events.play,function(event){This.changeSubclass(This.pauseSubclass),This.setToolTip(paella.dictionary.translate("Pause"))}),paella.events.bind(paella.events.pause,function(event){This.changeSubclass(This.playSubclass),This.setToolTip(paella.dictionary.translate("Play"))})},action:function(button){paella.player.videoContainer.paused().done(function(paused){paused?paella.player.play():paella.player.pause()})}}),paella.plugins.playPauseButtonPlugn=new paella.plugins.PlayPauseButtonPlugin,Class("paella.plugins.PlayButtonOnScreen",paella.EventDrivenPlugin,{containerId:"paella_plugin_PlayButtonOnScreen",container:null,enabled:!0,isPlaying:!1,showIcon:!0,firstPlay:!1,checkEnabled:function(onSuccess){onSuccess(!paella.player.isLiveStream())},getIndex:function(){return 1010},getName:function(){return"es.upv.paella.playButtonOnScreenPlugin"},setup:function(){function repaintCanvas(){var width=jQuery(thisClass.container).innerWidth(),height=jQuery(thisClass.container).innerHeight();icon.width=width,icon.height=height;var iconSize=width<height?width/3:height/3,ctx=icon.getContext("2d");ctx.translate((width-iconSize)/2,(height-iconSize)/2),ctx.beginPath(),ctx.arc(iconSize/2,iconSize/2,iconSize/2,0,2*Math.PI,!0),ctx.closePath(),ctx.strokeStyle="white",ctx.lineWidth=10,ctx.stroke(),ctx.fillStyle="#8f8f8f",ctx.fill(),ctx.beginPath(),ctx.moveTo(iconSize/3,iconSize/4),ctx.lineTo(3*iconSize/4,iconSize/2),ctx.lineTo(iconSize/3,3*iconSize/4),ctx.lineTo(iconSize/3,iconSize/4),ctx.closePath(),ctx.fillStyle="white",ctx.fill(),ctx.stroke()}var thisClass=this;this.container=document.createElement("div"),this.container.className="playButtonOnScreen",this.container.id=this.containerId,this.container.style.width="100%",this.container.style.height="100%",paella.player.videoContainer.domElement.appendChild(this.container),$(this.container).click(function(event){thisClass.onPlayButtonClick()});var icon=document.createElement("canvas");icon.className="playButtonOnScreenIcon",this.container.appendChild(icon),paella.events.bind(paella.events.resize,repaintCanvas),repaintCanvas()},getEvents:function(){return[paella.events.endVideo,paella.events.play,paella.events.pause,paella.events.showEditor,paella.events.hideEditor]},onEvent:function(eventType,params){switch(eventType){case paella.events.endVideo:this.endVideo();break;case paella.events.play:this.play();break;case paella.events.pause:this.pause();break;case paella.events.showEditor:this.showEditor();break;case paella.events.hideEditor:this.hideEditor()}},onPlayButtonClick:function(){this.firstPlay=!0,this.checkStatus()},endVideo:function(){this.isPlaying=!1,this.checkStatus()},play:function(){this.isPlaying=!0,this.showIcon=!1,this.checkStatus()},pause:function(){this.isPlaying=!1,this.showIcon=!1,this.checkStatus()},showEditor:function(){this.enabled=!1,this.checkStatus()},hideEditor:function(){this.enabled=!0,this.checkStatus()},checkStatus:function(){this.enabled&&this.isPlaying||!this.enabled||!this.showIcon?$(this.container).hide():$(this.container).show()}}),new paella.plugins.PlayButtonOnScreen,Class("paella.plugins.PlaybackRate",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,defaultRate:null,_domElement:null,available_rates:null,getAlignment:function(){return"left"},getSubclass:function(){return"showPlaybackRateButton"},getIndex:function(){return 140},getMinWindowSize:function(){return 200},getName:function(){return"es.upv.paella.playbackRatePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Set playback rate")},checkEnabled:function(onSuccess){var enabled=!base.userAgent.browser.IsMobileVersion&&null!=dynamic_cast("paella.Html5Video",paella.player.videoContainer.masterVideo());onSuccess(enabled)},setup:function(){this.defaultRate=1,this.available_rates=this.config.availableRates||[.75,1,1.25,1.5]},buildContent:function(domElement){var This=this;This._domElement=domElement,this.buttonItems={},this.available_rates.forEach(function(rate){domElement.appendChild(This.getItemButton(rate+"x",rate))})},getItemButton:function(label,rate){var elem=document.createElement("div");return 1==rate?elem.className=this.getButtonItemClass(label,!0):elem.className=this.getButtonItemClass(label,!1),elem.id=label+"_button",elem.innerHTML=label,elem.data={label:label,rate:rate,plugin:this},$(elem).click(function(event){this.data.plugin.onItemClick(this,this.data.label,this.data.rate)}),elem},onItemClick:function(button,label,rate){var self=this;paella.player.videoContainer.setPlaybackRate(rate),this.setText(label),paella.player.controls.hidePopUp(this.getName());for(var arr=self._domElement.children,i=0;i<arr.length;i++)arr[i].className=self.getButtonItemClass(i,!1);button.className=self.getButtonItemClass(i,!0)},getText:function(){return"1x"},getProfileItemButton:function(profile,profileData){var elem=document.createElement("div");return elem.className=this.getButtonItemClass(profile,!1),elem.id=profile+"_button",elem.data={profile:profile,profileData:profileData,plugin:this},$(elem).click(function(event){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),elem},getButtonItemClass:function(profileName,selected){return"playbackRateItem "+profileName+(selected?" selected":"")}}),paella.plugins.playbackRate=new paella.plugins.PlaybackRate,Class("paella.RTMPVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_duration:0,_paused:!0,_flashId:null,_swfContainer:null,_flashVideo:null,_volume:1,initialize:function(id,stream,left,top,width,height){this.parent(id,stream,"div",left,top,width,height),this._flashId=id+"Movie";var This=this;this._stream.sources.rtmp.sort(function(a,b){return a.res.h-b.res.h});var processEvent=function(eventName,params){if("loadedmetadata"==eventName||"pause"==eventName||This._isReady||(This._isReady=!0,This._duration=params.duration,$(This.swfContainer).trigger("paella:flashvideoready")),"progress"==eventName){try{This.flashVideo.setVolume(This._volume)}catch(e){}base.log.debug("Flash video event: "+eventName+", progress: "+This.flashVideo.currentProgress())}else"ended"==eventName?(base.log.debug("Flash video event: "+eventName),paella.events.trigger(paella.events.pause),paella.player.controls.showControls()):base.log.debug("Flash video event: "+eventName)},eventReceived=function(eventName,params){params=params.split(",");for(var processedParams={},i=0;i<params.length;++i){var splitted=params[i].split(":"),key=splitted[0],value=splitted[1];"NaN"==value?value=NaN:/^true$/i.test(value)?value=!0:/^false$/i.test(value)?value=!1:isNaN(parseFloat(value))||(value=parseFloat(value)),processedParams[key]=value}processEvent(eventName,processedParams)};paella.events.bind(paella.events.flashVideoEvent,function(event,params){This.flashId==params.source&&eventReceived(params.eventName,params.values)}),Object.defineProperty(this,"swfContainer",{get:function(){return This._swfContainer}}),Object.defineProperty(this,"flashId",{get:function(){return This._flashId}}),Object.defineProperty(this,"flashVideo",{get:function(){return This._flashVideo}})},_createSwfObject:function(swfFile,flashVars){var id=this.identifier,parameters={wmode:"transparent"},domElement=document.createElement("div");if(this.domElement.appendChild(domElement),domElement.id=id+"Movie",this._swfContainer=domElement,swfobject.hasFlashPlayerVersion("9.0.0"))swfobject.embedSWF(swfFile,domElement.id,"100%","100%","9.0.0","",flashVars,parameters,null,function(e){if(0==e.success){var message=document.createElement("div"),header=document.createElement("h3");header.innerHTML=base.dictionary.translate("Flash player problem");var text=document.createElement("div");text.innerHTML=base.dictionary.translate("A problem occurred trying to load flash player.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>")+"<br>"+base.dictionary.translate("If the problem presist, contact us.");var link=document.createElement("a");link.setAttribute("href","http://www.adobe.com/go/getflash"),link.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',message.appendChild(header),message.appendChild(text),message.appendChild(link),paella.messageBox.showError(message.innerHTML)}});else{var message=document.createElement("div"),header=document.createElement("h3");header.innerHTML=base.dictionary.translate("Flash player 9 nedded");var text=document.createElement("div");text.innerHTML=base.dictionary.translate("You need at least Flash player 9 installed.")+"<br>"+base.dictionary.translate("Please go to {0} and install it.").replace("{0}","<a style='color: #800000; text-decoration: underline;' href='http://www.adobe.com/go/getflash'>http://www.adobe.com/go/getflash</a>");var link=document.createElement("a");link.setAttribute("href","http://www.adobe.com/go/getflash"),link.innerHTML='<img style="margin:5px;" src="http://www.adobe.com/images/shared/download_buttons/get_flash_player.gif" alt="Obtener Adobe Flash Player" />',message.appendChild(header),message.appendChild(text),message.appendChild(link),paella.messageBox.showError(message.innerHTML)}var flashObj=$("#"+domElement.id)[0];return flashObj},_deferredAction:function(action){var This=this,defer=new $.Deferred;if(This.ready)defer.resolve(action());else{var resolve=function(){This._ready=!0,defer.resolve(action())};$(This.swfContainer).bind("paella:flashvideoready",resolve)}return defer},_getQualityObject:function(index,s){return{index:index,res:s.res,src:s.src,toString:function(){return this.res.w+"x"+this.res.h},shortLabel:function(){return this.res.h+"p"},compare:function(q2){return this.res.w*this.res.h-q2.res.w*q2.res.h}}},getVideoData:function(){var defer=$.Deferred(),This=this;return this._deferredAction(function(){var videoData={duration:This.flashVideo.duration(),currentTime:This.flashVideo.getCurrentTime(),volume:This.flashVideo.getVolume(),paused:This._paused,ended:This._ended,res:{w:This.flashVideo.getWidth(),h:This.flashVideo.getHeight()}};defer.resolve(videoData)}),defer},setPosterFrame:function(url){if(null==this._posterFrame){this._posterFrame=url;var posterFrame=document.createElement("img");posterFrame.src=url,posterFrame.className="videoPosterFrameImage",posterFrame.alt="poster frame",this.domElement.appendChild(posterFrame),this._posterFrameElement=posterFrame}},setAutoplay:function(auto){this._autoplay=auto},load:function(){var sources=this._stream.sources.rtmp;null===this._currentQuality&&this._videoQualityStrategy&&(this._currentQuality=this._videoQualityStrategy.getQualityIndex(sources));var isValid=function(stream){return stream.src&&"object"==typeof stream.src&&stream.src.server&&stream.src.stream},stream=this._currentQuality<sources.length?sources[this._currentQuality]:null;if(stream){if(isValid(stream)){var subscription=!1;void 0===stream.src.requiresSubscription&&paella.player.config.player.rtmpSettings?subscription=paella.player.config.player.rtmpSettings.requiresSubscription||!1:stream.src.requiresSubscription&&(subscription=stream.src.requiresSubscription);var parameters={},swfName="resources/deps/player_streaming.swf";return this._autoplay&&(parameters.autoplay=this._autoplay),"true"==base.parameters.get("debug")&&(parameters.debugMode=!0),parameters.playerId=this.flashId,parameters.isLiveStream=void 0!==stream.isLiveStream&&stream.isLiveStream,parameters.server=stream.src.server,parameters.stream=stream.src.stream,parameters.subscribe=subscription,paella.player.config.player.rtmpSettings&&void 0!==paella.player.config.player.rtmpSettings.bufferTime&&(parameters.bufferTime=paella.player.config.player.rtmpSettings.bufferTime),this._flashVideo=this._createSwfObject(swfName,parameters),$(this.swfContainer).trigger("paella:flashvideoready"),this._deferredAction(function(){return stream})}return paella_DeferredRejected(new Error("Invalid video data"))}return paella_DeferredRejected(new Error("Could not load video: invalid quality stream index"))},getQualities:function(){var This=this,defer=$.Deferred();return setTimeout(function(){var result=[],sources=This._stream.sources.rtmp,index=-1;sources.forEach(function(s){index++,result.push(This._getQualityObject(index,s))}),defer.resolve(result)},10),defer},setQuality:function(index){index=void 0!==index&&null!==index?index:0;var defer=$.Deferred(),This=this,sources=(this._paused,this._stream.sources.rtmp);this._currentQuality=index<sources.length?index:0;var source=sources[index];if(source.isLiveStream)return paella_DeferredResolved();this._currentTime;return This.load().then(function(){defer.resolve()}),defer},getCurrentQuality:function(){var defer=$.Deferred();return defer.resolve(this._getQualityObject(this._currentQuality,this._stream.sources.rtmp[this._currentQuality])),defer},play:function(){var This=this;return this._deferredAction(function(){This._posterFrameElement&&(This._posterFrameElement.parentNode.removeChild(This._posterFrameElement),This._posterFrameElement=null),This._paused=!1,This.flashVideo.play()})},pause:function(){var This=this;return this._deferredAction(function(){This._paused=!0,This.flashVideo.pause()})},isPaused:function(){var This=this;return this._deferredAction(function(){return This._paused})},duration:function(){var This=this;return this._deferredAction(function(){return This.flashVideo.duration()})},setCurrentTime:function(time){var This=this;return this._deferredAction(function(){var duration=This.flashVideo.duration();This.flashVideo.seekTo(100*time/duration)})},currentTime:function(){var This=this;return this._deferredAction(function(){return This.flashVideo.getCurrentTime()})},setVolume:function(volume){var This=this;return this._volume=volume,this._deferredAction(function(){This.flashVideo.setVolume(volume)})},volume:function(){var This=this;return this._deferredAction(function(){return This.flashVideo.getVolume()})},setPlaybackRate:function(rate){var This=this;return this._deferredAction(function(){This._playbackRate=rate})},playbackRate:function(){var This=this;return this._deferredAction(function(){return This._playbackRate})},goFullScreen:function(){return paella_DeferredNotImplemented()},unFreeze:function(){return this._deferredAction(function(){})},freeze:function(){return this._deferredAction(function(){})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.RTMPVideoFactory",{isStreamCompatible:function(streamData){try{if(base.userAgent.system.iOS||base.userAgent.system.Android)return!1;for(var key in streamData.sources)if("rtmp"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return new paella.RTMPVideo(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.plugins.CaptionsSearchPlugIn",paella.SearchServicePlugIn,{getName:function(){return"es.upv.paella.search.captionsSearchPlugin"},search:function(text,next){paella.captions.search(text,next)}}),new paella.plugins.CaptionsSearchPlugIn,Class("paella.plugins.SearchPlugin",paella.ButtonPlugin,{_open:!1,_sortDefault:"time",_colorSearch:!1,_localImages:null,_searchTimer:null,_searchTimerTime:1500,_searchBody:null,getAlignment:function(){return"right"},getSubclass:function(){return"searchButton"},getName:function(){return"es.upv.paella.searchPlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Search")},getIndex:function(){return 510},checkEnabled:function(onSuccess){onSuccess(!0)},setup:function(){var self=this;$(".searchButton").click(function(event){self._open?self._open=!1:(self._open=!0,setTimeout(function(){$("#searchBarInput").focus()},0))}),self._localImages=paella.initDelegate.initParams.videoLoader.frameList,self._colorSearch=self.config.colorSearch||!1,self._sortDefault=self.config.sortType||"time",paella.events.bind(paella.events.controlBarWillHide,function(evt){self._open&&paella.player.controls.cancelHideBar()})},prettyTime:function(seconds){var hou=Math.floor(seconds/3600)%24;hou=("00"+hou).slice(hou.toString().length);var min=Math.floor(seconds/60)%60;min=("00"+min).slice(min.toString().length);var sec=Math.floor(seconds%60);sec=("00"+sec).slice(sec.toString().length);var timestr=hou+":"+min+":"+sec;return timestr},search:function(text,cb){paella.searchService.search(text,cb)},getPreviewImage:function(time){var thisClass=this,keys=Object.keys(thisClass._localImages);keys.push(time),keys.sort(function(a,b){return parseInt(a)-parseInt(b)});var n=keys.indexOf(time)-1;n=n>0?n:0;var i=keys[n];return i=parseInt(i),thisClass._localImages[i].url},createLoadingElement:function(parent){var loadingResults=document.createElement("div");loadingResults.className="loader";var htmlLoader='<svg version="1.1" id="loader-1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="40px" height="40px" viewBox="0 0 50 50" style="enable-background:new 0 0 50 50;" xml:space="preserve"><path fill="#000" d="M25.251,6.461c-10.318,0-18.683,8.365-18.683,18.683h4.068c0-8.071,6.543-14.615,14.615-14.615V6.461z"><animateTransform attributeType="xml"attributeName="transform"type="rotate"from="0 25 25"to="360 25 25"dur="0.6s"repeatCount="indefinite"/></path></svg>';loadingResults.innerHTML=htmlLoader,parent.appendChild(loadingResults);var sBodyText=document.createElement("p");sBodyText.className="sBodyText",sBodyText.innerHTML=base.dictionary.translate("Searching")+"...",parent.appendChild(sBodyText)},createNotResultsFound:function(parent){var noResults=document.createElement("div");noResults.className="noResults",noResults.innerHTML=base.dictionary.translate("Sorry! No results found."),parent.appendChild(noResults)},doSearch:function(txt,searchBody){var thisClass=this;$(searchBody).empty(),thisClass.createLoadingElement(searchBody),thisClass.search(txt,function(err,results){if($(searchBody).empty(),!err)if(0==results.length)thisClass.createNotResultsFound(searchBody);else for(var i=0;i<results.length;i++){"score"==thisClass._sortDefault&&results.sort(function(a,b){return b.score-a.score}),"time"==thisClass._sortDefault&&results.sort(function(a,b){return a.time-b.time});var sBodyInnerContainer=document.createElement("div");sBodyInnerContainer.className="sBodyInnerContainer",thisClass._colorSearch&&(results[i].score<=.3&&$(sBodyInnerContainer).addClass("redScore"),results[i].score>=.7&&$(sBodyInnerContainer).addClass("greenScore"));var TimePicContainer=document.createElement("div");TimePicContainer.className="TimePicContainer";var sBodyPicture=document.createElement("img");sBodyPicture.className="sBodyPicture",sBodyPicture.src=thisClass.getPreviewImage(results[i].time);var sBodyText=document.createElement("p");sBodyText.className="sBodyText",sBodyText.innerHTML="<span class='timeSpan'>"+thisClass.prettyTime(results[i].time)+"</span>"+results[i].content,TimePicContainer.appendChild(sBodyPicture),sBodyInnerContainer.appendChild(TimePicContainer),sBodyInnerContainer.appendChild(sBodyText),searchBody.appendChild(sBodyInnerContainer),sBodyInnerContainer.setAttribute("sec",results[i].time),$(sBodyInnerContainer).hover(function(){$(this).css("background-color","#faa166")},function(){$(this).removeAttr("style")}),$(sBodyInnerContainer).click(function(){var sec=$(this).attr("sec");paella.player.videoContainer.seekToTime(sec),paella.player.play()})}})},buildContent:function(domElement){var thisClass=this,searchPluginContainer=document.createElement("div");searchPluginContainer.className="searchPluginContainer";var searchBody=document.createElement("div");searchBody.className="searchBody",searchPluginContainer.appendChild(searchBody),thisClass._searchBody=searchBody;var searchBar=document.createElement("div");searchBar.className="searchBar",searchPluginContainer.appendChild(searchBar);var input=document.createElement("input");input.className="searchBarInput",input.type="text",input.id="searchBarInput",input.name="searchString",input.placeholder=base.dictionary.translate("Search"),searchBar.appendChild(input),$(input).change(function(){var text=$(input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),""!=text&&thisClass.doSearch(text,searchBody)}),$(input).keyup(function(event){if(13!=event.keyCode){var text=$(input).val();null!=thisClass._searchTimer&&thisClass._searchTimer.cancel(),""!=text?thisClass._searchTimer=new base.Timer(function(timer){thisClass.doSearch(text,searchBody)},thisClass._searchTimerTime):$(thisClass._searchBody).empty()}}),$(input).focus(function(){paella.keyManager.enabled=!1}),$(input).focusout(function(){paella.keyManager.enabled=!0}),domElement.appendChild(searchPluginContainer)}}),paella.plugins.searchPlugin=new paella.plugins.SearchPlugin,Class("paella.ShowEditorPlugin",paella.VideoOverlayButtonPlugin,{isEditorVisible:function(){return null!=paella.editor.instance},getIndex:function(){return 10},getSubclass:function(){return"showEditorButton"},getAlignment:function(){return"right"},getDefaultToolTip:function(){return base.dictionary.translate("Enter editor mode")},checkEnabled:function(onSuccess){var stat=paella.editor&&paella.player.config.editor&&paella.player.config.editor.enabled&&!base.userAgent.browser.IsMobileVersion&&this.config.alwaysVisible&&!paella.player.isLiveStream();stat?paella.initDelegate.initParams.accessControl.canWrite().then(onSuccess):onSuccess(!1)},setup:function(){var thisClass=this;paella.events.bind(paella.events.hideEditor,function(event){thisClass.onHideEditor()}),paella.events.bind(paella.events.showEditor,function(event){thisClass.onShowEditor()})},action:function(button){var editorPage=this.config.editorPage?this.config.editorPage:"",openEditorInIframe=!!this.config.openEditorInIframe&&this.config.openEditorInIframe;window==window.top||openEditorInIframe?paella.events.trigger(paella.events.showEditor):window.open(editorPage+"?id="+paella.player.videoIdentifier,"_top")},onHideEditor:function(){this.showButton()},onShowEditor:function(){this.hideButton()},getName:function(){return"es.upv.paella.showEditorPlugin"}}),paella.plugins.showEditorPlugin=new paella.ShowEditorPlugin,Class("paella.plugins.SocialPlugin",paella.ButtonPlugin,{buttonItems:null,socialMedia:null,getAlignment:function(){return"right"},getSubclass:function(){return"showSocialPluginButton"},getIndex:function(){return 560},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.socialPlugin"},checkEnabled:function(onSuccess){onSuccess(!0)},getDefaultToolTip:function(){return base.dictionary.translate("Share this video")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},buttons:[],selected_button:null,initialize:function(){if(this.parent(),"es"==base.dictionary.currentLanguage()){var esDict={"Custom size:":"Tamaño personalizado:","Choose your embed size. Copy the text and paste it in your html page.":"Elija el tamaño del video a embeber. Copie el texto y péguelo en su página html.","Width:":"Ancho:","Height:":"Alto:"};base.dictionary.addDictionary(esDict)}},setup:function(){var thisClass=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){thisClass.isPopUpOpen()&&(event.keyCode==Keys.Up?thisClass.selected_button>0&&(thisClass.selected_button<thisClass.buttons.length&&(thisClass.buttons[thisClass.selected_button].className="socialItemButton "+thisClass.buttons[thisClass.selected_button].data.mediaData),thisClass.selected_button--,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Down?thisClass.selected_button<thisClass.buttons.length-1&&(thisClass.selected_button>=0&&(thisClass.buttons[thisClass.selected_button].className="socialItemButton "+thisClass.buttons[thisClass.selected_button].data.mediaData),thisClass.selected_button++,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Return&&thisClass.onItemClick(thisClass.buttons[thisClass.selected_button].data.mediaData))})},buildContent:function(domElement){var thisClass=this;this.buttonItems={},socialMedia=["facebook","twitter","embed"],socialMedia.forEach(function(mediaData){var buttonItem=thisClass.getSocialMediaItemButton(mediaData);thisClass.buttonItems[socialMedia.indexOf(mediaData)]=buttonItem,domElement.appendChild(buttonItem),thisClass.buttons.push(buttonItem)}),this.selected_button=thisClass.buttons.length},getSocialMediaItemButton:function(mediaData){var elem=document.createElement("div");return elem.className="socialItemButton "+mediaData,elem.id=mediaData+"_button",elem.data={mediaData:mediaData,plugin:this},$(elem).click(function(event){this.data.plugin.onItemClick(this.data.mediaData)}),elem},onItemClick:function(mediaData){var url=this.getVideoUrl();switch(mediaData){case"twitter":window.open("http://twitter.com/home?status="+url);break;case"facebook":window.open("http://www.facebook.com/sharer.php?u="+url);break;case"embed":this.embedPress()}paella.player.controls.hidePopUp(this.getName())},getVideoUrl:function(){var url=document.location.href;return url},embedPress:function(){var host=document.location.protocol+"//"+document.location.host,pathname=document.location.pathname,p=pathname.split("/");p.length>0&&(p[p.length-1]="embed.html");var id=paella.initDelegate.getId(),url=host+p.join("/")+"?id="+id,divSelectSize="<div style='display:inline-block;'>     <div class='embedSizeButton' style='width:110px; height:73px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 620x349 </span></div>    <div class='embedSizeButton' style='width:100px; height:65px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 540x304 </span></div>    <div class='embedSizeButton' style='width:90px;  height:58px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 460x259 </span></div>    <div class='embedSizeButton' style='width:80px;  height:50px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 380x214 </span></div>    <div class='embedSizeButton' style='width:70px;  height:42px;'> <span style='display:flex; align-items:center; justify-content:center; width:100%; height:100%;'> 300x169 </span></div></div><div style='display:inline-block; vertical-align:bottom; margin-left:10px;'>    <div>"+base.dictionary.translate("Custom size:")+"</div>    <div>"+base.dictionary.translate("Width:")+" <input id='social_embed_width-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div>    <div>"+base.dictionary.translate("Height:")+" <input id='social_embed_height-input' class='embedSizeInput' maxlength='4' type='text' name='Costum width min 300px' alt='Costum width min 300px' title='Costum width min 300px' value=''></div></div>",divEmbed="<div id='embedContent' style='text-align:left; font-size:14px; color:black;'><div id=''>"+divSelectSize+"</div> <div id=''>"+base.dictionary.translate("Choose your embed size. Copy the text and paste it in your html page.")+"</div> <div id=''><textarea id='social_embed-textarea' class='social_embed-textarea' rows='4' cols='1' style='font-size:12px; width:95%; overflow:auto; margin-top:5px; color:black;'></textarea></div>  </div>";paella.messageBox.showMessage(divEmbed,{closeButton:!0,width:"750px",height:"210px",onClose:function(){}});var w_e=$("#social_embed_width-input")[0],h_e=$("#social_embed_height-input")[0];w_e.onkeyup=function(event){var width=parseInt(w_e.value),height=parseInt(h_e.value);isNaN(width)?w_e.value="":width<300?$("#social_embed-textarea")[0].value="Embed width too low. The minimum value is a width of 300.":(isNaN(height)&&(height=(width/(16/9)).toFixed(),h_e.value=height),$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+url+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+width+'" height="'+height+'"></iframe>')};for(var embs=$(".embedSizeButton"),i=0;i<embs.length;i+=1){var e=embs[i];e.onclick=function(event){var value=event.target?event.target.textContent:event.toElement.textContent;if(value){var size=value.split("x");w_e.value=size[0],h_e.value=size[1],$("#social_embed-textarea")[0].value='<iframe allowfullscreen src="'+url+'" style="border:0px #FFFFFF none;" name="Paella Player" scrolling="no" frameborder="0" marginheight="0px" marginwidth="0px" width="'+size[0]+'" height="'+size[1]+'"></iframe>'}}}}}),paella.plugins.socialPlugin=new paella.plugins.SocialPlugin;var MyTabBarExamplePlugin=Class.create(paella.TabBarPlugin,{getSubclass:function(){return"test"},getTabName:function(){return"TabBar Example"},getName:function(){return"es.upv.paella.test.tabBarExamplePlugin"},buildContent:function(domElement){domElement.innerHTML="<p>This is a Paella Extended tab bar plugin</p>"}});new MyTabBarExamplePlugin,Class("paella.plugins.VideoLoadTestPlugin",paella.EventDrivenPlugin,{startTime:0,endTime:0,initialize:function(){if(this.parent(),this.startTime=Date.now(),"es"==base.dictionary.currentLanguage()){var esDict={"Video loaded in {0} seconds":"Video cargado en {0} segundos"};base.dictionary.addDictionary(esDict)}},getName:function(){return"es.upv.paella.test.videoLoadPlugin"},checkEnabled:function(onSuccess){onSuccess(!0)},getEvents:function(){return[paella.events.loadComplete]},onEvent:function(eventType,params){switch(eventType){case paella.events.loadComplete:this.onLoadComplete()}},onLoadComplete:function(){this.endTime=Date.now();var bench=(this.endTime-this.startTime)/1e3;this.showOverlayMessage(base.dictionary.translate("Video loaded in {0} seconds").replace(/\{0\}/g,bench))},showOverlayMessage:function(message){var overlayContainer=paella.player.videoContainer.overlayContainer,rect={left:40,top:50,width:430,height:80},root=document.createElement("div");root.className="videoLoadTestOverlay";var button=document.createElement("div");button.className="btn",button.innerHTML="X",button.onclick=function(){
overlayContainer.removeElement(root)};var element=document.createElement("div");element.className="videoLoadTest",element.innerHTML=message,element.appendChild(button),root.appendChild(element),overlayContainer.addElement(root,rect)}}),paella.plugins.videoLoadTestPlugin=new paella.plugins.VideoLoadTestPlugin,Class("paella.plugins.ThemeChooserPlugin",paella.ButtonPlugin,{currentUrl:null,currentMaster:null,currentSlave:null,availableMasters:[],availableSlaves:[],getAlignment:function(){return"right"},getSubclass:function(){return"themeChooserPlugin"},getIndex:function(){return 2030},getMinWindowSize:function(){return 600},getName:function(){return"es.upv.paella.themeChooserPlugin"},getDefaultToolTip:function(){return base.dictionary.translate("Change theme")},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},checkEnabled:function(onSuccess){onSuccess(paella.player.config.skin&&paella.player.config.skin.available&&paella.player.config.skin.available instanceof Array&&paella.player.config.skin.available.length>0?!0:!1)},buildContent:function(domElement){var This=this;paella.player.config.skin.available.forEach(function(item){var elem=document.createElement("div");elem.className="themebutton",elem.innerHTML=item.replace("-"," ").replace("_"," "),$(elem).click(function(event){paella.utils.skin.set(item),paella.player.controls.hidePopUp(This.getName())}),domElement.appendChild(elem)})}}),paella.plugins.themeChooserPlugin=new paella.plugins.ThemeChooserPlugin,paella.plugins.translectures={},Class("paella.captions.translectures.Caption",paella.captions.Caption,{initialize:function(id,format,url,lang,editURL,next){this.parent(id,format,url,lang,next),this._captionsProvider="translecturesCaptionsProvider",this._editURL=editURL},canEdit:function(next){next(!1,void 0!=this._editURL&&""!=this._editURL)},goToEdit:function(){var self=this;paella.player.auth.userData().then(function(userData){1==userData.isAnonymous?self.askForAnonymousOrLoginEdit():self.doEdit()})},doEdit:function(){window.location.href=this._editURL},doLoginAndEdit:function(){paella.player.auth.login(this._editURL)},askForAnonymousOrLoginEdit:function(){var self=this,messageBoxElem=document.createElement("div");messageBoxElem.className="translecturesCaptionsMessageBox";var messageBoxTitle=document.createElement("div");messageBoxTitle.className="title",messageBoxTitle.innerHTML=base.dictionary.translate("You are trying to modify the transcriptions, but you are not Logged in!"),messageBoxElem.appendChild(messageBoxTitle);var messageBoxAuthContainer=document.createElement("div");messageBoxAuthContainer.className="authMethodsContainer",messageBoxElem.appendChild(messageBoxAuthContainer);var messageBoxAuth=document.createElement("div");messageBoxAuth.className="authMethod",messageBoxAuthContainer.appendChild(messageBoxAuth);var messageBoxAuthLink=document.createElement("a");messageBoxAuthLink.href="#",messageBoxAuthLink.style.color="#004488",messageBoxAuth.appendChild(messageBoxAuthLink);var messageBoxAuthLinkImg=document.createElement("img");messageBoxAuthLinkImg.src="resources/style/caption_mlangs_anonymous.png",messageBoxAuthLinkImg.alt="Anonymous",messageBoxAuthLinkImg.style.height="100px",messageBoxAuthLink.appendChild(messageBoxAuthLinkImg);var messageBoxAuthLinkText=document.createElement("p");messageBoxAuthLinkText.innerHTML=base.dictionary.translate("Continue editing the transcriptions anonymously"),messageBoxAuthLink.appendChild(messageBoxAuthLinkText),$(messageBoxAuthLink).click(function(){self.doEdit()}),messageBoxAuth=document.createElement("div"),messageBoxAuth.className="authMethod",messageBoxAuthContainer.appendChild(messageBoxAuth),messageBoxAuthLink=document.createElement("a"),messageBoxAuthLink.href="#",messageBoxAuthLink.style.color="#004488",messageBoxAuth.appendChild(messageBoxAuthLink),messageBoxAuthLinkImg=document.createElement("img"),messageBoxAuthLinkImg.src="resources/style/caption_mlangs_lock.png",messageBoxAuthLinkImg.alt="Login",messageBoxAuthLinkImg.style.height="100px",messageBoxAuthLink.appendChild(messageBoxAuthLinkImg),messageBoxAuthLinkText=document.createElement("p"),messageBoxAuthLinkText.innerHTML=base.dictionary.translate("Log in and edit the transcriptions"),messageBoxAuthLink.appendChild(messageBoxAuthLinkText),$(messageBoxAuthLink).click(function(){self.doLoginAndEdit()}),paella.messageBox.showElement(messageBoxElem)}}),Class("paella.plugins.translectures.CaptionsPlugIn",paella.EventDrivenPlugin,{getName:function(){return"es.upv.paella.translecture.captionsPlugin"},getEvents:function(){return[]},onEvent:function(eventType,params){},checkEnabled:function(onSuccess){var self=this,video_id=paella.player.videoIdentifier;if(void 0==this.config.tLServer||void 0==this.config.tLdb)base.log.warning(this.getName()+" plugin not configured!"),onSuccess(!1);else{var langs_url=(this.config.tLServer+"/langs?db=${tLdb}&id=${videoId}").replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,this.config.tLdb);base.ajax.get({url:langs_url},function(data,contentType,returnCode,dataRaw){0==data.scode?(data.langs.forEach(function(l){var l_edit_url,l_get_url=(self.config.tLServer+"/dfxp?format=1&pol=0&db=${tLdb}&id=${videoId}&lang=${tl.lang.code}").replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,self.config.tLdb).replace(/\$\{tl.lang.code\}/gi,l.code);self.config.tLEdit&&(l_edit_url=self.config.tLEdit.replace(/\$\{videoId\}/gi,video_id).replace(/\$\{tLdb\}/gi,self.config.tLdb).replace(/\$\{tl.lang.code\}/gi,l.code));var l_txt=l.value;switch(l.type){case 0:l_txt+=" ("+paella.dictionary.translate("Auto")+")";break;case 1:l_txt+=" ("+paella.dictionary.translate("Under review")+")"}var c=new paella.captions.translectures.Caption(l.code,"dfxp",l_get_url,{code:l.code,txt:l_txt},l_edit_url);paella.captions.addCaptions(c)}),onSuccess(!1)):(base.log.debug("Error getting available captions from translectures: "+langs_url),onSuccess(!1))},function(data,contentType,returnCode){base.log.debug("Error getting available captions from translectures: "+langs_url),onSuccess(!1)})}}}),new paella.plugins.translectures.CaptionsPlugIn,new(Class(paella.userTracking.SaverPlugIn,{type:"userTrackingSaverPlugIn",getName:function(){return"es.upv.paella.usertracking.elasticsearchSaverPlugin"},checkEnabled:function(onSuccess){this._url=this.config.url,this._index=this.config.index||"paellaplayer",this._type=this.config.type||"usertracking";var enabled=!0;void 0==this._url&&(enabled=!1,base.log.debug("No ElasticSearch URL found in config file. Disabling ElasticSearch PlugIn")),onSuccess(enabled)},log:function(event,params){var p=params;"object"!=typeof p&&(p={value:p});var log={date:new Date,video:paella.initDelegate.getId(),playing:!paella.player.videoContainer.paused(),time:parseInt(paella.player.videoContainer.currentTime()+paella.player.videoContainer.trimStart()),event:event,params:p};paella.ajax.post({url:this._url+"/"+this._index+"/"+this._type+"/",params:JSON.stringify(log)})}})),new(Class(paella.userTracking.SaverPlugIn,{getName:function(){return"es.upv.paella.usertracking.GoogleAnalyticsSaverPlugin"},checkEnabled:function(onSuccess){var trackingID=this.config.trackingID,domain=this.config.domain||"auto";trackingID?(base.log.debug("Google Analitycs Enabled"),function(i,s,o,g,r,a,m){i.GoogleAnalyticsObject=r,i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date,a=s.createElement(o),m=s.getElementsByTagName(o)[0],a.async=1,a.src=g,m.parentNode.insertBefore(a,m)}(window,document,"script","//www.google-analytics.com/analytics.js","__gaTracker"),__gaTracker("create",trackingID,domain),__gaTracker("send","pageview"),onSuccess(!0)):(base.log.debug("No Google Tracking ID found in config file. Disabling Google Analitycs PlugIn"),onSuccess(!1))},log:function(event,params){if(void 0===this.config.category||this.config.category===!0){var category=this.config.category||"PaellaPlayer",action=event,label="";try{label=JSON.stringify(params)}catch(e){}__gaTracker("send","event",category,action,label)}}})),Class("paella.plugins.ViewModePlugin",paella.ButtonPlugin,{buttonItems:null,buttons:[],selected_button:null,active_profiles:null,getAlignment:function(){return"right"},getSubclass:function(){return"showViewModeButton"},getIndex:function(){return 540},getMinWindowSize:function(){return 300},getName:function(){return"es.upv.paella.viewModePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Change video layout")},checkEnabled:function(onSuccess){this.active_profiles=this.config.activeProfiles,onSuccess(!paella.player.videoContainer.isMonostream)},setup:function(){var thisClass=this;Keys={Tab:9,Return:13,Esc:27,End:35,Home:36,Left:37,Up:38,Right:39,Down:40},$(this.button).keyup(function(event){thisClass.isPopUpOpen()&&(event.keyCode==Keys.Up?thisClass.selected_button>0&&(thisClass.selected_button<thisClass.buttons.length&&(thisClass.buttons[thisClass.selected_button].className="viewModeItemButton "+thisClass.buttons[thisClass.selected_button].data.profile),thisClass.selected_button--,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Down?thisClass.selected_button<thisClass.buttons.length-1&&(thisClass.selected_button>=0&&(thisClass.buttons[thisClass.selected_button].className="viewModeItemButton "+thisClass.buttons[thisClass.selected_button].data.profile),thisClass.selected_button++,thisClass.buttons[thisClass.selected_button].className=thisClass.buttons[thisClass.selected_button].className+" selected"):event.keyCode==Keys.Return&&thisClass.onItemClick(thisClass.buttons[thisClass.selected_button],thisClass.buttons[thisClass.selected_button].data.profile,thisClass.buttons[thisClass.selected_button].data.profile))})},buildContent:function(domElement){var thisClass=this;this.buttonItems={},paella.Profiles.loadProfileList(function(profiles){Object.keys(profiles).forEach(function(profile){if(!profiles[profile].hidden){if(thisClass.active_profiles){var active=!1;if(thisClass.active_profiles.forEach(function(ap){ap==profile&&(active=!0)}),0==active)return}var n=paella.player.videoContainer.sourceData[0].sources;if("s_p_blackboard2"!=profile||0!=n.hasOwnProperty("image")){var profileData=profiles[profile],buttonItem=thisClass.getProfileItemButton(profile,profileData);thisClass.buttonItems[profile]=buttonItem,domElement.appendChild(buttonItem),thisClass.buttons.push(buttonItem),paella.player.selectedProfile==profile&&(thisClass.buttonItems[profile].className=thisClass.getButtonItemClass(profile,!0))}}}),thisClass.selected_button=thisClass.buttons.length})},getProfileItemButton:function(profile,profileData){var elem=document.createElement("div");return elem.className=this.getButtonItemClass(profile,!1),elem.id=profile+"_button",elem.data={profile:profile,profileData:profileData,plugin:this},$(elem).click(function(event){this.data.plugin.onItemClick(this,this.data.profile,this.data.profileData)}),elem},onItemClick:function(button,profile,profileData){var thisClass=this,ButtonItem=this.buttonItems[profile];n=this.buttonItems,arr=Object.keys(n),arr.forEach(function(i){thisClass.buttonItems[i].className=thisClass.getButtonItemClass(i,!1)}),ButtonItem&&(ButtonItem.className=thisClass.getButtonItemClass(profile,!0),paella.player.setProfile(profile)),paella.player.controls.hidePopUp(this.getName())},getButtonItemClass:function(profileName,selected){return"viewModeItemButton "+profileName+(selected?" selected":"")}}),paella.plugins.viewModePlugin=new paella.plugins.ViewModePlugin,paella.dataDelegates.VisualAnnotationsDataDelegate=Class.create(paella.DataDelegate,{read:function(context,params,onSuccess){$.getJSON(params.url+params.id+"/annotations",function(data){"function"==typeof onSuccess&&onSuccess(data,!0)})}}),Class("paella.plugins.visualAnnotationPlugin",paella.EventDrivenPlugin,{_annotations:null,_paused:null,_rootElement:null,_prevProfile:null,checkEnabled:function(onSuccess){onSuccess(!0)},getName:function(){return"es.upv.paella.visualAnnotationPlugin"},getEvents:function(){return[paella.events.timeUpdate]},setup:function(){var self=this;paella.data.read("visualAnnotations",{id:paella.initDelegate.getId(),url:self.config.url},function(data,status){self._annotations=Array.isArray(data)?data:[]}),self._prevProfile=null},onEvent:function(event,params){switch(event){case paella.events.timeUpdate:this.drawAnnotation(event,params)}},drawAnnotation:function(event,params){var self=this,p={};p.closeButton=!0,p.onClose=function(){paella.events.trigger(paella.events.play)},self._annotations&&self._annotations.some(function(element,index,array){currentTime=Math.round(params.currentTime);var annotation=JSON.parse(element.content);if(currentTime>=element.time&&currentTime<element.time+element.duration&&0==$("#"+element._id).length){var layer=paella.player.videoContainer.overlayContainer.getLayer(element.type);annotation.format;self._rootElement=document.createElement("div"),self._rootElement.className=element.type+"textAnnotation",self._rootElement.id=element._id;var button=document.createElement("div");button.className="annotationClose righttop",button.innerHTML="X",button.onclick=function(){$("#"+element._id).css({display:"none"})};var el=document.createElement("div");el.className="innerAnnotation";for(var firstKey in annotation.data)break;"AD"==element.type?el.innerHTML='<div class="AdtextAnnotationLink" ><img src="./resources/images/popup.png" class="AdtextAnnotationIMG"></div>  <div class="AdtextAnnotationBody">'+annotation.data[navigator.language||navigator.userLanguage]||annotation.data[firstKey]+"</div></div>":el.innerHTML=annotation.data[navigator.language||navigator.userLanguage]||annotation.data[firstKey],""!=annotation.profile&&(null==self._prevProfile&&(self._prevProfile=paella.plugins.viewModePlugin.active_profiles||paella.Profiles.getDefaultProfile()),paella.events.trigger(paella.events.setProfile,{profileName:annotation.profile})),el.appendChild(button);var sheet=document.createElement("style");return sheet.innerHTML=annotation.style,el.appendChild(sheet),self._rootElement.appendChild(el),layer.appendChild(self._rootElement),!0}if((currentTime<element.time||currentTime>element.time+element.duration)&&0!=$("#"+element._id).length){if(1==annotation.pauser&&self._paused!=element._id)self._paused=element._id,paella.player.pause();else{var paused=!0;paella.player.paused().then(function(p){paused=p}),paused||(self._paused=null,self.closeAnnotation(element,!1))}return!0}})},closeAnnotation:function(element,forced){paella.events.trigger(paella.events.setProfile,{profileName:this._prevProfile}),this._prevProfile=null,$("#"+element._id).remove()}}),new paella.plugins.visualAnnotationPlugin,Class("paella.plugins.VolumeRangePlugin",paella.ButtonPlugin,{getAlignment:function(){return"left"},getSubclass:function(){return"volumeRangeButton"},getName:function(){return"es.upv.paella.volumeRangePlugin"},getButtonType:function(){return paella.ButtonPlugin.type.popUpButton},getDefaultToolTip:function(){return base.dictionary.translate("Volume")},getIndex:function(){return 120},_showMasterVolume:null,_showSlaveVolume:null,_tempMasterVolume:0,_tempSlaveVolume:0,_inputMaster:null,_inputSlave:null,_control_NotMyselfEvent:!0,_storedValue:!1,checkEnabled:function(onSuccess){var enabled=!1;base.userAgent.browser.IsMobileVersion||(this._showMasterVolume=void 0===this.config.showMasterVolume||this.config.showMasterVolume,this._showSlaveVolume=void 0!==this.config.showSlaveVolume&&!paella.player.videoContainer.isMonostream&&this.config.showSlaveVolume,(this._showMasterVolume||this._showSlaveVolume)&&(enabled=!0)),onSuccess(enabled)},setup:function(){var self=this;paella.events.bind(paella.events.videoUnloaded,function(event,params){self.storeVolume()}),paella.events.bind(paella.events.singleVideoReady,function(event,params){self.loadStoredVolume(params)}),paella.events.bind(paella.events.setVolume,function(evt,par){self.updateVolumeOnEvent(par)})},updateVolumeOnEvent:function(volume){var thisClass=this;thisClass._control_NotMyselfEvent?(thisClass._inputMaster&&(thisClass._inputMaster.value=volume.master),thisClass._inputSlave&&(thisClass._inputSlave.value=volume.slave)):thisClass._control_NotMyselfEvent=!0},storeVolume:function(){var This=!1;paella.player.videoContainer.masterVideo().volume().then(function(v){return This._tempMasterVolume=v,paella.player.videoContainer.slaveVideo()?paella.player.videoContainer.slaveVideo().volume():0}).then(function(v){This._tempSlaveVolume=v,This._storedValue=!0})},loadStoredVolume:function(params){0==this._storedValue&&this.storeVolume(),("playerContainer_videoContainer_1"==params.sender.identifier&&this._tempSlaveVolume||this._tempMasterVolume)&&paella.player.videoContainer.setVolume({master:this._tempMasterVolume,slave:this._tempSlaveVolume}),this._storedValue=!1},buildContent:function(domElement){var thisClass=this,videoRangeContainer=document.createElement("div");if(videoRangeContainer.className="videoRangeContainer",this._showMasterVolume){var rangeMaster=document.createElement("div");rangeMaster.className="range";var rangeImageMaster=document.createElement("div");rangeImageMaster.className="image master";var rangeInputMaster=document.createElement("input");thisClass._inputMaster=rangeInputMaster,rangeInputMaster.type="range",rangeInputMaster.min=0,rangeInputMaster.max=1,rangeInputMaster.step=.01,rangeInputMaster.value=this.getMasterVolume();var updateMasterVolume=function(){var masterVolume=$(rangeInputMaster).val(),slaveVideo=paella.player.videoContainer.slaveVideo(),slaveVolume=0;slaveVideo?slaveVideo.volume().then(function(volume){slaveVolume=volume,thisClass._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:masterVolume,slave:slaveVolume})}):(thisClass._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:masterVolume,slave:slaveVolume}))};$(rangeInputMaster).bind("input",function(e){updateMasterVolume()}),$(rangeInputMaster).change(function(){updateMasterVolume()}),rangeMaster.appendChild(rangeImageMaster),rangeMaster.appendChild(rangeInputMaster),videoRangeContainer.appendChild(rangeMaster)}if(!paella.player.videoContainer.isMonostream&&this._showSlaveVolume){var rangeSlave=document.createElement("div");rangeSlave.className="range";var rangeImageSlave=document.createElement("div");rangeImageSlave.className="image slave";var rangeInputSlave=document.createElement("input");thisClass._inputSlave=rangeInputSlave,rangeInputSlave.type="range",rangeInputSlave.min=0,rangeInputSlave.max=1,rangeInputSlave.step=.01,rangeInputSlave.value=this.getSlaveVolume();var updateSlaveVolume=function(){var masterVideo=paella.player.videoContainer.masterVideo(),slaveVolume=$(rangeInputSlave).val(),masterVolume=0;masterVideo?masterVideo.volume().then(function(volume){thisClass._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:volume,slave:slaveVolume})}):(thisClass._control_NotMyselfEvent=!1,paella.player.videoContainer.setVolume({master:masterVolume,slave:slaveVolume}))};$(rangeInputSlave).bind("input",function(e){updateSlaveVolume()}),$(rangeInputSlave).change(function(){updateSlaveVolume()}),rangeSlave.appendChild(rangeImageSlave),rangeSlave.appendChild(rangeInputSlave),videoRangeContainer.appendChild(rangeSlave)}paella.events.bind(paella.events.setVolume,function(event,params){this._showMasterVolume&&(rangeInputMaster.value=params.master),!paella.player.videoContainer.isMonostream&&this._showMasterVolume&&(rangeInputSlave.value=params.slave),thisClass.updateClass()}),domElement.appendChild(videoRangeContainer),thisClass.updateClass()},getMasterVolume:function(){var masterVideo=paella.player.videoContainer.masterVideo();return masterVideo?masterVideo.volume():0},getSlaveVolume:function(){var slaveVideo=paella.player.videoContainer.slaveVideo();return slaveVideo?slaveVideo.volume():0},updateClass:function(){var selected="",self=this;if(this._showMasterVolume&&this._showSlaveVolume)selected="med",this.button.className=["buttonPlugin",this.getAlignment(),this.getSubclass(),selected].join(" ");else{var volumePromise;this._showMasterVolume&&(volumePromise=paella.player.videoContainer.masterVideo().volume()),this._showSlaveVolume&&(volumePromise=paella.player.videoContainer.slaveVideo().volume()),volumePromise.then(function(volume){selected=void 0===volume?"med":0==volume?"mute":volume<.33?"min":volume<.66?"med":"max",self.button.className=["buttonPlugin",self.getAlignment(),self.getSubclass(),selected].join(" ")})}}}),paella.plugins.volumeRangePlugin=new paella.plugins.VolumeRangePlugin,Class("paella.plugins.WindowTitlePlugin",paella.EventDrivenPlugin,{_initDone:!1,getName:function(){return"es.upv.paella.windowTitlePlugin"},getEvents:function(){return[paella.events.singleVideoReady]},onEvent:function(eventType,params){switch(eventType){case paella.events.singleVideoReady:this._initDone||this.loadTitle()}},loadTitle:function(){var title=paella.player.videoLoader.getMetadata()&&paella.player.videoLoader.getMetadata().title;document.title=title||document.title,this._initDone=!0}}),paella.plugins.windowTitlePlugin=new paella.plugins.WindowTitlePlugin,Class("paella.YoutubeVideo",paella.VideoElementBase,{_posterFrame:null,_currentQuality:null,_autoplay:!1,_readyPromise:null,initialize:function(id,stream,left,top,width,height){this.parent(id,stream,"div",left,top,width,height);var This=this;this._readyPromise=$.Deferred(),Object.defineProperty(this,"video",{get:function(){return This._youtubePlayer}})},_deferredAction:function(action){var defer=new $.Deferred;return this._readyPromise.then(function(){defer.resolve(action())},function(){defer.reject()}),defer},_getQualityObject:function(index,s){var level=0;switch(s){case"small":level=1;break;case"medium":level=2;break;case"large":level=3;break;case"hd720":level=4;break;case"hd1080":level=5;break;case"highres":level=6}return{index:index,res:{w:null,h:null},src:null,label:s,level:level,bitrate:level,toString:function(){return this.label},shortLabel:function(){return this.label},compare:function(q2){return this.level-q2.level}}},_onStateChanged:function(e){console.log("On state changed")},getVideoData:function(){var defer=$.Deferred(),This=this;return this._deferredAction(function(){var stream=This._stream.sources.youtube[0],videoData={duration:This.video.getDuration(),currentTime:This.video.getCurrentTime(),volume:This.video.getVolume(),paused:!This._playing,ended:This.video.ended,res:{w:stream.res.w,h:stream.res.h}};defer.resolve(videoData)}),defer},setPosterFrame:function(url){this._posterFrame=url},setAutoplay:function(auto){this._autoplay=auto},setRect:function(rect,animate){this._rect=JSON.parse(JSON.stringify(rect));var relativeSize=new paella.RelativeVideoSize,percentTop=relativeSize.percentVSize(rect.top)+"%",percentLeft=relativeSize.percentWSize(rect.left)+"%",percentWidth=relativeSize.percentWSize(rect.width)+"%",percentHeight=relativeSize.percentVSize(rect.height)+"%",style={top:percentTop,left:percentLeft,width:percentWidth,height:percentHeight,position:"absolute"};if(animate){this.disableClassName();var thisClass=this;$("#"+this.identifier).animate(style,400,function(){thisClass.enableClassName(),paella.events.trigger(paella.events.setComposition,{video:thisClass})}),this.enableClassNameAfter(400)}else $("#"+this.identifier).css(style),paella.events.trigger(paella.events.setComposition,{video:this})},setVisible:function(visible,animate){"true"==visible&&animate?($("#"+this.identifier).show(),$("#"+this.identifier).animate({opacity:1},300)):"true"!=visible||animate?"false"==visible&&animate?$("#"+this.identifier).animate({opacity:0},300):"false"!=visible||animate||$("#"+this.identifier).hide():$("#"+this.identifier).show()},setLayer:function(layer){$("#"+this.identifier).css({zIndex:layer})},load:function(){var This=this,defer=$.Deferred();return this._qualityListReadyPromise=$.Deferred(),paella.youtubePlayerVars.apiReadyPromise.then(function(){var stream=This._stream.sources.youtube[0];stream?(This._youtubePlayer=new YT.Player(This.identifier,{height:"390",width:"640",videoId:stream.id,playerVars:{controls:0,disablekb:1},events:{onReady:function(e){This._readyPromise.resolve()},onStateChanged:function(e){console.log("state changed")},onPlayerStateChange:function(e){console.log("state changed")}}}),defer.resolve()):defer.reject(new Error("Could not load video: invalid quality stream index"))}),defer},getQualities:function(){var This=this,defer=$.Deferred();return this._qualityListReadyPromise.then(function(q){var result=[],index=-1;This._qualities={},q.forEach(function(item){index++,This._qualities[item]=This._getQualityObject(index,item),result.push(This._qualities[item])}),defer.resolve(result)}),defer},setQuality:function(index){var This=this,defer=$.Deferred();return this._qualityListReadyPromise.then(function(q){for(var key in This._qualities){var searchQ=This._qualities[key];if("object"==typeof searchQ&&searchQ.index==index){This.video.setPlaybackQuality(searchQ.label);break}}defer.resolve()}),defer},getCurrentQuality:function(){var This=this,defer=$.Deferred();return this._qualityListReadyPromise.then(function(q){defer.resolve(This._qualities[This.video.getPlaybackQuality()])}),defer},play:function(){var This=this;return this._deferredAction(function(){This._playing=!0,This.video.playVideo(),new base.Timer(function(timer){var q=This.video.getAvailableQualityLevels();q.length?(timer.repeat=!1,This._qualityListReadyPromise.resolve(q)):timer.repeat=!0},500)})},pause:function(){var This=this;return this._deferredAction(function(){This._playing=!1,This.video.pauseVideo()})},isPaused:function(){var This=this;return this._deferredAction(function(){return!This._playing})},duration:function(){var This=this;return this._deferredAction(function(){return This.video.getDuration()})},setCurrentTime:function(time){var This=this;return this._deferredAction(function(){This.video.seekTo(time)})},currentTime:function(){var This=this;return this._deferredAction(function(){return This.video.getCurrentTime()})},setVolume:function(volume){var This=this;return this._deferredAction(function(){This.video.setVolume(100*volume)})},volume:function(){var This=this;return this._deferredAction(function(){return This.video.getVolume()/100})},setPlaybackRate:function(rate){var This=this;return this._deferredAction(function(){This.video.playbackRate=rate})},playbackRate:function(){var This=this;return this._deferredAction(function(){return This.video.playbackRate})},goFullScreen:function(){var This=this;return this._deferredAction(function(){var elem=This.video;elem.requestFullscreen?elem.requestFullscreen():elem.msRequestFullscreen?elem.msRequestFullscreen():elem.mozRequestFullScreen?elem.mozRequestFullScreen():elem.webkitEnterFullscreen&&elem.webkitEnterFullscreen()})},unFreeze:function(){var This=this;return this._deferredAction(function(){var c=document.getElementById(This.video.className+"canvas");$(c).remove()})},freeze:function(){var This=this;return this._deferredAction(function(){var canvas=document.createElement("canvas");canvas.id=This.video.className+"canvas",canvas.width=This.video.videoWidth,canvas.height=This.video.videoHeight,canvas.style.cssText=This.video.style.cssText,canvas.style.zIndex=2;var ctx=canvas.getContext("2d");ctx.drawImage(This.video,0,0,16*Math.ceil(canvas.width/16),16*Math.ceil(canvas.height/16)),This.video.parentElement.appendChild(canvas)})},unload:function(){return this._callUnloadEvent(),paella_DeferredNotImplemented()},getDimensions:function(){return paella_DeferredNotImplemented()}}),Class("paella.videoFactories.YoutubeVideoFactory",{initYoutubeApi:function(){if(!this._initialized){var tag=document.createElement("script");tag.src="https://www.youtube.com/iframe_api";var firstScriptTag=document.getElementsByTagName("script")[0];firstScriptTag.parentNode.insertBefore(tag,firstScriptTag),paella.youtubePlayerVars={apiReadyPromise:new $.Deferred},this._initialized=!0}},isStreamCompatible:function(streamData){try{for(var key in streamData.sources)if("youtube"==key)return!0}catch(e){}return!1},getVideoObject:function(id,streamData,rect){return this.initYoutubeApi(),new paella.YoutubeVideo(id,streamData,rect.x,rect.y,rect.w,rect.h)}}),Class("paella.ZoomPlugin",paella.EventDrivenPlugin,{_zImages:null,_imageNumber:null,_isActivated:!1,_isCreated:!1,_keys:null,_ant:null,_next:null,_videoLength:null,_compChanged:!1,_restartPlugin:!1,_actualImage:null,_zoomIncr:null,_maxZoom:null,_minZoom:null,_dragMode:!1,_mouseDownPosition:null,getIndex:function(){return 20},getAlignment:function(){return"right"},getSubclass:function(){return"zoomButton"},getDefaultToolTip:function(){return base.dictionary.translate("Zoom")},getEvents:function(){return[paella.events.timeUpdate,paella.events.setComposition,paella.events.loadPlugins,paella.events.play]},onEvent:function(event,params){switch(event){case paella.events.timeUpdate:this.imageUpdate(event,params);break;case paella.events.setComposition:this.compositionChanged(event,params);break;case paella.events.loadPlugins:this.loadPlugin(event,params);break;case paella.events.play:this.exitPhotoMode()}},checkEnabled:function(onSuccess){if(paella.player.videoContainer.sourceData.length<2)return void onSuccess(!1);var n=paella.player.videoContainer.sourceData[0].sources;onSuccess(!!n.hasOwnProperty("image"))},setupIcons:function(){var self=this,width=$(".zoomFrame").width(),arrowsLeft=document.createElement("div");arrowsLeft.className="arrowsLeft",arrowsLeft.style.display="none";var arrowsRight=document.createElement("div");arrowsRight.className="arrowsRight",arrowsRight.style.display="none",arrowsRight.style.left=width-24+"px",$(arrowsLeft).click(function(){self.arrowCallLeft(),event.stopPropagation()}),$(arrowsRight).click(function(){self.arrowCallRight(),event.stopPropagation()});var iconsFrame=document.createElement("div");iconsFrame.className="iconsFrame";var buttonZoomIn=document.createElement("button");buttonZoomIn.className="zoomActionButton buttonZoomIn",buttonZoomIn.style.display="none";var buttonZoomOut=document.createElement("button");buttonZoomOut.className="zoomActionButton buttonZoomOut",buttonZoomOut.style.display="none";var buttonSnapshot=document.createElement("button");buttonSnapshot.className="zoomActionButton buttonSnapshot",buttonSnapshot.style.display="none";var buttonZoomOn=document.createElement("button");buttonZoomOn.className="zoomActionButton buttonZoomOn",$(iconsFrame).append(buttonZoomOn),$(iconsFrame).append(buttonSnapshot),$(iconsFrame).append(buttonZoomIn),$(iconsFrame).append(buttonZoomOut),$(".newframe").append(iconsFrame),$(".newframe").append(arrowsLeft),$(".newframe").append(arrowsRight),$(buttonZoomOn).click(function(){self._isActivated?(self.exitPhotoMode(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked")):(self.enterPhotoMode(),$(".zoomActionButton.buttonZoomOn").addClass("clicked")),event.stopPropagation()}),$(buttonSnapshot).click(function(){null!=self._actualImage&&window.open(self._actualImage,"_blank"),event.stopPropagation()}),$(buttonZoomIn).click(function(){self.zoomIn(),event.stopPropagation()}),$(buttonZoomOut).click(function(){self.zoomOut(),event.stopPropagation()})},enterPhotoMode:function(){var self=this;$(".zoomFrame").show(),$(".zoomFrame").css("opacity","1"),this._isActivated=!0,$(".buttonSnapshot").show(),$(".buttonZoomOut").show(),$(".buttonZoomIn").show(),$(".arrowsRight").show(),$(".arrowsLeft").show(),paella.player.pause(),self._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),self._imageNumber>=self._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()},exitPhotoMode:function(){$(".zoomFrame").hide(),this._isActivated=!1,$(".buttonSnapshot").hide(),$(".buttonZoomOut").hide(),$(".buttonZoomIn").hide(),$(".arrowsRight").hide(),$(".arrowsLeft").hide(),$(".zoomActionButton.buttonZoomOn").removeClass("clicked");
},setup:function(){var self=this;self._maxZoom=self.config.maxZoom||500,self._minZoom=self.config.minZoom||100,self._zoomIncr=self.config.zoomIncr||10,this._zImages={},this._zImages=paella.player.videoContainer.sourceData[0].sources.image[0].frames,this._videoLength=paella.player.videoContainer.sourceData[0].sources.image[0].duration,this._keys=Object.keys(this._zImages),this._keys=this._keys.sort(function(a,b){return a=a.slice(6),b=b.slice(6),parseInt(a)-parseInt(b)}),this._next=0,this._ant=0},loadPlugin:function(){var self=this;0==self._isCreated&&(self.createOverlay(),self.setupIcons(),$(".zoomFrame").hide(),self._isActivated=!1,self._isCreated=!0)},imageUpdate:function(event,params){var self=this,sec=Math.round(params.currentTime),src=$(".zoomFrame").css("background-image");if($(".newframe").length>0){if(this._zImages.hasOwnProperty("frame_"+sec)){if(src==this._zImages["frame_"+sec])return;src=this._zImages["frame_"+sec]}else{if(!(sec>this._next||sec<this._ant||self._compChanged))return;self._compChanged&&(self._compChanged=!1),src=self.returnSrc(sec)}$("#photo_01").attr("src",src).load();var image=new Image;image.onload=function(){$(".zoomFrame").css("background-image","url("+src+")")},image.src=src,self._actualImage=src,self._imageNumber<=1?$(".arrowsLeft").hide():this._isActivated&&$(".arrowsLeft").show(),self._imageNumber>=self._keys.length-2?$(".arrowsRight").hide():this._isActivated&&$(".arrowsRight").show()}},returnSrc:function(sec){var ant=0;for(i=0;i<this._keys.length;i++){var id=parseInt(this._keys[i].slice(6)),lastId=parseInt(this._keys[this._keys.length-1].slice(6));if(sec<id)return this._next=id,this._ant=ant,this._imageNumber=i-1,this._zImages["frame_"+ant];if(sec>lastId&&sec<this._videoLength)return this._next=this._videoLength,this._ant=lastId,this._zImages["frame_"+ant];ant=id}},arrowCallLeft:function(){var self=this;if(self._imageNumber-1>=0){var frame=self._keys[self._imageNumber-1];self._imageNumber-=1,paella.player.videoContainer.seekToTime(parseInt(frame.slice(6)))}},arrowCallRight:function(){var self=this;if(self._imageNumber+1<=self._keys.length){var frame=self._keys[self._imageNumber+1];self._imageNumber+=1,paella.player.videoContainer.seekToTime(parseInt(frame.slice(6)))}},createOverlay:function(){var self=this,newframe=document.createElement("div");newframe.className="newframe",overlayContainer=paella.player.videoContainer.overlayContainer,overlayContainer.addElement(newframe,overlayContainer.getMasterRect());var zoomframe=document.createElement("div");zoomframe.className="zoomFrame",newframe.insertBefore(zoomframe,newframe.firstChild),$(zoomframe).click(function(event){event.stopPropagation()}),$(zoomframe).bind("mousewheel",function(e){e.originalEvent.wheelDelta/120>0?self.zoomIn():self.zoomOut()}),$(zoomframe).mousedown(function(event){self.mouseDown(event.clientX,event.clientY)}),$(zoomframe).mouseup(function(event){self.mouseUp()}),$(zoomframe).mouseleave(function(event){self.mouseLeave()}),$(zoomframe).mousemove(function(event){self.mouseMove(event.clientX,event.clientY)})},mouseDown:function(x,y){this._dragMode=!0,this._mouseDownPosition={x:x,y:y}},mouseUp:function(){this._dragMode=!1},mouseLeave:function(){this._dragMode=!1},mouseMove:function(x,y){if(this._dragMode){var pos=($(".zoomFrame")[0],this._backgroundPosition?this._backgroundPosition:{left:0,top:0}),px=($(".zoomFrame").width(),$(".zoomFrame").height(),this._mouseDownPosition.x-x),py=this._mouseDownPosition.y-y,positionx=pos.left+px,positiony=pos.top+py;positionx=positionx>=0?positionx:0,positionx=positionx<=100?positionx:100,positiony=positiony>=0?positiony:0,positiony=positiony<=100?positiony:100,$(".zoomFrame").css("background-position",positionx+"% "+positiony+"%"),this._backgroundPosition={left:positionx,top:positiony},this._mouseDownPosition.x=x,this._mouseDownPosition.y=y}},zoomIn:function(){var self=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z<self._maxZoom&&$(".zoomFrame").css("background-size",z+self._zoomIncr+"% auto")},zoomOut:function(){var self=this;z=$(".zoomFrame").css("background-size"),z=z.split(" "),z=parseInt(z[0]),z>self._minZoom&&$(".zoomFrame").css("background-size",z-self._zoomIncr+"% auto")},imageUpdateOnPause:function(params){var self=this,sec=Math.round(params),src=$(".zoomFrame").css("background-image");if($(".newframe").length>0&&src!=self._actualImage){if(this._zImages.hasOwnProperty("frame_"+sec)){if(src==this._zImages["frame_"+sec])return;src=this._zImages["frame_"+sec]}else self._compChanged&&(self._compChanged=!1),src=self.returnSrc(sec);$("#photo_01").attr("src",src).load();var image=new Image;image.onload=function(){$(".zoomFrame").css("background-image","url("+src+")")},image.src=src,self._actualImage=src}},compositionChanged:function(event,params){var self=this;if($(".newframe").remove(),self._isCreated=!1,paella.player.videoContainer.getMasterVideoRect().visible&&(self.loadPlugin(),paella.player.paused())){var currentTime=paella.player.videoContainer.currentTime();self.imageUpdateOnPause(currentTime)}self._compChanged=!0},getName:function(){return"es.upv.paella.zoomPlugin"}}),paella.plugins.zoomPlugin=new paella.ZoomPlugin,paella.version="5.0.18 - build: d490dce";